<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Chapter 2 Week 2 | UW CSDE 502 A Course Notes</title>
<meta name="author" content="Phil Hurvitz">
<meta name="description" content="This session covers the basics of creating R Markdown documents. We will also cover the Keyring package for securely storing passwords and other secrets that one would not want to hard-code into R...">
<meta name="generator" content="bookdown 0.24.4 with bs4_book()">
<meta property="og:title" content="Chapter 2 Week 2 | UW CSDE 502 A Course Notes">
<meta property="og:type" content="book">
<meta property="og:description" content="This session covers the basics of creating R Markdown documents. We will also cover the Keyring package for securely storing passwords and other secrets that one would not want to hard-code into R...">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Chapter 2 Week 2 | UW CSDE 502 A Course Notes">
<meta name="twitter:description" content="This session covers the basics of creating R Markdown documents. We will also cover the Keyring package for securely storing passwords and other secrets that one would not want to hard-code into R...">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/header-attrs-2.11/header-attrs.js"></script><script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script><script src="libs/bs3compat-0.3.1/transition.js"></script><script src="libs/bs3compat-0.3.1/tabs.js"></script><script src="libs/bs3compat-0.3.1/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><script src="libs/htmlwidgets-1.5.4/htmlwidgets.js"></script><link href="libs/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet">
<script src="libs/datatables-binding-0.20/datatables.js"></script><link href="libs/dt-core-1.11.3/css/jquery.dataTables.min.css" rel="stylesheet">
<link href="libs/dt-core-1.11.3/css/jquery.dataTables.extra.css" rel="stylesheet">
<script src="libs/dt-core-1.11.3/js/jquery.dataTables.min.js"></script><link href="libs/crosstalk-1.2.0/css/crosstalk.min.css" rel="stylesheet">
<script src="libs/crosstalk-1.2.0/js/crosstalk.min.js"></script><script src="libs/kePrint-0.0.1/kePrint.js"></script><link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet">
<link href="libs/tabwid-1.0.0/tabwid.css" rel="stylesheet">
<link href="libs/leaflet-1.3.1/leaflet.css" rel="stylesheet">
<script src="libs/leaflet-1.3.1/leaflet.js"></script><link href="libs/leafletfix-1.0.0/leafletfix.css" rel="stylesheet">
<script src="libs/proj4-2.6.2/proj4.min.js"></script><script src="libs/Proj4Leaflet-1.0.1/proj4leaflet.js"></script><link href="libs/rstudio_leaflet-1.3.1/rstudio_leaflet.css" rel="stylesheet">
<script src="libs/leaflet-binding-2.0.4.1/leaflet.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- CSS -->
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">UW CSDE 502 A Course Notes</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html">Introduction and Welcome!</a></li>
<li><a class="" href="week1.html"><span class="header-section-number">1</span> Week 1</a></li>
<li><a class="active" href="week2.html"><span class="header-section-number">2</span> Week 2</a></li>
<li><a class="" href="week3.html"><span class="header-section-number">3</span> Week 3</a></li>
<li><a class="" href="week4.html"><span class="header-section-number">4</span> Week 4</a></li>
<li><a class="" href="week5.html"><span class="header-section-number">5</span> Week 5</a></li>
<li><a class="" href="week6.html"><span class="header-section-number">6</span> Week 6</a></li>
<li><a class="" href="week7.html"><span class="header-section-number">7</span> Week 7</a></li>
<li><a class="" href="week8.html"><span class="header-section-number">8</span> Week 8</a></li>
<li><a class="" href="week9.html"><span class="header-section-number">9</span> Week 9</a></li>
<li><a class="" href="week10.html"><span class="header-section-number">10</span> Week 10</a></li>
<li><a class="" href="assignment_files.html"><span class="header-section-number">11</span> Assignment support files</a></li>
</ul>

        <div class="book-extra">
          <p><a id="book-repo" href="https://github.com/CSDE-UW/csde502-winter-2022">View book source <i class="fab fa-github"></i></a></p>
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="week2" class="section level1" number="2">
<h1>
<span class="header-section-number">2</span> Week 2<a class="anchor" aria-label="anchor" href="#week2"><i class="fas fa-link"></i></a>
</h1>
<p>This session covers the basics of creating R Markdown documents. We will also cover the <a href="https://cran.r-project.org/web/packages/keyring/index.html">Keyring</a> package for securely storing passwords and other secrets that one would not want to hard-code into R documents. Finally, we will introduce the Human Mortality and Human Fertility databases that will be used in CSDE 533.</p>
<p>For this class session, we will be building up an R Markdown document using various code chunks copied and pasted from this page.</p>
<p>Download the file <a href="files/week02/week02.Rmd">week02.Rmd</a> and use that as the base. Change the second line in the YAML header so it uses your name and your web site. See <a href="https://students.washington.edu/">UW Students Web Server</a> if you do not have a web site.</p>
<h2>
Topics:
<a class="anchor" aria-label="anchor" href="#week2"><i class="fas fa-link"></i></a>
</h2>
<ul>
<li><a href="week2.html#rmdcodeblocks">Code chunks in R</a></li>
<li><a href="week2.html#rmdgraphics">Graphs in R Markdown</a></li>
<li><a href="week2.html#rmdtables">Tables in R Markdow</a></li>
<li><a href="week2.html#rmdequations">Equations in R Markdown</a></li>
<li><a href="week2.html#rmdcaptions">Captions and cross-references in R Markdown</a></li>
<li><a href="week2.html#keyring">Keyring for storing passwords and other secrets</a></li>
<li>
<a href="week2.html#datasets002">Data sets:</a>
<ul>
<li>Data:
<ul>
<li>Human Mortality Database</li>
<li>Human Fertility Database</li>
</ul>
</li>
</ul>
</li>
</ul>
<div id="code-to-run-for-the-in-class-exercise" class="section level2" number="2.1">
<h2>
<span class="header-section-number">2.1</span> Code to run for the in-class exercise<a class="anchor" aria-label="anchor" href="#code-to-run-for-the-in-class-exercise"><i class="fas fa-link"></i></a>
</h2>
<p>For the exercise in class, download <a href="r_code/week02.R">week02.R</a>, which we will use to run the code listed in this R Markdown result.</p>
</div>
<div id="r-markdown" class="section level2" number="2.2">
<h2>
<span class="header-section-number">2.2</span> R Markdown<a class="anchor" aria-label="anchor" href="#r-markdown"><i class="fas fa-link"></i></a>
</h2>
<div id="rmdcodeblocks" class="section level3" number="2.2.1">
<h3>
<span class="header-section-number">2.2.1</span> Code chunks<a class="anchor" aria-label="anchor" href="#rmdcodeblocks"><i class="fas fa-link"></i></a>
</h3>
<p>Code chunks are blocks of text that include R code. As the R Markdown file is rendered, the code is run. The code can run R routines to perform any number of tasks, including analytics, printing tables, and generating graphics. Anything you would do in a regular R file can be placed in the code chunks. Code chunks can print outputs (tables, figures), but they do not necessarily always do; for example, your code could generate a summary of a raw data set, export to a CSV file, and zip the CSV file. You could then “manually” print a hyperlink in your output.</p>
<p>In RStudio, a code chunk can be added to an R Markdown source file with the keystroke combination CTRL-ALT-i</p>
<div id="code-chunk-structure" class="section level4" number="2.2.1.1">
<h4>
<span class="header-section-number">2.2.1.1</span> Code chunk structure<a class="anchor" aria-label="anchor" href="#code-chunk-structure"><i class="fas fa-link"></i></a>
</h4>
<p>Code chunks are designated by delimiting the code with the characters <code>```{r}</code> to open the block and <code>```</code> to close the block.</p>
<p>There are a number of additional options that can be included in the <code>{r}</code> opening delimiter, see <a href="https://yihui.org/knitr/options/">Chunk options and package options</a>. Many options are set by default and require being set explicitly to select any option other than the default.</p>
<p>For example, the code chunk can be not run with the <code>eval=FALSE</code> option. Or if the code chunk generates a graphic, the <code>fig.cap</code> option can be used to print a caption.</p>
<p>For example, the following code chunk creates a single element vector <code>a</code> with the value of <code>2</code>.</p>
<pre><code>```{r, eval=TRUE}
a &lt;- 1 + 1
```</code></pre>
</div>
</div>
<div id="inline-code" class="section level3" number="2.2.2">
<h3>
<span class="header-section-number">2.2.2</span> Inline code<a class="anchor" aria-label="anchor" href="#inline-code"><i class="fas fa-link"></i></a>
</h3>
<p>Inline code is designated using this type of syntax <code>`r R_CODE`</code>, where <code>R_CODE</code> represents a statement to be evaluated and printed inline.</p>
<p>For example, to get the mean age from the Babushkin data, the <code>R_CODE</code> would read</p>
<div class="sourceCode" id="cb172"><pre class="sourceCode md"><code class="sourceCode markdown"><span id="cb172-1"><a href="week2.html#cb172-1" aria-hidden="true" tabindex="-1"></a>mean(etdata$age) %&gt;% round(1)</span></code></pre></div>
<p>That is, in the document one would write:</p>
<div class="sourceCode" id="cb173"><pre class="sourceCode md"><code class="sourceCode markdown"><span id="cb173-1"><a href="week2.html#cb173-1" aria-hidden="true" tabindex="-1"></a>The mean age of the subjects in the Babushkin data was <span class="in">`r mean(etdata$age) %&gt;% round(1)`</span> years.</span></code></pre></div>
<p>which renders to</p>
<pre><code>The mean age of the subjects in the Babushkin data was 31.1 years.</code></pre>
</div>
<div id="rmdgraphics" class="section level3" number="2.2.3">
<h3>
<span class="header-section-number">2.2.3</span> Graphics in R Markdown<a class="anchor" aria-label="anchor" href="#rmdgraphics"><i class="fas fa-link"></i></a>
</h3>
<p>Data-driven graphics in Rmd files are typically created as base R graphics or with the <code>ggplot2</code> package. This tutorial is not intended to provide anywhere near a comprehensive treatment of creating graphics from data, but will provide instruction on some options for creating and including data-driven graphics as well as inserting graphics from image files.</p>
<p>See <a href="http://zevross.com/blog/2017/06/19/tips-and-tricks-for-working-with-images-and-figures-in-r-markdown-documents/">Tips and tricks for working with images and figures in R Markdown documents</a> for a good explanation.</p>
<div id="base-r-graphics" class="section level4" number="2.2.3.1">
<h4>
<span class="header-section-number">2.2.3.1</span> Base R graphics<a class="anchor" aria-label="anchor" href="#base-r-graphics"><i class="fas fa-link"></i></a>
</h4>
<p>To include base R graphics, simply place the code to generate the graphic in an R code block, e.g., using the Add Health data from last week (<a href="data/AHwave1_v1.dta">AHWave1_v1.dta</a>):</p>
<pre><code>```{r}
# since loading the data takes awhile, only load the data if necessary -- won't load if it was done already
if(!exists("dat")){
    dat &lt;- read.dta13("data/AHwave1_v1.dta")
}
# birth year = h1gi1y
# drop "Refused" birth year
# for birth year and interview year, replace anything before white space, convert to numeric
# subtract interview year - birth year
ages &lt;- dat %&gt;% 
    filter(! str_detect(h1gi1y, "Refused")) %&gt;% 
    select(iyear, h1gi1y) %&gt;% 
    mutate(yi = str_replace(iyear, ".*\\s", "") %&gt;% as.numeric(),
           yb = str_replace(h1gi1y, ".*\\s", "") %&gt;% as.numeric(),
           age = yi - yb)
           
# create a histogram using base graphics
hist(ages$age, xlab = "age (years)", las = 1)
```</code></pre>
<p>… which will render the graph:</p>
<div class="inline-figure"><img src="02-week02_files/figure-html/unnamed-chunk-6-1.png" width="672"></div>
</div>
<div id="ggplot2-graphics" class="section level4" number="2.2.3.2">
<h4>
<span class="header-section-number">2.2.3.2</span> <code>ggplot2</code> graphics<a class="anchor" aria-label="anchor" href="#ggplot2-graphics"><i class="fas fa-link"></i></a>
</h4>
<p>The <code>ggplot2</code> package creates compelling graphics that use a common syntax. The main difference between base R graphics and <code>ggplot2</code> graphics is that simply issuing the <code><a href="https://rdrr.io/r/graphics/plot.default.html">plot()</a></code> or related command (e.g., <code><a href="https://rdrr.io/r/graphics/hist.html">hist()</a></code>, <code><a href="https://rdrr.io/r/graphics/barplot.html">barplot()</a></code>) adds the graphic to the output, whereas with <code><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot()</a></code> it is necessary to issue a command that prints the graphic.</p>
<p>Following the previous example:</p>
<pre><code>```{r}
# how many unique bins? 
bins &lt;- length(unique(ages$age))

# create the graphic
g &lt;- ggplot(data = ages, mapping = aes(x = age)) +
    geom_histogram(bins = bins)

# print the graphic
print(g)
```</code></pre>
<div class="inline-figure"><img src="02-week02_files/figure-html/unnamed-chunk-8-1.png" width="672"></div>
<p>The following code generates a box plot from the Babushkin employee turnover data. Because the code chunk includes <code>fig.cap = "Box plot of Babushkin data, self control by profession"</code>, a caption is automatically placed below the figure.</p>
<pre><code>```{r, fig.cap = "Box plot of Babushkin data, self control by profession"}
ggplot(data = etdata, aes(x = reorder(profession, selfcontrol), y = selfcontrol)) +
    geom_boxplot() +
    coord_flip()
```</code></pre>
<div class="figure">
<span style="display:block;" id="fig:unnamed-chunk-10"></span>
<img src="02-week02_files/figure-html/unnamed-chunk-10-1.png" alt="Box plot of Babushkin data, self control by profession" width="672"><p class="caption">
Figure 2.1: Box plot of Babushkin data, self control by profession
</p>
</div>
</div>
<div id="embedding-graphics-files" class="section level4" number="2.2.3.3">
<h4>
<span class="header-section-number">2.2.3.3</span> Embedding graphics files<a class="anchor" aria-label="anchor" href="#embedding-graphics-files"><i class="fas fa-link"></i></a>
</h4>
<p>Journals frequently require graphics files to be submitted separately from the manuscript. In this case, the graphic can be created and saved as a file and then inserted in the Rmd using code, but also accessed as a a stand-alone file. Let’s take the previous example, but add correlation coefficients and other embellishments, create a graphics file and add the graphics into the Rmd.</p>
<p>The base graphics file is created using the <code><a href="https://rdrr.io/r/grDevices/pdf.html">pdf()</a></code> function, although <code><a href="https://rdrr.io/r/grDevices/png.html">png()</a></code> also works if that is the desired output format. PDF is a vector format, so it generally renders better over different zoom levels.</p>
<div class="sourceCode" id="cb178"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/grDevices/pdf.html">pdf</a></span><span class="op">(</span>file <span class="op">=</span> <span class="st">"ah_age_hist.pdf"</span>, width <span class="op">=</span> <span class="fl">5</span>, height <span class="op">=</span> <span class="fl">5</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/hist.html">hist</a></span><span class="op">(</span><span class="va">ages</span><span class="op">$</span><span class="va">age</span>, xlab <span class="op">=</span> <span class="st">"age (years)"</span>, las <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>
<span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/grDevices/dev.html">dev.off</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<p>Here we create a PNG format file:</p>
<div class="sourceCode" id="cb179"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/grDevices/png.html">png</a></span><span class="op">(</span>file <span class="op">=</span> <span class="st">"ah_age_hist.png"</span>, width <span class="op">=</span> <span class="fl">5</span>, height <span class="op">=</span> <span class="fl">5</span>, units <span class="op">=</span> <span class="st">"in"</span>, res <span class="op">=</span> <span class="fl">300</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/hist.html">hist</a></span><span class="op">(</span><span class="va">ages</span><span class="op">$</span><span class="va">age</span>, xlab <span class="op">=</span> <span class="st">"age (years)"</span>, las <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>
<span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/grDevices/dev.html">dev.off</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<p><code>ggplot2</code> graphics can be saved using <code><a href="https://ggplot2.tidyverse.org/reference/ggsave.html">ggsave()</a></code>, e.g., for both PDF and PNG outputs. The <code>dpi</code> argument is important for bitmap images because it sets the dots per inch, which controls the size of the graphics file.</p>
<div class="sourceCode" id="cb180"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsave.html">ggsave</a></span><span class="op">(</span>
    filename <span class="op">=</span> <span class="st">"ah_age_hist_ggplot.pdf"</span>,
    plot <span class="op">=</span> <span class="va">g</span>, device <span class="op">=</span> <span class="st">"pdf"</span>,
    width <span class="op">=</span> <span class="fl">5</span>, height <span class="op">=</span> <span class="fl">5</span>
<span class="op">)</span>
<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsave.html">ggsave</a></span><span class="op">(</span>
    filename <span class="op">=</span> <span class="st">"ah_age_hist_ggplot.png"</span>,
    plot <span class="op">=</span> <span class="va">g</span>, device <span class="op">=</span> <span class="st">"png"</span>,
    width <span class="op">=</span> <span class="fl">5</span>, height <span class="op">=</span> <span class="fl">5</span>,
    units <span class="op">=</span> <span class="st">"in"</span>, dpi <span class="op">=</span> <span class="fl">300</span>
<span class="op">)</span></code></pre></div>
<p>Graphics can be added using several methods.</p>
<div id="knitr" class="section level5" number="2.2.3.3.1">
<h5>
<span class="header-section-number">2.2.3.3.1</span> <code>knitr</code><a class="anchor" aria-label="anchor" href="#knitr"><i class="fas fa-link"></i></a>
</h5>
<p>The <code><a href="https://rdrr.io/pkg/knitr/man/include_graphics.html">knitr::include_graphics()</a></code> function can be used to insert image files, with the caution that inserted PDF files may produce unwanted results. The syntax is:</p>
<pre><code>```{r}
include_graphics("graphics_filename")
```</code></pre>
<p>and the code chunk can include <code>out.width</code>, <code>out.height</code> and other options after the <code>r</code> in the first line of the chunk,
 
Here we insert a PDF with no code chunk options, which presents the image with a scroll bar, rather than the full image:</p>
<div class="sourceCode" id="cb182"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/include_graphics.html">include_graphics</a></span><span class="op">(</span><span class="st">"ah_age_hist.pdf"</span><span class="op">)</span></code></pre></div>
<p><embed src="ah_age_hist.pdf"></embed><!-- --></p>
<p>Here we specify in the code chunk options <code>out.height = "360px", out.width='360px', fig.align='left'</code>,</p>
<div class="sourceCode" id="cb183"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/include_graphics.html">include_graphics</a></span><span class="op">(</span><span class="st">"ah_age_hist.pdf"</span><span class="op">)</span></code></pre></div>
<embed src="ah_age_hist.pdf" width="360px" height="360px" style="display: block; margin: auto auto auto 0;" type="application/pdf"></embed><p> </p>
<p>… and with code chunk options <code>out.height = "400px", out.width='100%', fig.align='left'</code></p>
<div class="sourceCode" id="cb184"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/include_graphics.html">include_graphics</a></span><span class="op">(</span><span class="st">"ah_age_hist.pdf"</span><span class="op">)</span></code></pre></div>
<embed src="ah_age_hist.pdf" width="100%" height="400px" style="display: block; margin: auto auto auto 0;" type="application/pdf"></embed><p> </p>
<p>It seems that embedding PDF files is not optimal.</p>
<p>Here we insert a PNG: with no code chunk options:</p>
<div class="sourceCode" id="cb185"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/include_graphics.html">include_graphics</a></span><span class="op">(</span><span class="st">"ah_age_hist_ggplot.png"</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="ah_age_hist_ggplot.png" width="750"></div>
<p>and with code chunk option <code>out.width = "50%"</code></p>
<div class="sourceCode" id="cb186"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/include_graphics.html">include_graphics</a></span><span class="op">(</span><span class="st">"ah_age_hist_ggplot.png"</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="ah_age_hist_ggplot.png" width="50%"></div>
<p>So embedding bitmapped images appears to work better than embedding PDF files.</p>
</div>
<div id="markdown-captionfilename" class="section level5" number="2.2.3.3.2">
<h5>
<span class="header-section-number">2.2.3.3.2</span> Markdown: <code>![caption](filename)</code><a class="anchor" aria-label="anchor" href="#markdown-captionfilename"><i class="fas fa-link"></i></a>
</h5>
<p>The native Markdown syntax:</p>
<pre><code>![](filename)</code></pre>
<p>includes a graphics file with an optional caption, e.g., here, a PDF with no caption,</p>
<p><code>![](ah_age_hist.pdf)</code></p>
<p><embed src="ah_age_hist.pdf"></embed></p>
<p> </p>
<p>The structure <code>![]()</code> indicates this is an inserted graphic; a caption can be specified by including text within the square brackets, e.g., displays the caption below the inserted image (but with no caption number!).</p>
<p><code>![Add Health respondent age histogram](ah_age_hist_ggplot.pdf)</code></p>
<div class="figure">
<embed src="ah_age_hist_ggplot.pdf"></embed><p class="caption">Add Health respondent age histogram</p>
</div>
<p>… although it seems that inserting a PDF does odd things with image scrolling, while a PNG inserts the complete image without scroll bars.</p>
<p><code>![Add Health respondent age histogram](ah_age_hist_ggplot.png)</code>:</p>
<div class="figure">
<img src="ah_age_hist_ggplot.png" alt=""><p class="caption">Add Health respondent age histogram</p>
</div>
</div>
<div id="html-img-tag" class="section level5" number="2.2.3.3.3">
<h5>
<span class="header-section-number">2.2.3.3.3</span> HTML <code>&lt;img&gt;</code> tag<a class="anchor" aria-label="anchor" href="#html-img-tag"><i class="fas fa-link"></i></a>
</h5>
<p>If the file is to be rendered as HTML, <em>and</em> the image is a bitmap, rather than vector PDF graphics, the <code>&lt;img&gt;</code> tag can be used. Different utilities can be used to convert PDF to bitmapped formats, e.g., <a href="https://imagemagick.org/index.php">ImageMagick</a> and <a href="http://www.graphicsmagick.org/">GraphicsMagick</a>.</p>
<p><code>&lt;img src="ah_age_hist_ggplot.png"&gt;</code></p>
<div class="inline-figure"><img src="ah_age_hist_ggplot.png"></div>
<p>Including a percentage of page width:</p>
<p><code>&lt;img src="ah_age_hist_ggplot.png" width="30%"&gt;</code></p>
<div class="inline-figure"><img src="ah_age_hist_ggplot.png" width="30%"></div>
</div>
</div>
</div>
<div id="rmdtables" class="section level3" number="2.2.4">
<h3>
<span class="header-section-number">2.2.4</span> Tables in R Markdown<a class="anchor" aria-label="anchor" href="#rmdtables"><i class="fas fa-link"></i></a>
</h3>
<p>We will look at three methods of including tables in R Markdown documents, using the packages <code>knitr</code> (with <code>kableExtra</code>), <code>pander</code>, and <code>stargazer</code>.</p>
<p>For the example table, we will use the frequency table of health <span class="math inline">\(\times\)</span> White and African American from the Add Health data:</p>
<div class="sourceCode" id="cb188"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">dat</span> <span class="op">&lt;-</span> <span class="fu">readstata13</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/readstata13/man/read.dta13.html">read.dta13</a></span><span class="op">(</span><span class="st">"http://staff.washington.edu/phurvitz/csde502_winter_2021/data/AHwave1_v1.dta"</span><span class="op">)</span></code></pre></div>
<pre><code>## Warning in readstata13::read.dta13("http://staff.washington.edu/phurvitz/csde502_winter_2021/data/AHwave1_v1.dta"): 
##    Factor codes of type double or float detected in variables
## 
##    h1hr7a, h1hr7b
## 
##    No labels have been assigned.
##    Set option 'nonint.factors = TRUE' to assign labels anyway.</code></pre>
<pre><code>## Warning in readstata13::read.dta13("http://staff.washington.edu/phurvitz/csde502_winter_2021/data/AHwave1_v1.dta"): 
##    Missing factor labels for variables
## 
##    h1hr8e
## 
##    No labels have beend assigned.
##    Set option 'generate.factors=TRUE' to generate labels.</code></pre>
<div class="sourceCode" id="cb191"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># ordered factor; use fct_rev to establish the correct ordering where better health ranks higher</span>
<span class="va">dat</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/compound.html">%&lt;&gt;%</a></span>
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>h1gh1 <span class="op">=</span> <span class="fu"><a href="https://forcats.tidyverse.org/reference/fct_rev.html">fct_rev</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.ordered</a></span><span class="op">(</span><span class="va">h1gh1</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>

<span class="co"># stratify health; first we need to catch the "don't know" and "refused" as NAs</span>
<span class="va">dat</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/compound.html">%&lt;&gt;%</a></span>
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>
        health <span class="op">=</span>
            <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html">case_when</a></span><span class="op">(</span>
                <span class="va">h1gh1</span> <span class="op">&lt;=</span> <span class="st">"(6) Refused"</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html">as.character</a></span><span class="op">(</span><span class="cn">NA</span><span class="op">)</span>,
                <span class="va">h1gh1</span> <span class="op">&gt;</span> <span class="st">"(3) Good"</span> <span class="op">~</span> <span class="st">"high"</span>,
                <span class="va">h1gh1</span> <span class="op">&lt;=</span> <span class="st">"(3) Good"</span> <span class="op">~</span> <span class="st">"low"</span>
            <span class="op">)</span>
    <span class="op">)</span>

<span class="co"># tabulate by White</span>
<span class="va">tabhealth_white</span> <span class="op">&lt;-</span> <span class="va">dat</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">health</span>, white <span class="op">=</span> <span class="va">h1gi6a</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html">n</a></span><span class="op">(</span><span class="op">)</span>, .groups <span class="op">=</span> <span class="st">"drop_last"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span><span class="st">"%"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="va">n</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span> <span class="op">*</span> <span class="fl">100</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span>

<span class="co"># tabulate by African American</span>
<span class="va">tabhealth_afram</span> <span class="op">&lt;-</span> <span class="va">dat</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">health</span>, afram <span class="op">=</span> <span class="va">h1gi6b</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html">n</a></span><span class="op">(</span><span class="op">)</span>, .groups <span class="op">=</span> <span class="st">"drop_last"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span><span class="st">"%"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="va">n</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span> <span class="op">*</span> <span class="fl">100</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span>

<span class="co"># column-bind and remove the second "health" column</span>
<span class="va">sum_health_white_afram</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="va">tabhealth_white</span>, <span class="va">tabhealth_afram</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="op">-</span><span class="fl">5</span><span class="op">)</span></code></pre></div>
<pre><code>## New names:
## * health -&gt; health...1
## * n -&gt; n...3
## * `%` -&gt; `%...4`
## * health -&gt; health...5
## * n -&gt; n...7
## * ...</code></pre>
<div id="kntir-kable-and-kableextra" class="section level4" number="2.2.4.1">
<h4>
<span class="header-section-number">2.2.4.1</span> <code>kntir</code> (<code>kable()</code>) and <code>kableExtra</code><a class="anchor" aria-label="anchor" href="#kntir-kable-and-kableextra"><i class="fas fa-link"></i></a>
</h4>
<p>The simple table using <code><a href="https://rdrr.io/pkg/knitr/man/kable.html">kable()</a></code> is not too nice to read.</p>
<div class="sourceCode" id="cb193"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html">kable</a></span><span class="op">(</span><span class="va">sum_health_white_afram</span><span class="op">)</span></code></pre></div>
<div class="inline-table"><table class="table table-sm">
<thead><tr>
<th style="text-align:left;">
health…1
</th>
<th style="text-align:left;">
white
</th>
<th style="text-align:right;">
n…3
</th>
<th style="text-align:right;">
%…4
</th>
<th style="text-align:left;">
afram
</th>
<th style="text-align:right;">
n…7
</th>
<th style="text-align:right;">
%…8
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:left;">
high
</td>
<td style="text-align:left;">
<ol start="0" style="list-style-type: decimal"><li>Not marked
</li></ol>
</td>
<td style="text-align:right;">
1486
</td>
<td style="text-align:right;">
33.36
</td>
<td style="text-align:left;">
<ol start="0" style="list-style-type: decimal"><li>Not marked
</li></ol>
</td>
<td style="text-align:right;">
3309
</td>
<td style="text-align:right;">
74.28
</td>
</tr>
<tr>
<td style="text-align:left;">
high
</td>
<td style="text-align:left;">
<ol style="list-style-type: decimal"><li>Marked
</li></ol>
</td>
<td style="text-align:right;">
2962
</td>
<td style="text-align:right;">
66.49
</td>
<td style="text-align:left;">
<ol style="list-style-type: decimal"><li>Marked
</li></ol>
</td>
<td style="text-align:right;">
1139
</td>
<td style="text-align:right;">
25.57
</td>
</tr>
<tr>
<td style="text-align:left;">
high
</td>
<td style="text-align:left;">
<ol start="6" style="list-style-type: decimal"><li>Refused
</li></ol>
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
0.04
</td>
<td style="text-align:left;">
<ol start="6" style="list-style-type: decimal"><li>Refused
</li></ol>
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
0.04
</td>
</tr>
<tr>
<td style="text-align:left;">
high
</td>
<td style="text-align:left;">
<ol start="8" style="list-style-type: decimal"><li>Don’t know
</li></ol>
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
0.11
</td>
<td style="text-align:left;">
<ol start="8" style="list-style-type: decimal"><li>Don’t know
</li></ol>
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
0.11
</td>
</tr>
<tr>
<td style="text-align:left;">
low
</td>
<td style="text-align:left;">
<ol start="0" style="list-style-type: decimal"><li>Not marked
</li></ol>
</td>
<td style="text-align:right;">
704
</td>
<td style="text-align:right;">
34.49
</td>
<td style="text-align:left;">
<ol start="0" style="list-style-type: decimal"><li>Not marked
</li></ol>
</td>
<td style="text-align:right;">
1553
</td>
<td style="text-align:right;">
76.09
</td>
</tr>
<tr>
<td style="text-align:left;">
low
</td>
<td style="text-align:left;">
<ol style="list-style-type: decimal"><li>Marked
</li></ol>
</td>
<td style="text-align:right;">
1328
</td>
<td style="text-align:right;">
65.07
</td>
<td style="text-align:left;">
<ol style="list-style-type: decimal"><li>Marked
</li></ol>
</td>
<td style="text-align:right;">
479
</td>
<td style="text-align:right;">
23.47
</td>
</tr>
<tr>
<td style="text-align:left;">
low
</td>
<td style="text-align:left;">
<ol start="6" style="list-style-type: decimal"><li>Refused
</li></ol>
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0.05
</td>
<td style="text-align:left;">
<ol start="6" style="list-style-type: decimal"><li>Refused
</li></ol>
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0.05
</td>
</tr>
<tr>
<td style="text-align:left;">
low
</td>
<td style="text-align:left;">
<ol start="8" style="list-style-type: decimal"><li>Don’t know
</li></ol>
</td>
<td style="text-align:right;">
8
</td>
<td style="text-align:right;">
0.39
</td>
<td style="text-align:left;">
<ol start="8" style="list-style-type: decimal"><li>Don’t know
</li></ol>
</td>
<td style="text-align:right;">
8
</td>
<td style="text-align:right;">
0.39
</td>
</tr>
<tr>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
<ol start="0" style="list-style-type: decimal"><li>Not marked
</li></ol>
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
12.50
</td>
<td style="text-align:left;">
<ol start="0" style="list-style-type: decimal"><li>Not marked
</li></ol>
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
50.00
</td>
</tr>
<tr>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
<ol style="list-style-type: decimal"><li>Marked
</li></ol>
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
50.00
</td>
<td style="text-align:left;">
<ol style="list-style-type: decimal"><li>Marked
</li></ol>
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
12.50
</td>
</tr>
<tr>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
<ol start="6" style="list-style-type: decimal"><li>Refused
</li></ol>
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
12.50
</td>
<td style="text-align:left;">
<ol start="6" style="list-style-type: decimal"><li>Refused
</li></ol>
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
12.50
</td>
</tr>
<tr>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
<ol start="8" style="list-style-type: decimal"><li>Don’t know
</li></ol>
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
25.00
</td>
<td style="text-align:left;">
<ol start="8" style="list-style-type: decimal"><li>Don’t know
</li></ol>
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
25.00
</td>
</tr>
</tbody>
</table></div>
<p>So we add some <code>kableExtra</code> options, :</p>
<div class="sourceCode" id="cb194"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html">kable</a></span><span class="op">(</span><span class="va">sum_health_white_afram</span>,
    col.names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"health"</span>, <span class="st">"race"</span>, <span class="st">"n"</span>, <span class="st">"%"</span>, <span class="st">"race"</span>, <span class="st">"n"</span>, <span class="st">"%"</span><span class="op">)</span>
<span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
    <span class="fu"><a href="https://rdrr.io/pkg/kableExtra/man/kable_styling.html">kable_styling</a></span><span class="op">(</span>bootstrap_options <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"striped"</span>, <span class="st">"hover"</span>, <span class="st">"condensed"</span>, <span class="st">"responsive"</span><span class="op">)</span>, full_width <span class="op">=</span> <span class="cn">F</span>, position <span class="op">=</span> <span class="st">"left"</span><span class="op">)</span></code></pre></div>
<div class="inline-table"><table class="table table-striped table-hover table-condensed table-responsive" style="width: auto !important; ">
<thead><tr>
<th style="text-align:left;">
health
</th>
<th style="text-align:left;">
race
</th>
<th style="text-align:right;">
n
</th>
<th style="text-align:right;">
%
</th>
<th style="text-align:left;">
race
</th>
<th style="text-align:right;">
n
</th>
<th style="text-align:right;">
%
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:left;">
high
</td>
<td style="text-align:left;">
<ol start="0" style="list-style-type: decimal"><li>Not marked
</li></ol>
</td>
<td style="text-align:right;">
1486
</td>
<td style="text-align:right;">
33.36
</td>
<td style="text-align:left;">
<ol start="0" style="list-style-type: decimal"><li>Not marked
</li></ol>
</td>
<td style="text-align:right;">
3309
</td>
<td style="text-align:right;">
74.28
</td>
</tr>
<tr>
<td style="text-align:left;">
high
</td>
<td style="text-align:left;">
<ol style="list-style-type: decimal"><li>Marked
</li></ol>
</td>
<td style="text-align:right;">
2962
</td>
<td style="text-align:right;">
66.49
</td>
<td style="text-align:left;">
<ol style="list-style-type: decimal"><li>Marked
</li></ol>
</td>
<td style="text-align:right;">
1139
</td>
<td style="text-align:right;">
25.57
</td>
</tr>
<tr>
<td style="text-align:left;">
high
</td>
<td style="text-align:left;">
<ol start="6" style="list-style-type: decimal"><li>Refused
</li></ol>
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
0.04
</td>
<td style="text-align:left;">
<ol start="6" style="list-style-type: decimal"><li>Refused
</li></ol>
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
0.04
</td>
</tr>
<tr>
<td style="text-align:left;">
high
</td>
<td style="text-align:left;">
<ol start="8" style="list-style-type: decimal"><li>Don’t know
</li></ol>
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
0.11
</td>
<td style="text-align:left;">
<ol start="8" style="list-style-type: decimal"><li>Don’t know
</li></ol>
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
0.11
</td>
</tr>
<tr>
<td style="text-align:left;">
low
</td>
<td style="text-align:left;">
<ol start="0" style="list-style-type: decimal"><li>Not marked
</li></ol>
</td>
<td style="text-align:right;">
704
</td>
<td style="text-align:right;">
34.49
</td>
<td style="text-align:left;">
<ol start="0" style="list-style-type: decimal"><li>Not marked
</li></ol>
</td>
<td style="text-align:right;">
1553
</td>
<td style="text-align:right;">
76.09
</td>
</tr>
<tr>
<td style="text-align:left;">
low
</td>
<td style="text-align:left;">
<ol style="list-style-type: decimal"><li>Marked
</li></ol>
</td>
<td style="text-align:right;">
1328
</td>
<td style="text-align:right;">
65.07
</td>
<td style="text-align:left;">
<ol style="list-style-type: decimal"><li>Marked
</li></ol>
</td>
<td style="text-align:right;">
479
</td>
<td style="text-align:right;">
23.47
</td>
</tr>
<tr>
<td style="text-align:left;">
low
</td>
<td style="text-align:left;">
<ol start="6" style="list-style-type: decimal"><li>Refused
</li></ol>
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0.05
</td>
<td style="text-align:left;">
<ol start="6" style="list-style-type: decimal"><li>Refused
</li></ol>
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0.05
</td>
</tr>
<tr>
<td style="text-align:left;">
low
</td>
<td style="text-align:left;">
<ol start="8" style="list-style-type: decimal"><li>Don’t know
</li></ol>
</td>
<td style="text-align:right;">
8
</td>
<td style="text-align:right;">
0.39
</td>
<td style="text-align:left;">
<ol start="8" style="list-style-type: decimal"><li>Don’t know
</li></ol>
</td>
<td style="text-align:right;">
8
</td>
<td style="text-align:right;">
0.39
</td>
</tr>
<tr>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
<ol start="0" style="list-style-type: decimal"><li>Not marked
</li></ol>
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
12.50
</td>
<td style="text-align:left;">
<ol start="0" style="list-style-type: decimal"><li>Not marked
</li></ol>
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
50.00
</td>
</tr>
<tr>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
<ol style="list-style-type: decimal"><li>Marked
</li></ol>
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
50.00
</td>
<td style="text-align:left;">
<ol style="list-style-type: decimal"><li>Marked
</li></ol>
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
12.50
</td>
</tr>
<tr>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
<ol start="6" style="list-style-type: decimal"><li>Refused
</li></ol>
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
12.50
</td>
<td style="text-align:left;">
<ol start="6" style="list-style-type: decimal"><li>Refused
</li></ol>
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
12.50
</td>
</tr>
<tr>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
<ol start="8" style="list-style-type: decimal"><li>Don’t know
</li></ol>
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
25.00
</td>
<td style="text-align:left;">
<ol start="8" style="list-style-type: decimal"><li>Don’t know
</li></ol>
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
25.00
</td>
</tr>
</tbody>
</table></div>
<p>However, because some column names are duplicated, it is necessary to add some column grouping:</p>
<div class="sourceCode" id="cb195"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html">kable</a></span><span class="op">(</span><span class="va">sum_health_white_afram</span>,
    col.names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"health"</span>, <span class="st">"race"</span>, <span class="st">"n"</span>, <span class="st">"%"</span>, <span class="st">"race"</span>, <span class="st">"n"</span>, <span class="st">"%"</span><span class="op">)</span>
<span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
    <span class="fu"><a href="https://rdrr.io/pkg/kableExtra/man/kable_styling.html">kable_styling</a></span><span class="op">(</span>bootstrap_options <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"striped"</span>, <span class="st">"hover"</span>, <span class="st">"condensed"</span>, <span class="st">"responsive"</span><span class="op">)</span>, full_width <span class="op">=</span> <span class="cn">F</span>, position <span class="op">=</span> <span class="st">"left"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
    <span class="fu"><a href="https://rdrr.io/pkg/kableExtra/man/add_header_above.html">add_header_above</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">" "</span> <span class="op">=</span> <span class="fl">1</span>, <span class="st">"White"</span> <span class="op">=</span> <span class="fl">3</span>, <span class="st">"African American"</span> <span class="op">=</span> <span class="fl">3</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div class="inline-table"><table class="table table-striped table-hover table-condensed table-responsive" style="width: auto !important; ">
<thead>
<tr>
<th style="empty-cells: hide;border-bottom:hidden;" colspan="1">
</th>
<th style="border-bottom:hidden;padding-bottom:0; padding-left:3px;padding-right:3px;text-align: center; " colspan="3">
<div style="border-bottom: 1px solid #ddd; padding-bottom: 5px; ">
White
</div>
</th>
<th style="border-bottom:hidden;padding-bottom:0; padding-left:3px;padding-right:3px;text-align: center; " colspan="3">
<div style="border-bottom: 1px solid #ddd; padding-bottom: 5px; ">
African American
</div>
</th>
</tr>
<tr>
<th style="text-align:left;">
health
</th>
<th style="text-align:left;">
race
</th>
<th style="text-align:right;">
n
</th>
<th style="text-align:right;">
%
</th>
<th style="text-align:left;">
race
</th>
<th style="text-align:right;">
n
</th>
<th style="text-align:right;">
%
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
high
</td>
<td style="text-align:left;">
<ol start="0" style="list-style-type: decimal"><li>Not marked
</li></ol>
</td>
<td style="text-align:right;">
1486
</td>
<td style="text-align:right;">
33.36
</td>
<td style="text-align:left;">
<ol start="0" style="list-style-type: decimal"><li>Not marked
</li></ol>
</td>
<td style="text-align:right;">
3309
</td>
<td style="text-align:right;">
74.28
</td>
</tr>
<tr>
<td style="text-align:left;">
high
</td>
<td style="text-align:left;">
<ol style="list-style-type: decimal"><li>Marked
</li></ol>
</td>
<td style="text-align:right;">
2962
</td>
<td style="text-align:right;">
66.49
</td>
<td style="text-align:left;">
<ol style="list-style-type: decimal"><li>Marked
</li></ol>
</td>
<td style="text-align:right;">
1139
</td>
<td style="text-align:right;">
25.57
</td>
</tr>
<tr>
<td style="text-align:left;">
high
</td>
<td style="text-align:left;">
<ol start="6" style="list-style-type: decimal"><li>Refused
</li></ol>
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
0.04
</td>
<td style="text-align:left;">
<ol start="6" style="list-style-type: decimal"><li>Refused
</li></ol>
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
0.04
</td>
</tr>
<tr>
<td style="text-align:left;">
high
</td>
<td style="text-align:left;">
<ol start="8" style="list-style-type: decimal"><li>Don’t know
</li></ol>
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
0.11
</td>
<td style="text-align:left;">
<ol start="8" style="list-style-type: decimal"><li>Don’t know
</li></ol>
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
0.11
</td>
</tr>
<tr>
<td style="text-align:left;">
low
</td>
<td style="text-align:left;">
<ol start="0" style="list-style-type: decimal"><li>Not marked
</li></ol>
</td>
<td style="text-align:right;">
704
</td>
<td style="text-align:right;">
34.49
</td>
<td style="text-align:left;">
<ol start="0" style="list-style-type: decimal"><li>Not marked
</li></ol>
</td>
<td style="text-align:right;">
1553
</td>
<td style="text-align:right;">
76.09
</td>
</tr>
<tr>
<td style="text-align:left;">
low
</td>
<td style="text-align:left;">
<ol style="list-style-type: decimal"><li>Marked
</li></ol>
</td>
<td style="text-align:right;">
1328
</td>
<td style="text-align:right;">
65.07
</td>
<td style="text-align:left;">
<ol style="list-style-type: decimal"><li>Marked
</li></ol>
</td>
<td style="text-align:right;">
479
</td>
<td style="text-align:right;">
23.47
</td>
</tr>
<tr>
<td style="text-align:left;">
low
</td>
<td style="text-align:left;">
<ol start="6" style="list-style-type: decimal"><li>Refused
</li></ol>
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0.05
</td>
<td style="text-align:left;">
<ol start="6" style="list-style-type: decimal"><li>Refused
</li></ol>
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0.05
</td>
</tr>
<tr>
<td style="text-align:left;">
low
</td>
<td style="text-align:left;">
<ol start="8" style="list-style-type: decimal"><li>Don’t know
</li></ol>
</td>
<td style="text-align:right;">
8
</td>
<td style="text-align:right;">
0.39
</td>
<td style="text-align:left;">
<ol start="8" style="list-style-type: decimal"><li>Don’t know
</li></ol>
</td>
<td style="text-align:right;">
8
</td>
<td style="text-align:right;">
0.39
</td>
</tr>
<tr>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
<ol start="0" style="list-style-type: decimal"><li>Not marked
</li></ol>
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
12.50
</td>
<td style="text-align:left;">
<ol start="0" style="list-style-type: decimal"><li>Not marked
</li></ol>
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
50.00
</td>
</tr>
<tr>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
<ol style="list-style-type: decimal"><li>Marked
</li></ol>
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
50.00
</td>
<td style="text-align:left;">
<ol style="list-style-type: decimal"><li>Marked
</li></ol>
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
12.50
</td>
</tr>
<tr>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
<ol start="6" style="list-style-type: decimal"><li>Refused
</li></ol>
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
12.50
</td>
<td style="text-align:left;">
<ol start="6" style="list-style-type: decimal"><li>Refused
</li></ol>
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
12.50
</td>
</tr>
<tr>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
<ol start="8" style="list-style-type: decimal"><li>Don’t know
</li></ol>
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
25.00
</td>
<td style="text-align:left;">
<ol start="8" style="list-style-type: decimal"><li>Don’t know
</li></ol>
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
25.00
</td>
</tr>
</tbody>
</table></div>
<p>We could also add some row groupings:</p>
<div class="sourceCode" id="cb196"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">sum_health_white_afram</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
    <span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html">kable</a></span><span class="op">(</span>col.names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"race"</span>, <span class="st">"n"</span>, <span class="st">"%"</span>, <span class="st">"race"</span>, <span class="st">"n"</span>, <span class="st">"%"</span><span class="op">)</span>, align <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="st">"r"</span>, times <span class="op">=</span> <span class="fl">6</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
    <span class="fu"><a href="https://rdrr.io/pkg/kableExtra/man/kable_styling.html">kable_styling</a></span><span class="op">(</span>bootstrap_options <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"striped"</span>, <span class="st">"hover"</span>, <span class="st">"condensed"</span>, <span class="st">"responsive"</span><span class="op">)</span>, full_width <span class="op">=</span> <span class="cn">F</span>, position <span class="op">=</span> <span class="st">"left"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
    <span class="fu"><a href="https://rdrr.io/pkg/kableExtra/man/add_header_above.html">add_header_above</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"White"</span> <span class="op">=</span> <span class="fl">3</span>, <span class="st">"African American"</span> <span class="op">=</span> <span class="fl">3</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
    <span class="fu"><a href="https://rdrr.io/pkg/kableExtra/man/group_rows.html">pack_rows</a></span><span class="op">(</span><span class="st">"health high"</span>, <span class="fl">1</span>, <span class="fl">4</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
    <span class="fu"><a href="https://rdrr.io/pkg/kableExtra/man/group_rows.html">pack_rows</a></span><span class="op">(</span><span class="st">"health low"</span>, <span class="fl">5</span>, <span class="fl">8</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
    <span class="fu"><a href="https://rdrr.io/pkg/kableExtra/man/group_rows.html">pack_rows</a></span><span class="op">(</span><span class="st">"health N/A"</span>, <span class="fl">9</span>, <span class="fl">12</span><span class="op">)</span></code></pre></div>
<div class="inline-table"><table class="table table-striped table-hover table-condensed table-responsive" style="width: auto !important; ">
<thead>
<tr>
<th style="border-bottom:hidden;padding-bottom:0; padding-left:3px;padding-right:3px;text-align: center; " colspan="3">
<div style="border-bottom: 1px solid #ddd; padding-bottom: 5px; ">
White
</div>
</th>
<th style="border-bottom:hidden;padding-bottom:0; padding-left:3px;padding-right:3px;text-align: center; " colspan="3">
<div style="border-bottom: 1px solid #ddd; padding-bottom: 5px; ">
African American
</div>
</th>
</tr>
<tr>
<th style="text-align:right;">
race
</th>
<th style="text-align:right;">
n
</th>
<th style="text-align:right;">
%
</th>
<th style="text-align:right;">
race
</th>
<th style="text-align:right;">
n
</th>
<th style="text-align:right;">
%
</th>
</tr>
</thead>
<tbody>
<tr grouplength="4">
<td colspan="6" style="border-bottom: 1px solid;">
<strong>health high</strong>
</td>
</tr>
<tr>
<td style="text-align:right;padding-left: 2em;" indentlevel="1">
<ol start="0" style="list-style-type: decimal"><li>Not marked
</li></ol>
</td>
<td style="text-align:right;">
1486
</td>
<td style="text-align:right;">
33.36
</td>
<td style="text-align:right;">
<ol start="0" style="list-style-type: decimal"><li>Not marked
</li></ol>
</td>
<td style="text-align:right;">
3309
</td>
<td style="text-align:right;">
74.28
</td>
</tr>
<tr>
<td style="text-align:right;padding-left: 2em;" indentlevel="1">
<ol style="list-style-type: decimal"><li>Marked
</li></ol>
</td>
<td style="text-align:right;">
2962
</td>
<td style="text-align:right;">
66.49
</td>
<td style="text-align:right;">
<ol style="list-style-type: decimal"><li>Marked
</li></ol>
</td>
<td style="text-align:right;">
1139
</td>
<td style="text-align:right;">
25.57
</td>
</tr>
<tr>
<td style="text-align:right;padding-left: 2em;" indentlevel="1">
<ol start="6" style="list-style-type: decimal"><li>Refused
</li></ol>
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
0.04
</td>
<td style="text-align:right;">
<ol start="6" style="list-style-type: decimal"><li>Refused
</li></ol>
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
0.04
</td>
</tr>
<tr>
<td style="text-align:right;padding-left: 2em;" indentlevel="1">
<ol start="8" style="list-style-type: decimal"><li>Don’t know
</li></ol>
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
0.11
</td>
<td style="text-align:right;">
<ol start="8" style="list-style-type: decimal"><li>Don’t know
</li></ol>
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
0.11
</td>
</tr>
<tr grouplength="4">
<td colspan="6" style="border-bottom: 1px solid;">
<strong>health low</strong>
</td>
</tr>
<tr>
<td style="text-align:right;padding-left: 2em;" indentlevel="1">
<ol start="0" style="list-style-type: decimal"><li>Not marked
</li></ol>
</td>
<td style="text-align:right;">
704
</td>
<td style="text-align:right;">
34.49
</td>
<td style="text-align:right;">
<ol start="0" style="list-style-type: decimal"><li>Not marked
</li></ol>
</td>
<td style="text-align:right;">
1553
</td>
<td style="text-align:right;">
76.09
</td>
</tr>
<tr>
<td style="text-align:right;padding-left: 2em;" indentlevel="1">
<ol style="list-style-type: decimal"><li>Marked
</li></ol>
</td>
<td style="text-align:right;">
1328
</td>
<td style="text-align:right;">
65.07
</td>
<td style="text-align:right;">
<ol style="list-style-type: decimal"><li>Marked
</li></ol>
</td>
<td style="text-align:right;">
479
</td>
<td style="text-align:right;">
23.47
</td>
</tr>
<tr>
<td style="text-align:right;padding-left: 2em;" indentlevel="1">
<ol start="6" style="list-style-type: decimal"><li>Refused
</li></ol>
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0.05
</td>
<td style="text-align:right;">
<ol start="6" style="list-style-type: decimal"><li>Refused
</li></ol>
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0.05
</td>
</tr>
<tr>
<td style="text-align:right;padding-left: 2em;" indentlevel="1">
<ol start="8" style="list-style-type: decimal"><li>Don’t know
</li></ol>
</td>
<td style="text-align:right;">
8
</td>
<td style="text-align:right;">
0.39
</td>
<td style="text-align:right;">
<ol start="8" style="list-style-type: decimal"><li>Don’t know
</li></ol>
</td>
<td style="text-align:right;">
8
</td>
<td style="text-align:right;">
0.39
</td>
</tr>
<tr grouplength="4">
<td colspan="6" style="border-bottom: 1px solid;">
<strong>health N/A</strong>
</td>
</tr>
<tr>
<td style="text-align:right;padding-left: 2em;" indentlevel="1">
<ol start="0" style="list-style-type: decimal"><li>Not marked
</li></ol>
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
12.50
</td>
<td style="text-align:right;">
<ol start="0" style="list-style-type: decimal"><li>Not marked
</li></ol>
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
50.00
</td>
</tr>
<tr>
<td style="text-align:right;padding-left: 2em;" indentlevel="1">
<ol style="list-style-type: decimal"><li>Marked
</li></ol>
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
50.00
</td>
<td style="text-align:right;">
<ol style="list-style-type: decimal"><li>Marked
</li></ol>
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
12.50
</td>
</tr>
<tr>
<td style="text-align:right;padding-left: 2em;" indentlevel="1">
<ol start="6" style="list-style-type: decimal"><li>Refused
</li></ol>
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
12.50
</td>
<td style="text-align:right;">
<ol start="6" style="list-style-type: decimal"><li>Refused
</li></ol>
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
12.50
</td>
</tr>
<tr>
<td style="text-align:right;padding-left: 2em;" indentlevel="1">
<ol start="8" style="list-style-type: decimal"><li>Don’t know
</li></ol>
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
25.00
</td>
<td style="text-align:right;">
<ol start="8" style="list-style-type: decimal"><li>Don’t know
</li></ol>
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
25.00
</td>
</tr>
</tbody>
</table></div>
<p>Another simple example using the Babushkin data; the following code:</p>
<pre><code>```{r, eval=TRUE}`r ''`
etdata &lt;- read.csv("https://raw.githubusercontent.com/teuschb/hr_data/master/datasets/turnover_babushkin.csv")

# create 10-year age classes 
etdata %&lt;&gt;% 
    mutate(age_decade = plyr::round_any(age, 10, f = ceiling)) 

# summarize
etdata %&gt;% 
    # group by gender and age class
    group_by(gender, age_decade) %&gt;% 
    # mean and sd
    summarize(mean_tenure_months = mean(tenure) %&gt;% round(1),
              sd_tenure_months = sd(tenure) %&gt;% round(1), 
              .groups = "keep") %&gt;% 
    # order the output by age and gender
    arrange(gender, mean_tenure_months) %&gt;% 
    # print it nicely
    kable() %&gt;% 
    kable_styling(bootstrap_options = c("striped", "hover", "condensed"))
```</code></pre>
<p>… generates the following table
<!-- (Table  1) -->
:</p>
<!-- _Table  1: Babushkin data, tenure by gender and age_ -->
<div class="inline-table"><table class="table table-striped table-hover table-condensed" style="margin-left: auto; margin-right: auto;">
<thead><tr>
<th style="text-align:left;">
gender
</th>
<th style="text-align:right;">
age_decade
</th>
<th style="text-align:right;">
mean_tenure_months
</th>
<th style="text-align:right;">
sd_tenure_months
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:left;">
f
</td>
<td style="text-align:right;">
60
</td>
<td style="text-align:right;">
21.6
</td>
<td style="text-align:right;">
20.1
</td>
</tr>
<tr>
<td style="text-align:left;">
f
</td>
<td style="text-align:right;">
50
</td>
<td style="text-align:right;">
22.9
</td>
<td style="text-align:right;">
24.2
</td>
</tr>
<tr>
<td style="text-align:left;">
f
</td>
<td style="text-align:right;">
40
</td>
<td style="text-align:right;">
35.4
</td>
<td style="text-align:right;">
31.3
</td>
</tr>
<tr>
<td style="text-align:left;">
f
</td>
<td style="text-align:right;">
30
</td>
<td style="text-align:right;">
37.9
</td>
<td style="text-align:right;">
35.1
</td>
</tr>
<tr>
<td style="text-align:left;">
f
</td>
<td style="text-align:right;">
20
</td>
<td style="text-align:right;">
75.0
</td>
<td style="text-align:right;">
49.3
</td>
</tr>
<tr>
<td style="text-align:left;">
m
</td>
<td style="text-align:right;">
60
</td>
<td style="text-align:right;">
21.1
</td>
<td style="text-align:right;">
5.1
</td>
</tr>
<tr>
<td style="text-align:left;">
m
</td>
<td style="text-align:right;">
50
</td>
<td style="text-align:right;">
31.2
</td>
<td style="text-align:right;">
29.7
</td>
</tr>
<tr>
<td style="text-align:left;">
m
</td>
<td style="text-align:right;">
40
</td>
<td style="text-align:right;">
33.9
</td>
<td style="text-align:right;">
26.3
</td>
</tr>
<tr>
<td style="text-align:left;">
m
</td>
<td style="text-align:right;">
30
</td>
<td style="text-align:right;">
41.8
</td>
<td style="text-align:right;">
40.2
</td>
</tr>
<tr>
<td style="text-align:left;">
m
</td>
<td style="text-align:right;">
20
</td>
<td style="text-align:right;">
121.8
</td>
<td style="text-align:right;">
33.5
</td>
</tr>
</tbody>
</table></div>
</div>
<div id="stargazer" class="section level4" number="2.2.4.2">
<h4>
<span class="header-section-number">2.2.4.2</span> <code>stargazer</code><a class="anchor" aria-label="anchor" href="#stargazer"><i class="fas fa-link"></i></a>
</h4>
<p>The <a href="https://cran.r-project.org/web/packages/stargazer/vignettes/stargazer.pdf"><code>stargazer</code></a> package is especially good for PDF outputs, but is fairly limited for HTML output.</p>
<div class="sourceCode" id="cb198"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">stargazer</span><span class="op">(</span><span class="va">sum_health_white_afram</span>,
    type <span class="op">=</span> <span class="st">"html"</span>,
    summary <span class="op">=</span> <span class="cn">FALSE</span>,
    rownames <span class="op">=</span> <span class="cn">FALSE</span>
<span class="op">)</span></code></pre></div>
<div class="inline-table"><table style="text-align:center" class="table table-sm">
<tr>
<td colspan="7" style="border-bottom: 1px solid black">
</td>
</tr>
<tr>
<td style="text-align:left">
health…1
</td>
<td>
white
</td>
<td>
n…3
</td>
<td>
%…4
</td>
<td>
afram
</td>
<td>
n…7
</td>
<td>
%…8
</td>
</tr>
<tr>
<td colspan="7" style="border-bottom: 1px solid black">
</td>
</tr>
<tr>
<td style="text-align:left">
high
</td>
<td>
1
</td>
<td>
1486
</td>
<td>
33.36
</td>
<td>
1
</td>
<td>
3309
</td>
<td>
74.28
</td>
</tr>
<tr>
<td style="text-align:left">
high
</td>
<td>
2
</td>
<td>
2962
</td>
<td>
66.49
</td>
<td>
2
</td>
<td>
1139
</td>
<td>
25.57
</td>
</tr>
<tr>
<td style="text-align:left">
high
</td>
<td>
3
</td>
<td>
2
</td>
<td>
0.04
</td>
<td>
3
</td>
<td>
2
</td>
<td>
0.04
</td>
</tr>
<tr>
<td style="text-align:left">
high
</td>
<td>
4
</td>
<td>
5
</td>
<td>
0.11
</td>
<td>
4
</td>
<td>
5
</td>
<td>
0.11
</td>
</tr>
<tr>
<td style="text-align:left">
low
</td>
<td>
1
</td>
<td>
704
</td>
<td>
34.49
</td>
<td>
1
</td>
<td>
1553
</td>
<td>
76.09
</td>
</tr>
<tr>
<td style="text-align:left">
low
</td>
<td>
2
</td>
<td>
1328
</td>
<td>
65.07
</td>
<td>
2
</td>
<td>
479
</td>
<td>
23.47
</td>
</tr>
<tr>
<td style="text-align:left">
low
</td>
<td>
3
</td>
<td>
1
</td>
<td>
0.05
</td>
<td>
3
</td>
<td>
1
</td>
<td>
0.05
</td>
</tr>
<tr>
<td style="text-align:left">
low
</td>
<td>
4
</td>
<td>
8
</td>
<td>
0.39
</td>
<td>
4
</td>
<td>
8
</td>
<td>
0.39
</td>
</tr>
<tr>
<td style="text-align:left">
</td>
<td>
1
</td>
<td>
1
</td>
<td>
12.5
</td>
<td>
1
</td>
<td>
4
</td>
<td>
50
</td>
</tr>
<tr>
<td style="text-align:left">
</td>
<td>
2
</td>
<td>
4
</td>
<td>
50
</td>
<td>
2
</td>
<td>
1
</td>
<td>
12.5
</td>
</tr>
<tr>
<td style="text-align:left">
</td>
<td>
3
</td>
<td>
1
</td>
<td>
12.5
</td>
<td>
3
</td>
<td>
1
</td>
<td>
12.5
</td>
</tr>
<tr>
<td style="text-align:left">
</td>
<td>
4
</td>
<td>
2
</td>
<td>
25
</td>
<td>
4
</td>
<td>
2
</td>
<td>
25
</td>
</tr>
<tr>
<td colspan="7" style="border-bottom: 1px solid black">
</td>
</tr>
</table></div>
</div>
<div id="pander" class="section level4" number="2.2.4.3">
<h4>
<span class="header-section-number">2.2.4.3</span> <code>pander</code><a class="anchor" aria-label="anchor" href="#pander"><i class="fas fa-link"></i></a>
</h4>
<p><code>pander</code> can be used to create output HTML tables as well, although also with fewer options than <code>knitr</code> with <code>kableExtra</code>.</p>
<div class="sourceCode" id="cb199"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">pander</span><span class="op">(</span><span class="va">sum_health_white_afram</span><span class="op">)</span></code></pre></div>
<div class="inline-table"><table class="table table-sm">
<colgroup>
<col width="16%">
<col width="21%">
<col width="10%">
<col width="10%">
<col width="21%">
<col width="10%">
<col width="10%">
</colgroup>
<thead><tr class="header">
<th align="center">health…1</th>
<th align="center">white</th>
<th align="center">n…3</th>
<th align="center">%…4</th>
<th align="center">afram</th>
<th align="center">n…7</th>
<th align="center">%…8</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="center">high</td>
<td align="center">(0) Not marked</td>
<td align="center">1486</td>
<td align="center">33.36</td>
<td align="center">(0) Not marked</td>
<td align="center">3309</td>
<td align="center">74.28</td>
</tr>
<tr class="even">
<td align="center">high</td>
<td align="center">(1) Marked</td>
<td align="center">2962</td>
<td align="center">66.49</td>
<td align="center">(1) Marked</td>
<td align="center">1139</td>
<td align="center">25.57</td>
</tr>
<tr class="odd">
<td align="center">high</td>
<td align="center">(6) Refused</td>
<td align="center">2</td>
<td align="center">0.04</td>
<td align="center">(6) Refused</td>
<td align="center">2</td>
<td align="center">0.04</td>
</tr>
<tr class="even">
<td align="center">high</td>
<td align="center">(8) Don’t know</td>
<td align="center">5</td>
<td align="center">0.11</td>
<td align="center">(8) Don’t know</td>
<td align="center">5</td>
<td align="center">0.11</td>
</tr>
<tr class="odd">
<td align="center">low</td>
<td align="center">(0) Not marked</td>
<td align="center">704</td>
<td align="center">34.49</td>
<td align="center">(0) Not marked</td>
<td align="center">1553</td>
<td align="center">76.09</td>
</tr>
<tr class="even">
<td align="center">low</td>
<td align="center">(1) Marked</td>
<td align="center">1328</td>
<td align="center">65.07</td>
<td align="center">(1) Marked</td>
<td align="center">479</td>
<td align="center">23.47</td>
</tr>
<tr class="odd">
<td align="center">low</td>
<td align="center">(6) Refused</td>
<td align="center">1</td>
<td align="center">0.05</td>
<td align="center">(6) Refused</td>
<td align="center">1</td>
<td align="center">0.05</td>
</tr>
<tr class="even">
<td align="center">low</td>
<td align="center">(8) Don’t know</td>
<td align="center">8</td>
<td align="center">0.39</td>
<td align="center">(8) Don’t know</td>
<td align="center">8</td>
<td align="center">0.39</td>
</tr>
<tr class="odd">
<td align="center">NA</td>
<td align="center">(0) Not marked</td>
<td align="center">1</td>
<td align="center">12.5</td>
<td align="center">(0) Not marked</td>
<td align="center">4</td>
<td align="center">50</td>
</tr>
<tr class="even">
<td align="center">NA</td>
<td align="center">(1) Marked</td>
<td align="center">4</td>
<td align="center">50</td>
<td align="center">(1) Marked</td>
<td align="center">1</td>
<td align="center">12.5</td>
</tr>
<tr class="odd">
<td align="center">NA</td>
<td align="center">(6) Refused</td>
<td align="center">1</td>
<td align="center">12.5</td>
<td align="center">(6) Refused</td>
<td align="center">1</td>
<td align="center">12.5</td>
</tr>
<tr class="even">
<td align="center">NA</td>
<td align="center">(8) Don’t know</td>
<td align="center">2</td>
<td align="center">25</td>
<td align="center">(8) Don’t know</td>
<td align="center">2</td>
<td align="center">25</td>
</tr>
</tbody>
</table></div>
</div>
<div id="dtdatatable" class="section level4" number="2.2.4.4">
<h4>
<span class="header-section-number">2.2.4.4</span> <code>DT::datatable</code><a class="anchor" aria-label="anchor" href="#dtdatatable"><i class="fas fa-link"></i></a>
</h4>
<p><code><a href="https://rdrr.io/pkg/DT/man/datatable.html">DT::datatable</a></code> presents tables in an interactive format, allowing filtering by free text, sorting by columns, and displaying fewer or more records. Here, the table is loaded sorted in descending order of mean anxiety per industry. The <code><a href="https://rdrr.io/pkg/DT/man/datatable.html">DT::datatable</a></code> can be sorted interactively based on any of the columns.</p>
<div class="sourceCode" id="cb200"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">etdata</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">industry</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarize</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html">n</a></span><span class="op">(</span><span class="op">)</span>,
                     mean_anxiety <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">anxiety</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/desc.html">desc</a></span><span class="op">(</span><span class="va">mean_anxiety</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
<span class="fu">DT</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/DT/man/datatable.html">datatable</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<div id="htmlwidget-1f69820b8c30c3a8ce9e" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-1f69820b8c30c3a8ce9e">{"x":{"filter":"none","vertical":false,"data":[["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16"],["PowerGeneration","Mining","Pharma","Telecom","IT","manufacture","Agriculture","etc","Retail","Banks","Consult","State","RealEstate","Building","transport"," HoReCa"],[38,24,20,36,122,145,15,94,289,114,74,55,13,41,38,11],[6.3,6.1,5.9,5.9,5.8,5.8,5.7,5.7,5.7,5.4,5.4,5.4,5.3,5.2,5.2,4.8]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>industry<\/th>\n      <th>n<\/th>\n      <th>mean_anxiety<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":[2,3]},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
</div>
<div id="flextable" class="section level4" number="2.2.4.5">
<h4>
<span class="header-section-number">2.2.4.5</span> <code>flextable</code><a class="anchor" aria-label="anchor" href="#flextable"><i class="fas fa-link"></i></a>
</h4>
<p><a href="https://ardata-fr.github.io/flextable-book/index.html"><code>flextable</code></a> is a full-featured package for fine control over table display. You can merge cells, add header rows, add footer rows, change any format and specify how data should be displayed in cells. Tables content can also contain mixed type of content, text and images.</p>
<p>The example shows a fairly simple output:</p>
<div class="sourceCode" id="cb201"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">ft</span> <span class="op">&lt;-</span> <span class="fu">flextable</span><span class="op">(</span><span class="va">airquality</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/sample.html">sample.int</a></span><span class="op">(</span><span class="fl">10</span><span class="op">)</span>, <span class="op">]</span><span class="op">)</span>
<span class="va">ft</span> <span class="op">&lt;-</span> <span class="fu">add_header_row</span><span class="op">(</span><span class="va">ft</span>,
    colwidths <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">4</span>, <span class="fl">2</span><span class="op">)</span>,
    values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Air quality"</span>, <span class="st">"Time"</span><span class="op">)</span>
<span class="op">)</span>
<span class="va">ft</span> <span class="op">&lt;-</span> <span class="fu">theme_vanilla</span><span class="op">(</span><span class="va">ft</span><span class="op">)</span>
<span class="va">ft</span> <span class="op">&lt;-</span> <span class="fu">add_footer_lines</span><span class="op">(</span><span class="va">ft</span>, <span class="st">"Daily air quality measurements in New York, May to September 1973."</span><span class="op">)</span>
<span class="va">ft</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes_colour_fill_alpha.html">color</a></span><span class="op">(</span><span class="va">ft</span>, part <span class="op">=</span> <span class="st">"footer"</span>, color <span class="op">=</span> <span class="st">"#666666"</span><span class="op">)</span>
<span class="va">ft</span> <span class="op">&lt;-</span> <span class="fu">set_caption</span><span class="op">(</span><span class="va">ft</span>, caption <span class="op">=</span> <span class="st">"New York Air Quality Measurements"</span><span class="op">)</span>
<span class="va">ft</span></code></pre></div>
<template id="d4714769-3f6c-4bb3-a3a6-1b883e08062b"><style>
.tabwid table{
  border-spacing:0px !important;
  border-collapse:collapse;
  line-height:1;
  margin-left:auto;
  margin-right:auto;
  border-width: 0;
  display: table;
  margin-top: 1.275em;
  margin-bottom: 1.275em;
  border-color: transparent;
}
.tabwid_left table{
  margin-left:0;
}
.tabwid_right table{
  margin-right:0;
}
.tabwid td {
    padding: 0;
}
.tabwid a {
  text-decoration: none;
}
.tabwid thead {
    background-color: transparent;
}
.tabwid tfoot {
    background-color: transparent;
}
.tabwid table tr {
background-color: transparent;
}
</style>
<div class="tabwid">
<style>.cl-3e1bfe42{}.cl-3e15953e{font-family:'Arial';font-size:11pt;font-weight:bold;font-style:normal;text-decoration:none;color:rgba(0, 0, 0, 1.00);background-color:transparent;}.cl-3e15953f{font-family:'Arial';font-size:11pt;font-weight:normal;font-style:normal;text-decoration:none;color:rgba(0, 0, 0, 1.00);background-color:transparent;}.cl-3e159540{font-family:'Arial';font-size:11pt;font-weight:normal;font-style:normal;text-decoration:none;color:rgba(102, 102, 102, 1.00);background-color:transparent;}.cl-3e15bc58{margin:0;text-align:right;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:5pt;padding-top:5pt;padding-left:5pt;padding-right:5pt;line-height: 1;background-color:transparent;}.cl-3e15bc59{margin:0;text-align:left;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:5pt;padding-top:5pt;padding-left:5pt;padding-right:5pt;line-height: 1;background-color:transparent;}.cl-3e15e368{width:54pt;background-color:transparent;vertical-align: middle;border-bottom: 0.5pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-3e15e369{width:54pt;background-color:transparent;vertical-align: middle;border-bottom: 2pt solid rgba(102, 102, 102, 1.00);border-top: 0.5pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-3e15e36a{width:54pt;background-color:transparent;vertical-align: middle;border-bottom: 0.5pt solid rgba(102, 102, 102, 1.00);border-top: 0.5pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-3e15e36b{width:54pt;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(255, 255, 255, 0.00);border-top: 0 solid rgba(255, 255, 255, 0.00);border-left: 0 solid rgba(255, 255, 255, 0.00);border-right: 0 solid rgba(255, 255, 255, 0.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-3e15e36c{width:54pt;background-color:transparent;vertical-align: middle;border-bottom: 0.5pt solid rgba(102, 102, 102, 1.00);border-top: 2pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}</style>
<div class="inline-table"><table class="cl-3e1bfe42">
<caption class="Table Caption">
<p><span id="tab:unnamed-chunk-30">Table 2.1: </span>New York Air Quality Measurements</p>
</caption>
<thead>
<tr style="overflow-wrap:break-word;">
<td colspan="4" class="cl-3e15e36c"><p class="cl-3e15bc58"><span class="cl-3e15953e">Air quality</span></p></td>
<td colspan="2" class="cl-3e15e36c"><p class="cl-3e15bc58"><span class="cl-3e15953e">Time</span></p></td>
</tr>
<tr style="overflow-wrap:break-word;">
<td class="cl-3e15e369"><p class="cl-3e15bc58"><span class="cl-3e15953e">Ozone</span></p></td>
<td class="cl-3e15e369"><p class="cl-3e15bc58"><span class="cl-3e15953e">Solar.R</span></p></td>
<td class="cl-3e15e369"><p class="cl-3e15bc58"><span class="cl-3e15953e">Wind</span></p></td>
<td class="cl-3e15e369"><p class="cl-3e15bc58"><span class="cl-3e15953e">Temp</span></p></td>
<td class="cl-3e15e369"><p class="cl-3e15bc58"><span class="cl-3e15953e">Month</span></p></td>
<td class="cl-3e15e369"><p class="cl-3e15bc58"><span class="cl-3e15953e">Day</span></p></td>
</tr>
</thead>
<tbody>
<tr style="overflow-wrap:break-word;">
<td class="cl-3e15e368"><p class="cl-3e15bc58"><span class="cl-3e15953f"></span></p></td>
<td class="cl-3e15e368"><p class="cl-3e15bc58"><span class="cl-3e15953f">194</span></p></td>
<td class="cl-3e15e368"><p class="cl-3e15bc58"><span class="cl-3e15953f">8.6</span></p></td>
<td class="cl-3e15e368"><p class="cl-3e15bc58"><span class="cl-3e15953f">69</span></p></td>
<td class="cl-3e15e368"><p class="cl-3e15bc58"><span class="cl-3e15953f">5</span></p></td>
<td class="cl-3e15e368"><p class="cl-3e15bc58"><span class="cl-3e15953f">10</span></p></td>
</tr>
<tr style="overflow-wrap:break-word;">
<td class="cl-3e15e36a"><p class="cl-3e15bc58"><span class="cl-3e15953f">12</span></p></td>
<td class="cl-3e15e36a"><p class="cl-3e15bc58"><span class="cl-3e15953f">149</span></p></td>
<td class="cl-3e15e36a"><p class="cl-3e15bc58"><span class="cl-3e15953f">12.6</span></p></td>
<td class="cl-3e15e36a"><p class="cl-3e15bc58"><span class="cl-3e15953f">74</span></p></td>
<td class="cl-3e15e36a"><p class="cl-3e15bc58"><span class="cl-3e15953f">5</span></p></td>
<td class="cl-3e15e36a"><p class="cl-3e15bc58"><span class="cl-3e15953f">3</span></p></td>
</tr>
<tr style="overflow-wrap:break-word;">
<td class="cl-3e15e36a"><p class="cl-3e15bc58"><span class="cl-3e15953f">18</span></p></td>
<td class="cl-3e15e36a"><p class="cl-3e15bc58"><span class="cl-3e15953f">313</span></p></td>
<td class="cl-3e15e36a"><p class="cl-3e15bc58"><span class="cl-3e15953f">11.5</span></p></td>
<td class="cl-3e15e36a"><p class="cl-3e15bc58"><span class="cl-3e15953f">62</span></p></td>
<td class="cl-3e15e36a"><p class="cl-3e15bc58"><span class="cl-3e15953f">5</span></p></td>
<td class="cl-3e15e36a"><p class="cl-3e15bc58"><span class="cl-3e15953f">4</span></p></td>
</tr>
<tr style="overflow-wrap:break-word;">
<td class="cl-3e15e36a"><p class="cl-3e15bc58"><span class="cl-3e15953f"></span></p></td>
<td class="cl-3e15e36a"><p class="cl-3e15bc58"><span class="cl-3e15953f"></span></p></td>
<td class="cl-3e15e36a"><p class="cl-3e15bc58"><span class="cl-3e15953f">14.3</span></p></td>
<td class="cl-3e15e36a"><p class="cl-3e15bc58"><span class="cl-3e15953f">56</span></p></td>
<td class="cl-3e15e36a"><p class="cl-3e15bc58"><span class="cl-3e15953f">5</span></p></td>
<td class="cl-3e15e36a"><p class="cl-3e15bc58"><span class="cl-3e15953f">5</span></p></td>
</tr>
<tr style="overflow-wrap:break-word;">
<td class="cl-3e15e36a"><p class="cl-3e15bc58"><span class="cl-3e15953f">41</span></p></td>
<td class="cl-3e15e36a"><p class="cl-3e15bc58"><span class="cl-3e15953f">190</span></p></td>
<td class="cl-3e15e36a"><p class="cl-3e15bc58"><span class="cl-3e15953f">7.4</span></p></td>
<td class="cl-3e15e36a"><p class="cl-3e15bc58"><span class="cl-3e15953f">67</span></p></td>
<td class="cl-3e15e36a"><p class="cl-3e15bc58"><span class="cl-3e15953f">5</span></p></td>
<td class="cl-3e15e36a"><p class="cl-3e15bc58"><span class="cl-3e15953f">1</span></p></td>
</tr>
<tr style="overflow-wrap:break-word;">
<td class="cl-3e15e36a"><p class="cl-3e15bc58"><span class="cl-3e15953f">19</span></p></td>
<td class="cl-3e15e36a"><p class="cl-3e15bc58"><span class="cl-3e15953f">99</span></p></td>
<td class="cl-3e15e36a"><p class="cl-3e15bc58"><span class="cl-3e15953f">13.8</span></p></td>
<td class="cl-3e15e36a"><p class="cl-3e15bc58"><span class="cl-3e15953f">59</span></p></td>
<td class="cl-3e15e36a"><p class="cl-3e15bc58"><span class="cl-3e15953f">5</span></p></td>
<td class="cl-3e15e36a"><p class="cl-3e15bc58"><span class="cl-3e15953f">8</span></p></td>
</tr>
<tr style="overflow-wrap:break-word;">
<td class="cl-3e15e36a"><p class="cl-3e15bc58"><span class="cl-3e15953f">28</span></p></td>
<td class="cl-3e15e36a"><p class="cl-3e15bc58"><span class="cl-3e15953f"></span></p></td>
<td class="cl-3e15e36a"><p class="cl-3e15bc58"><span class="cl-3e15953f">14.9</span></p></td>
<td class="cl-3e15e36a"><p class="cl-3e15bc58"><span class="cl-3e15953f">66</span></p></td>
<td class="cl-3e15e36a"><p class="cl-3e15bc58"><span class="cl-3e15953f">5</span></p></td>
<td class="cl-3e15e36a"><p class="cl-3e15bc58"><span class="cl-3e15953f">6</span></p></td>
</tr>
<tr style="overflow-wrap:break-word;">
<td class="cl-3e15e36a"><p class="cl-3e15bc58"><span class="cl-3e15953f">8</span></p></td>
<td class="cl-3e15e36a"><p class="cl-3e15bc58"><span class="cl-3e15953f">19</span></p></td>
<td class="cl-3e15e36a"><p class="cl-3e15bc58"><span class="cl-3e15953f">20.1</span></p></td>
<td class="cl-3e15e36a"><p class="cl-3e15bc58"><span class="cl-3e15953f">61</span></p></td>
<td class="cl-3e15e36a"><p class="cl-3e15bc58"><span class="cl-3e15953f">5</span></p></td>
<td class="cl-3e15e36a"><p class="cl-3e15bc58"><span class="cl-3e15953f">9</span></p></td>
</tr>
<tr style="overflow-wrap:break-word;">
<td class="cl-3e15e36a"><p class="cl-3e15bc58"><span class="cl-3e15953f">23</span></p></td>
<td class="cl-3e15e36a"><p class="cl-3e15bc58"><span class="cl-3e15953f">299</span></p></td>
<td class="cl-3e15e36a"><p class="cl-3e15bc58"><span class="cl-3e15953f">8.6</span></p></td>
<td class="cl-3e15e36a"><p class="cl-3e15bc58"><span class="cl-3e15953f">65</span></p></td>
<td class="cl-3e15e36a"><p class="cl-3e15bc58"><span class="cl-3e15953f">5</span></p></td>
<td class="cl-3e15e36a"><p class="cl-3e15bc58"><span class="cl-3e15953f">7</span></p></td>
</tr>
<tr style="overflow-wrap:break-word;">
<td class="cl-3e15e369"><p class="cl-3e15bc58"><span class="cl-3e15953f">36</span></p></td>
<td class="cl-3e15e369"><p class="cl-3e15bc58"><span class="cl-3e15953f">118</span></p></td>
<td class="cl-3e15e369"><p class="cl-3e15bc58"><span class="cl-3e15953f">8.0</span></p></td>
<td class="cl-3e15e369"><p class="cl-3e15bc58"><span class="cl-3e15953f">72</span></p></td>
<td class="cl-3e15e369"><p class="cl-3e15bc58"><span class="cl-3e15953f">5</span></p></td>
<td class="cl-3e15e369"><p class="cl-3e15bc58"><span class="cl-3e15953f">2</span></p></td>
</tr>
</tbody>
<tfoot><tr style="overflow-wrap:break-word;"><td colspan="6" class="cl-3e15e36b"><p class="cl-3e15bc59"><span class="cl-3e159540">Daily air quality measurements in New York, May to September 1973.</span></p></td></tr></tfoot>
</table></div>
</div></template><div class="flextable-shadow-host" id="f3375e38-e24d-4ed0-9b19-a2c143b6d534"></div>
<script>
var dest = document.getElementById("f3375e38-e24d-4ed0-9b19-a2c143b6d534");
var template = document.getElementById("d4714769-3f6c-4bb3-a3a6-1b883e08062b");
var caption = template.content.querySelector("caption");
if(caption) {
  caption.style.cssText = "display:block;text-align:center;";
  var newcapt = document.createElement("p");
  newcapt.appendChild(caption)
  dest.parentNode.insertBefore(newcapt, dest.previousSibling);
}
var fantome = dest.attachShadow({mode: 'open'});
var templateContent = template.content;
fantome.appendChild(templateContent);
</script><p>A more advanced application (see <a href="https://ardata-fr.github.io/flextable-book/programming.html#looping-over-columns-with-compose">Looping over columns with compose</a>):</p>
<div class="sourceCode" id="cb202"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">diamond_dat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tidyr.tidyverse.org/reference/nest.html">nest</a></span><span class="op">(</span><span class="va">diamonds</span>, data <span class="op">=</span> <span class="op">-</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/all_of.html">all_of</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"cut"</span>, <span class="st">"color"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>
    gg <span class="op">=</span> 
      <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span><span class="op">(</span>
        X <span class="op">=</span> <span class="va">data</span>, 
        FUN <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">subdat</span><span class="op">)</span> <span class="op">{</span>
          <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">subdat</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
            <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_density.html">geom_density</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">"white"</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_minimal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
            <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_x_continuous</a></span><span class="op">(</span>limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">11</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
            <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_y_continuous</a></span><span class="op">(</span>limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
            <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">""</span>, y <span class="op">=</span> <span class="st">""</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_void</a></span><span class="op">(</span><span class="op">)</span>
        <span class="op">}</span>
      <span class="op">)</span>
  <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">data</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_wider.html">pivot_wider</a></span><span class="op">(</span>
    id_cols <span class="op">=</span> <span class="va">cut</span>, 
    names_from <span class="op">=</span> <span class="va">color</span>, 
    values_from <span class="op">=</span> <span class="va">gg</span><span class="op">)</span>

<span class="va">diamond_dat</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu">flextable</span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu">mk_par</span><span class="op">(</span>
    value <span class="op">=</span> <span class="fu">as_paragraph</span><span class="op">(</span>
      <span class="fu">gg_chunk</span><span class="op">(</span><span class="va">.</span>, width <span class="op">=</span> <span class="fl">1</span>, height <span class="op">=</span> <span class="fl">1</span>, unit <span class="op">=</span> <span class="st">"cm"</span><span class="op">)</span><span class="op">)</span>, 
    j <span class="op">=</span> <span class="op">~</span> <span class="va">.</span> <span class="op">-</span> <span class="va">cut</span>,
    use_dot <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu">theme_tron</span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu">align</span><span class="op">(</span>align <span class="op">=</span> <span class="st">"center"</span>, part <span class="op">=</span> <span class="st">"all"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu">autofit</span><span class="op">(</span><span class="op">)</span></code></pre></div>
<template id="6a07cc38-e95d-44ca-9da2-de87a4331229"><style>
.tabwid table{
  border-spacing:0px !important;
  border-collapse:collapse;
  line-height:1;
  margin-left:auto;
  margin-right:auto;
  border-width: 0;
  display: table;
  margin-top: 1.275em;
  margin-bottom: 1.275em;
  border-color: transparent;
}
.tabwid_left table{
  margin-left:0;
}
.tabwid_right table{
  margin-right:0;
}
.tabwid td {
    padding: 0;
}
.tabwid a {
  text-decoration: none;
}
.tabwid thead {
    background-color: transparent;
}
.tabwid tfoot {
    background-color: transparent;
}
.tabwid table tr {
background-color: transparent;
}
</style>
<div class="tabwid">
<style>.cl-3f51aa32{}.cl-3f47977c{font-family:'Arial';font-size:11pt;font-weight:bold;font-style:normal;text-decoration:none;color:rgba(236, 147, 70, 1.00);background-color:transparent;}.cl-3f47977d{font-family:'Arial';font-size:11pt;font-weight:normal;font-style:normal;text-decoration:none;color:rgba(164, 206, 229, 1.00);background-color:transparent;}.cl-3f47977e{margin:0;text-align:center;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:5pt;padding-top:5pt;padding-left:5pt;padding-right:5pt;line-height: 1;background-color:transparent;}.cl-3f47be8c{width:48.9pt;background-color:rgba(0, 0, 0, 1.00);vertical-align: middle;border-bottom: 1pt solid rgba(164, 206, 229, 1.00);border-top: 1pt solid rgba(164, 206, 229, 1.00);border-left: 1pt solid rgba(164, 206, 229, 1.00);border-right: 1pt solid rgba(164, 206, 229, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-3f47be8d{width:119.5pt;background-color:rgba(0, 0, 0, 1.00);vertical-align: middle;border-bottom: 1pt solid rgba(164, 206, 229, 1.00);border-top: 1pt solid rgba(164, 206, 229, 1.00);border-left: 1pt solid rgba(164, 206, 229, 1.00);border-right: 1pt solid rgba(164, 206, 229, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-3f47be8e{width:119.5pt;background-color:rgba(0, 0, 0, 1.00);vertical-align: middle;border-bottom: 1pt solid rgba(164, 206, 229, 1.00);border-top: 1pt solid rgba(164, 206, 229, 1.00);border-left: 1pt solid rgba(164, 206, 229, 1.00);border-right: 1pt solid rgba(164, 206, 229, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-3f47be8f{width:48.9pt;background-color:rgba(0, 0, 0, 1.00);vertical-align: middle;border-bottom: 1pt solid rgba(164, 206, 229, 1.00);border-top: 1pt solid rgba(164, 206, 229, 1.00);border-left: 1pt solid rgba(164, 206, 229, 1.00);border-right: 1pt solid rgba(164, 206, 229, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}</style>
<div class="inline-table"><table class="cl-3f51aa32">
<thead><tr style="overflow-wrap:break-word;">
<td class="cl-3f47be8e"><p class="cl-3f47977e"><span class="cl-3f47977c">cut</span></p></td>
<td class="cl-3f47be8f"><p class="cl-3f47977e"><span class="cl-3f47977c">E</span></p></td>
<td class="cl-3f47be8f"><p class="cl-3f47977e"><span class="cl-3f47977c">I</span></p></td>
<td class="cl-3f47be8f"><p class="cl-3f47977e"><span class="cl-3f47977c">J</span></p></td>
<td class="cl-3f47be8f"><p class="cl-3f47977e"><span class="cl-3f47977c">H</span></p></td>
<td class="cl-3f47be8f"><p class="cl-3f47977e"><span class="cl-3f47977c">F</span></p></td>
<td class="cl-3f47be8f"><p class="cl-3f47977e"><span class="cl-3f47977c">G</span></p></td>
<td class="cl-3f47be8f"><p class="cl-3f47977e"><span class="cl-3f47977c">D</span></p></td>
</tr></thead>
<tbody>
<tr style="overflow-wrap:break-word;">
<td class="cl-3f47be8d"><p class="cl-3f47977e"><span class="cl-3f47977d">Ideal</span></p></td>
<td class="cl-3f47be8c"><div class="inline-figure"><img style="vertical-align:middle;width:28pt;height:28pt;" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAHYAAAB2CAMAAAAqeZcjAAAACVBMVEX9/v39/v3///8hKJz/AAAAA3RSTlP/AP9p7B++AAAACXBIWXMAAC4jAAAuIwF4pT92AAAA5ElEQVRoge3X2woDIQxFUfX/P7pQaHGgHXNj7JnuPApmmSBeWt8SDRYWFhYWFhYWFhYWFvbX2DHGBnbsYytc2IUKCwubYQtcWFhYWNgqNu8qsE8RFvZWbI4OstmSpdj0WeVnOywsrB5b8bTJsAlXiC3oshI70ZvYoCvAHpT/YnN7Ks3GXDl27rLbTrCvkUjN4qzTzbOhnSXJhj9Eyqz/36nJ9tuyJ7k3sW4XVof1urWsmbaz5/U4z+Yq1unWsya3jJ2v/DXdPsz5HstlWXM0B2ppnzFLNWvI5WUtqoF+s9cH7AXxABVCOqtnj3hGAAAAAElFTkSuQmCC"></div></td>
<td class="cl-3f47be8c"><div class="inline-figure"><img style="vertical-align:middle;width:28pt;height:28pt;" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAHYAAAB2CAMAAAAqeZcjAAAACVBMVEX9/v39/v3///8hKJz/AAAAA3RSTlP/AP9p7B++AAAACXBIWXMAAC4jAAAuIwF4pT92AAABCUlEQVRoge3W4Q7CIAxG0a3v/9AaTQaog36sQNTbXwtpOLTAtm1fEhssLCwsLCwsLCwsLCwsLCwsLCwsLCwsLCwsLCwsLCws7ELWVrB2j79hzWJc2JYa4Eax4kpCWL0DX8O+X92O/ZbY5+wnrOReYx8PPce7gz1cS8uYyFrGqu/qy6xNYxOU+iu2uZu1khXLvcbuJet3u9ikZYdYchW2uLA5WwyNZIuxlw7MYD8vYSoruKGs/xbFsy43lnWXO4D1lCywrkqc7o+wTjec9aWOY6u5flb6sC1ka9mD2Fb2SLaSPoptpLtZUW38bGx5UisU9nTKxPrQINZUVlLr5QqsqJ7Oe7DzA3ZC3AD8MDlC46KdEQAAAABJRU5ErkJggg=="></div></td>
<td class="cl-3f47be8c"><div class="inline-figure"><img style="vertical-align:middle;width:28pt;height:28pt;" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAHYAAAB2CAMAAAAqeZcjAAAACVBMVEX9/v39/v3///8hKJz/AAAAA3RSTlP/AP9p7B++AAAACXBIWXMAAC4jAAAuIwF4pT92AAABBUlEQVRoge3W0Q6DIAyFYe37P/SyxG2yAe0xFLLt75XRY78QoXHbl9QGCwsLCwsLCwsLCwsLCwsLCwsLCwsLCwsLCwsLCwsLCwu7lDVbwNq9/oU1U90vZs1kdxS7L2Tj7gD28H6T/Wj/uKG4MvuxZ20dW/p5rJU33q+Gs+VkKA/sBNb2ynSKu1fYo71V2ZgrsidwPnsSW9srlW09H8yWZ3QVWw9E4ItsNxGAk1jPHc0GXYmNfbeIm8BGxkYK67s5rJtU2LjqLjeJ9bKZbCecxTphgZVUZ7lpbN+Ns/Ffh1O+9YLGCmp/SG5FxCuJbTR9sUFUVHtuKltvLLIy2mj9ZOcX7IS6ARMTOQJ7b+bAAAAAAElFTkSuQmCC"></div></td>
<td class="cl-3f47be8c"><div class="inline-figure"><img style="vertical-align:middle;width:28pt;height:28pt;" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAHYAAAB2CAMAAAAqeZcjAAAACVBMVEX9/v39/v3///8hKJz/AAAAA3RSTlP/AP9p7B++AAAACXBIWXMAAC4jAAAuIwF4pT92AAAA/0lEQVRoge3WwRKDIAxFUcj/f3Q3HUuplTyIMOrNTmTe0QwiKS+pBAsLCwsLCwsLCwsLCwsLCwsLCwsLCwsLCwsLO4c1swWsWYx7CdZgZ7EBLixsqT6c1R9FZvcMvQURbEfnYUW2Z31fhv1xn8Da1+iZ7Du7ZqzD7WArd7/z92HzIna7sLyCLUHNHWVtMvv5bj7r7MZsQS9kNXeMzRPYvdxq23C7g2w5qLijbHXf6wayihvJCm0OZf2rOZZ1u37WlbiQ9cwLZr3HyLPYxtRo1umGs9m1bbhZ6QfTdM9hmy+cymmtUtn/IcmPSgfhRorCCupRpshK6kHqxs4v2An1AnAoOcZZ5UTlAAAAAElFTkSuQmCC"></div></td>
<td class="cl-3f47be8c"><div class="inline-figure"><img style="vertical-align:middle;width:28pt;height:28pt;" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAHYAAAB2CAMAAAAqeZcjAAAACVBMVEX9/v39/v3///8hKJz/AAAAA3RSTlP/AP9p7B++AAAACXBIWXMAAC4jAAAuIwF4pT92AAAA6UlEQVRoge3X0Q6DIAyFYeT9H3q7UTKz6SkFCvPvLeR8VGyMaQupBAsLCwsLCwsLCwsLCwsLCwsLCwsLC9uFzRFsftd4NsN2Z3Mk28CFhX0w63dhL9U2nz7YaVm3a2ebtFvJemkH63Fh52RbvFMLsg7Xx+6y+QA1bHHLMYJYo2thP9ILW3PP1ez2SLZumOrZMw0Luy57zKzVhZ2L/RodyP5c7MdKi3/JGtxW7P7vG8HqHevsXWYsq7nLswc9npXHV2a1RtQnbWLFbQKcTrsvy8JehyQd1W5NS7GwiirQRlZWbxIPdnzBDqgXRdM6JUSR5BMAAAAASUVORK5CYII="></div></td>
<td class="cl-3f47be8c"><div class="inline-figure"><img style="vertical-align:middle;width:28pt;height:28pt;" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAHYAAAB2CAMAAAAqeZcjAAAACVBMVEX9/v39/v3///8hKJz/AAAAA3RSTlP/AP9p7B++AAAACXBIWXMAAC4jAAAuIwF4pT92AAAA/0lEQVRoge3XQRKDIAxAUcj9D91ubEEcTSAmY/uzYpTJE5CIpaZEgYWFhYWFhYWFhYWFhYWFhYWFhYWFhfVn5R1JrIf7CFZgYe9gHVxYWNgoVvJYny89LOzArtGT7OqQ7azL7l1gpb2RwE6MfYIdZjmHnVnpB7H1iLW5U+zYjGKb9l+xU0XLwnbJO9Zco2FVbLeJg9mtZkWzEs5uboMHsu1Uh7BdpYhkazprdGH1bHN6S2Jt50cDe5R2z2rdRbZ+r4nFXWV39xNYy/K6svrX+SdYtatnVRkTWY3rzB796oey553L0PsktE93naToUSdWbmGvcSurV09zftj4gA2IF4qNOjg1FaSwAAAAAElFTkSuQmCC"></div></td>
<td class="cl-3f47be8c"><div class="inline-figure"><img style="vertical-align:middle;width:28pt;height:28pt;" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAHYAAAB2CAMAAAAqeZcjAAAACVBMVEX9/v39/v3///8hKJz/AAAAA3RSTlP/AP9p7B++AAAACXBIWXMAAC4jAAAuIwF4pT92AAAA/ElEQVRoge3Z0Q6DMAiF4cr7P/SudNlmJnBIK/HnysTIJ43FVse2JAYsLCwsLCwsLCwsbFfWzBawto6tcGFvxxosLGxTtsCFhYWFhYVNqAVumK3ZBqVZjU6yasmtWPm5EljFhYVdzpbMIFjYM1Zw+7AVowx7xW57j5zMfh8/g83LKpt0u7HaKEfYT+VZrPS5VWCV3zMSm+8ZrdmwXcEmau7LZiZSWzbVrTQ2vXgtY2MubJiNz1yR3V9CUff+7HlqO/YnU9n3uYhbxEbLbc4GF5LVrNMtZ32un71KGeqT4+eaf+G5NVeOEUAdZXiTFLOeVGH2WvVkO9j5ATshXq1dOt1v+JwOAAAAAElFTkSuQmCC"></div></td>
</tr>
<tr style="overflow-wrap:break-word;">
<td class="cl-3f47be8d"><p class="cl-3f47977e"><span class="cl-3f47977d">Premium</span></p></td>
<td class="cl-3f47be8c"><div class="inline-figure"><img style="vertical-align:middle;width:28pt;height:28pt;" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAHYAAAB2CAMAAAAqeZcjAAAACVBMVEX9/v39/v3///8hKJz/AAAAA3RSTlP/AP9p7B++AAAACXBIWXMAAC4jAAAuIwF4pT92AAAA60lEQVRoge3W0QrDIAyFYc37P/RgUHFj0xMX65Q/l7acz0CjTXlJJVhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWNhzWDNbwJqFuHuwZjEu7N+xTzLChe2wEW4I69/EKGvvi/PZvJC1es3tutiSX0vns5U7dlwOsuWbvlin+wv7UkeztTswubuxeSH7+bScykoPItjv4bDnsm4Xdh/2un8nsM2OnPdfNCu6Uayz3XBWc8NY9RUvq0QuYmX3HFZxg1l1jmRWbEOco2i2/o/tsyaVvL9uSNJRx83WjZnDNhOdrENtZhb2/oK9oR6piTlx3BJ/JAAAAABJRU5ErkJggg=="></div></td>
<td class="cl-3f47be8c"><div class="inline-figure"><img style="vertical-align:middle;width:28pt;height:28pt;" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAHYAAAB2CAMAAAAqeZcjAAAACVBMVEX9/v39/v3///8hKJz/AAAAA3RSTlP/AP9p7B++AAAACXBIWXMAAC4jAAAuIwF4pT92AAABFklEQVRoge3V7Q7CIAyF4cn9X7TxY3MyKD2zQNS3v2bTnSdkDS6XKbXAwsLCwsLCwsLCwsLCwsLCwsLCwsLCwsLCwsLCwsLCwsI+K01g060msYobwqakur/A+t0I9gH+Fyu5OnuIXjnl66psIXoAW4reWoJ7hk3HXv7Un901/MfV2NKtsG9MZF3uKTblPXOgC/v+03s7S+w9z2S9x41mna7OHj9mcc52v5OtAD3Y7DYs5Yeya9gWWl+elvsJa6xsd9YejWR3q1XLbu3yedZOjmOzBR7POm7AnqxzOox1XH9RrON/xT+usX61Md+Xrb7QjzVfcLOyaq778jbSKI2thL5YHxrEJpUVVeu4AiurleiNHV+wA+oKCdw5TXAmYfsAAAAASUVORK5CYII="></div></td>
<td class="cl-3f47be8c"><div class="inline-figure"><img style="vertical-align:middle;width:28pt;height:28pt;" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAHYAAAB2CAMAAAAqeZcjAAAACVBMVEX9/v39/v3///8hKJz/AAAAA3RSTlP/AP9p7B++AAAACXBIWXMAAC4jAAAuIwF4pT92AAABEElEQVRoge3X0Q6DIAxAUez/f/SyJc5hKG214OZuH4yJhUNRVMpySRRYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhY2C9kRWQ+K6+YzYrE3J9mRYJuHrseb8+unt+9C+tzM9gN+wNWavZ5atpJbHXuqHkA63ldnWdrZCq7G4TtZrPOck+zTWI4qxRmuSdZbT7HsupdnMBqF3LZ/SLVB5TIfkq9dZLLypWsmGouK3u2n5rNymIUm8+unjGNiezmiVWs4R5gnR+ZdNa30Upj66Vj/i/1Ug6xvk10EuuhvPlBNqB2G4xmlRZ+Nqz2Hr1SJVhxjG30UQJomNXdEBtV2z1H2bja7PzNzg/YCfEAIhM5DU72TiwAAAAASUVORK5CYII="></div></td>
<td class="cl-3f47be8c"><div class="inline-figure"><img style="vertical-align:middle;width:28pt;height:28pt;" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAHYAAAB2CAMAAAAqeZcjAAAACVBMVEX9/v39/v3///8hKJz/AAAAA3RSTlP/AP9p7B++AAAACXBIWXMAAC4jAAAuIwF4pT92AAABDElEQVRoge3X6w6DIAyGYdf7v+gdssyIYPsp4JS3fwym9glJLTo9TokJFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhZ2RNbOYO0V/VkbiTXTXdhLsB9SdWFh/5NVXZ1Nqn+9tux6MAzJiq7GZqZvP9bSW8Ow81Jyr8Cax4bdeqy0XZlNqids1D3Ilhd92aBbkxW2W52NuQq7Pmw2+ro1m8lozJbPo/uwi2vmy+rddQ3ZbN9m5mdP1nH3sPP7mylenU1aqVQ75NZnl6k1WfcH3t3uPtat24g9mhtnFdXNviG7kd6KddwwG5m0q/ziE9MiyQlBLZec2RgqspuuwmpqsazIqmqp8I/tH7Ad4gkanDm9BGF1GwAAAABJRU5ErkJggg=="></div></td>
<td class="cl-3f47be8c"><div class="inline-figure"><img style="vertical-align:middle;width:28pt;height:28pt;" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAHYAAAB2CAMAAAAqeZcjAAAACVBMVEX9/v39/v3///8hKJz/AAAAA3RSTlP/AP9p7B++AAAACXBIWXMAAC4jAAAuIwF4pT92AAAA+UlEQVRoge3X0Q6EIAxEUej/f/RusokRjNhRKFm8fTOaOdZIxZSnVIKFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhf2WmU1gbR6rus9Zg12cFV3YOyrsEmxJBLG1MZHVv30qe+jtVezvYDRb92Yz2K31UNbiWYtkd17ev17ywLjNWjGfQtg8kS0ebAx7MjVWZevdcRRbrxnRldi6wbNTI1n3qZGs6HZl/XBn1ut2YzX379l8WMud2OvQd7FuF/ZJptMdwTpcgXUFOodGb9b5m92d9bl+1j35zAGn6tJ2KXfYzEgCKmwfrkIk1q02I1VWUFuhGxtfsAH1ATaqOaiks2JXAAAAAElFTkSuQmCC"></div></td>
<td class="cl-3f47be8c"><div class="inline-figure"><img style="vertical-align:middle;width:28pt;height:28pt;" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAHYAAAB2CAMAAAAqeZcjAAAACVBMVEX9/v39/v3///8hKJz/AAAAA3RSTlP/AP9p7B++AAAACXBIWXMAAC4jAAAuIwF4pT92AAAA+0lEQVRoge3W2wrEMAhF0dT//+gODFN6sY2mMXbK9jHIWRIIpkwpVWBhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFh77KSwcqnHsO6J3GyIorbcAP/y6qjdGUllRXlcDSr3sAw1ufCXrP7Zwrbl/2mbw3tLITdGrCvYjdIKut1m1k5nySKnR7FOtw2VhkgkbW7HnYV/EOUo0h22Ts71ur2Y11uKzsdVNc132SPDTa3mVVfzAC2reNNrNl9PmuJTGKtbgRr6Atia429WaPbnbW5dtax1pLYuhvDVndvWbdVy8meZxQH6vkIV1Ki2ItML+tRL1IXdnzBDqgZQlg5xsBslSwAAAAASUVORK5CYII="></div></td>
<td class="cl-3f47be8c"><div class="inline-figure"><img style="vertical-align:middle;width:28pt;height:28pt;" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAHYAAAB2CAMAAAAqeZcjAAAACVBMVEX9/v39/v3///8hKJz/AAAAA3RSTlP/AP9p7B++AAAACXBIWXMAAC4jAAAuIwF4pT92AAABAklEQVRoge3W0Q6DIAyFYeD9H3rLFonOBU+xtFn291LJ+QCtUmpKFVhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWNglbMtg27Pi2ZbI3neNbIMNY2+7P8G+xCT27Npn4cDOrN6JtbqzbDtcC2FrItv218zuFLt35zrZxPb4JHbnhrL1/9jeS3Z3lj22cDC77W8s259qHFuT2dONtezXdlrBDsKtLizsVbbRhZ2Kfv8aUlh9xQZ2nGo7ZbixNtePNW2zI7vJ8azcRzorJarLdWbV5a5ghXHerPg+y6z61PqBcji4fA4elT6/q5Cio/IHV0ixsKJ6FWhkdXWc2dn4gg2oBymoOYUyp2qrAAAAAElFTkSuQmCC"></div></td>
</tr>
<tr style="overflow-wrap:break-word;">
<td class="cl-3f47be8d"><p class="cl-3f47977e"><span class="cl-3f47977d">Good</span></p></td>
<td class="cl-3f47be8c"><div class="inline-figure"><img style="vertical-align:middle;width:28pt;height:28pt;" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAHYAAAB2CAMAAAAqeZcjAAAACVBMVEX9/v39/v3///8hKJz/AAAAA3RSTlP/AP9p7B++AAAACXBIWXMAAC4jAAAuIwF4pT92AAAA50lEQVRoge3WUQ6FIAxEUej+F+3Hi6DmqVPFEvT2x4SQOZCCIeUulWBhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYT/GmlkH1uyKOyhrsFGs273JGuxbWevH5jh2ZkLZ6gSyi27+vlea62YXp2j23staaWdt6vPscoNFezVb/Sh2fWNXtzeGzRvW6d5i/ww/we7Fw8JeY3fTv8X6XVi3ChvBlgdze/ZwR/MjR3XHZr3u4Gy127JSYkdWctuysquyYp56sjysOk+A03b2QcnrO09JMqr+gKSc9uxpoIt1oCeRhY0v2ICaAGT9OWXdlL2UAAAAAElFTkSuQmCC"></div></td>
<td class="cl-3f47be8c"><div class="inline-figure"><img style="vertical-align:middle;width:28pt;height:28pt;" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAHYAAAB2CAMAAAAqeZcjAAAACVBMVEX9/v39/v3///8hKJz/AAAAA3RSTlP/AP9p7B++AAAACXBIWXMAAC4jAAAuIwF4pT92AAABEElEQVRoge3X0Q7CIBBE0cr/f7Qxaey2wrKzBRqTuw++OJ0DgdS4vR6ZDRYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhZ2KFs+s5ot+6xlS8m6f8juYMa9yxp+EVueY80CJHkIq7t51jryhdZZu8PTGhRXZc8Hev0m7Irs0f1rKO5AVnE11hxhTYgfcJat94ddiTWv/kZ71JXZ/bNVHnSTrNM9nLW3yamOuCr77XWaJ7G9/QS2m2LvBwU2/g7qJ0V2VHQe62bjrPD70l+ixkphLz2J7aVnsk48zGpqz53LNh+JstI9tm79qe2S8UZSm50HG0L1f5NOjcCqaqtYYxNqvfvLrh/YBfMGqFw441W0t6sAAAAASUVORK5CYII="></div></td>
<td class="cl-3f47be8c"><div class="inline-figure"><img style="vertical-align:middle;width:28pt;height:28pt;" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAHYAAAB2CAMAAAAqeZcjAAAACVBMVEX9/v39/v3///8hKJz/AAAAA3RSTlP/AP9p7B++AAAACXBIWXMAAC4jAAAuIwF4pT92AAABEklEQVRoge3YwQ6DIBREUeX/P7ppk6K2AjPygM2dpZm8E8QocduXZIOFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFLSSlBWx6Zzqb0gM3jPXcONZyu9kPuIi13V7265luBJt53Y1izeV2sifLcuPYfSGrun3sFVrIim4kayy3i/1lFrG628P+7+U0tnVlCiu7HewdMZA9v/zvWMW12fyFuxcGscfB6R4Yw6ZrCo3BbLERzJ7u72w2zy4Ml9xnbLPUalms9rgsYhXXYeXTQ7vosnIxjJUXK1RN1unWyiPZSltnHbXpyqyxs4I7jK3/09iunXoctTjzYDXU/fdUGzOQLc31WBstyZmdH9gJeQHuRjjnbrF6zQAAAABJRU5ErkJggg=="></div></td>
<td class="cl-3f47be8c"><div class="inline-figure"><img style="vertical-align:middle;width:28pt;height:28pt;" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAHYAAAB2CAMAAAAqeZcjAAAACVBMVEX9/v39/v3///8hKJz/AAAAA3RSTlP/AP9p7B++AAAACXBIWXMAAC4jAAAuIwF4pT92AAABB0lEQVRoge3Xyw7DIAxE0cb//9FdVG1KHuCxMAjlesXCmiMLESuvbUq9YGFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWF7s2Y2gTWLuIuyZiEXVlcfxG4Bd0n2Az6LDbgrsl9uAPufP4wtgVHs4ZM0h93PsrsCa1PZszWRldw+rDxunL18ShlsuW9OrOJ2YlU3zB4Y01ydvdntmhtlz4jkBtkrIoktns4VMYatdKSwt9eYzNY6fG5X1j+un/VEusfty7rdDNbR2Jn1ullso7U365zXzSr7pe2msG03h226XlZa4ltlXRSseUpQK4k760LVn7pqjMBq6n2qxqrqbe6PHV+wA+oNcf05a+NduI4AAAAASUVORK5CYII="></div></td>
<td class="cl-3f47be8c"><div class="inline-figure"><img style="vertical-align:middle;width:28pt;height:28pt;" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAHYAAAB2CAMAAAAqeZcjAAAACVBMVEX9/v39/v3///8hKJz/AAAAA3RSTlP/AP9p7B++AAAACXBIWXMAAC4jAAAuIwF4pT92AAAA/0lEQVRoge3YwQ6DIBREUeT/P7rd2FQKOkPh0cb7VgTNHCEKxLQtqQQLCwsLCwsLCwsLCwsLCwsLCwsLCwsLCwurVn7WItZ3/5TNsNPZvJS1XVjYttq1KsPCttWure8bdvduwb4mN549NiLYvI4tW7PZw+caxe77zhtruj1sofYMt4PNS9hPNYKtnSbms9UzzHS2fnKKYau901m1dxzbyF/Ieq7FNuPns94FWJdth9+Ltd3fZ8+i78W6v8V09jy2POfEsqo7ijXdYexmTbTMKoH6iIeyujuWlV2Vld+WLMmpuPmsjCe8Skkyqq8FQozBqupVnsfq6kXki40v2IB6APkHOWLxVe2UAAAAAElFTkSuQmCC"></div></td>
<td class="cl-3f47be8c"><div class="inline-figure"><img style="vertical-align:middle;width:28pt;height:28pt;" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAHYAAAB2CAMAAAAqeZcjAAAACVBMVEX9/v39/v3///8hKJz/AAAAA3RSTlP/AP9p7B++AAAACXBIWXMAAC4jAAAuIwF4pT92AAAA+UlEQVRoge3Y4Q6CMAxG0a3v/9AaYwhTGO1su6n3+0VC05PB6BJKnZICCwsLCwsLCwsLCwsLCwsLCwsLCwsLCwv7lazMYOWeSazd/ZQV2F9lRcZcWNil2IcIm8RaXQd2ZLmwq7NP7/9Yo+vBDiwXtk+9q/FsA6Sx7Zmez7avNIeV15kYzMo+e8zsjrOSytZJ7HZ1tKeD2bNPKYI9nhW5rPoWrBdr/Zngy6rd9dl+W5vrxmoK4lil68ka3OVZTUv1vvJl1W4Me1nozGpdb7bqxrOaNcwChRvBKp50aQv7sbLnTYoetRzkV10srF7ttjSyFrXXdWPzA5uQG++JOZJpYBmMAAAAAElFTkSuQmCC"></div></td>
<td class="cl-3f47be8c"><div class="inline-figure"><img style="vertical-align:middle;width:28pt;height:28pt;" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAHYAAAB2CAMAAAAqeZcjAAAACVBMVEX9/v39/v3///8hKJz/AAAAA3RSTlP/AP9p7B++AAAACXBIWXMAAC4jAAAuIwF4pT92AAAA50lEQVRoge3Yyw7DIAxEUfD/f3Q3bfNQEzzIxm11vQmK0JyQGCGl9ZJqsLCwsLCwsLCwsLCwsLCwsLCwsLCwsLCwsLCw3cwKWLMZ90dZg01nrZSVXVjYa7XDLmBn3Dn2xaxj9737vOazttX/s1bHboPTJ65gRTeCnViuxO7iD0cAbA576KPF7KdxMuu5H8NepusbN4TVlwsLW8feZasu7Ey06EayAhzLul0/O0jV3DBWe81xrHT+RbKC++2sK9HdV7Gs+89NEjua287T78r5dI6Q5ke9e9ITk8CO8jTWjY4S3+z6gl1QD4pFOX6+iXRHAAAAAElFTkSuQmCC"></div></td>
</tr>
<tr style="overflow-wrap:break-word;">
<td class="cl-3f47be8d"><p class="cl-3f47977e"><span class="cl-3f47977d">Very Good</span></p></td>
<td class="cl-3f47be8c"><div class="inline-figure"><img style="vertical-align:middle;width:28pt;height:28pt;" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAHYAAAB2CAMAAAAqeZcjAAAACVBMVEX9/v39/v3///8hKJz/AAAAA3RSTlP/AP9p7B++AAAACXBIWXMAAC4jAAAuIwF4pT92AAAA2ElEQVRoge3WUQqFMAxE0dr9L/oJQn1VayeliSI3H6IY5iR+FNPySCVYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWNi8ljt7FvKIa2OvBH8270S55ih2RTap3PqyuarqOY49zODLtmxvtrG0H1ulP8+OnFOj7PInxrMXL/zZ8wTz2ZtsWFjYd7K30WYXFvaVrNmdyuq0ynbWsf7KTWKt7ldYzZ3FWrpcWAkWWXUN9Us7sb3udGxvlzyfEJNUVD4JpBydFdV+nok1qJ3EwsYXbED9ANJCOUkSt9/CAAAAAElFTkSuQmCC"></div></td>
<td class="cl-3f47be8c"><div class="inline-figure"><img style="vertical-align:middle;width:28pt;height:28pt;" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAHYAAAB2CAMAAAAqeZcjAAAACVBMVEX9/v39/v3///8hKJz/AAAAA3RSTlP/AP9p7B++AAAACXBIWXMAAC4jAAAuIwF4pT92AAABAElEQVRoge3Xyw6DMAxEUer//2jUTUjaxvHkKVV31oMPiAiL63UkFywsLCwsLCwsLCwsLCwsLCwsLCwsLCwsLCwsLCwsLCwsLOwe1uwAa+9sZ8063EHWUjaylmcb+4hH2I5TNcDmluoOssUtCO4kVnX72Q9Gc6exmjuPlY6VypaH9/tGgq7IPpN/EWtZ89iYq7Hms/HH7WLNY0NuL1uZH91GEpu2TXXnRLegzmb7rt8dYKuVNWzzBQZchS0+Fd7cRex4cQnbbsIOq+3u/7FeOc4qarO9knXqq9iGG2bDGzzvVy+48lIrglof+bAxVP119qYorKbOYkW1Ojex+wO7ITczbzjs/EHl+QAAAABJRU5ErkJggg=="></div></td>
<td class="cl-3f47be8c"><div class="inline-figure"><img style="vertical-align:middle;width:28pt;height:28pt;" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAHYAAAB2CAMAAAAqeZcjAAAACVBMVEX9/v39/v3///8hKJz/AAAAA3RSTlP/AP9p7B++AAAACXBIWXMAAC4jAAAuIwF4pT92AAABBElEQVRoge3VwRKDIAyEYZv3f+jO9GArFdhFCJc/R2cnnxE1x2tLHbCwsLCwsLCwsLCwsLCwsLCwsLCwsLCwsLCwsLCwsLCwsLB5bEQ+G5/KZiNcdwYbYbsT2NjBnqDlPmR/x8xjLw/XGfcRW5xoElu+RplseWE5+3+WaWzvRlJYfdxx9o6Qx53Llp/UfPa+vfpzHmVrzdey1ebiuANsd82tYIXlKozrstJKn84qqDLuCKvFJrLqX2gBq+aawTVsN2ix+j7dxPaiDqtv8emsk22EDdYZtnePJuul63Gd9Ybt5D3WUNsL/7hkeuWwtZ5fVkQ9temuZCt9TdZFa51PNr9gE+oNFaM4u8GjFc4AAAAASUVORK5CYII="></div></td>
<td class="cl-3f47be8c"><div class="inline-figure"><img style="vertical-align:middle;width:28pt;height:28pt;" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAHYAAAB2CAMAAAAqeZcjAAAACVBMVEX9/v39/v3///8hKJz/AAAAA3RSTlP/AP9p7B++AAAACXBIWXMAAC4jAAAuIwF4pT92AAABBElEQVRoge3X4Q6CMAxGUez7P7QmGiaTjX5jLUZvf9FQeiCwLiy3S2KBhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFFcKuYO0R+azZgAs7oKourKoOLCGZrfo/RdkV2bq/pbAfr/GVJrN2LSu7EluvlZJlsPaelsPfZht3kMFuTkWyBchitxNpf3D8Eet3dba16UjuZNbrDrJ7W3swuy7f2hDcM2yzYCpbjcUG63NPsN2SCLZb4nLnsm43gnXAftb3HE43iD2qnM06h+R81vVdRbAO99tZaRc/dGPYQzeS7VywbMr64Vd7DQvrQsVfyX6bMLbdVGQ1td12ZfMDNiHuokY5W0cwedcAAAAASUVORK5CYII="></div></td>
<td class="cl-3f47be8c"><div class="inline-figure"><img style="vertical-align:middle;width:28pt;height:28pt;" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAHYAAAB2CAMAAAAqeZcjAAAACVBMVEX9/v39/v3///8hKJz/AAAAA3RSTlP/AP9p7B++AAAACXBIWXMAAC4jAAAuIwF4pT92AAAA6UlEQVRoge3WQQ6DMAxEUeL7H7qLSjTQKngax27RnxWIaB6RHMTWSrLBwsLCwsLCwsLCwsLCwsLCwsLCwsLCwsLCwsLCwoazZlbAWh0ru9Oswd6cVd1Z1ipYq2Cty+3ZXUxgu/489gAcWNHVWeuvn/eL2cP4nN5gPWtFrKWyr/k5ndYEtr2rKWwrYlsRqzyZZwfdsLBfsMNq1YX9L1Zxg1h1u5GsALvZq1bNDWa9bhirbTeOlcY5khXcH2d9hW43lnXP8xr2cm0w++EnesSaJxo7bNncqP+D6+hZwV4Uaqygjit3Nj+wCXkAi6Y5UyNneQ4AAAAASUVORK5CYII="></div></td>
<td class="cl-3f47be8c"><div class="inline-figure"><img style="vertical-align:middle;width:28pt;height:28pt;" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAHYAAAB2CAMAAAAqeZcjAAAACVBMVEX9/v39/v3///8hKJz/AAAAA3RSTlP/AP9p7B++AAAACXBIWXMAAC4jAAAuIwF4pT92AAAA9ElEQVRoge3V2xKDIAxFUcj/f3Q7faiXMnhSQ6h150mByUq8QKlTosDCwsLCwsLCwsLCwsLCwsLCwsLCwsLCwsLCwsLCwjrCZrD2jJ9h/ZX4WLOG+80TOM+2Kvlz1uueZm08aw3jlqzTPcu+bpNY2w5lsPV+rK0Gkthlz7DN1TB2p1kuu3zQM9n1zFC2fmyJWWydxLZ+3wxWnoK9OOt1HWw380TW4UaxTjeWld0w1udennW9Xp0Vck5kNTeU1duNZyU3lpXbHcAq62RW7EN0B7FHa6NZ0S27xd1wVHiQpOiofqwdpxnC9jM6WYfaTflm8wM2IR5orTl8j7diyQAAAABJRU5ErkJggg=="></div></td>
<td class="cl-3f47be8c"><div class="inline-figure"><img style="vertical-align:middle;width:28pt;height:28pt;" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAHYAAAB2CAMAAAAqeZcjAAAACVBMVEX9/v39/v3///8hKJz/AAAAA3RSTlP/AP9p7B++AAAACXBIWXMAAC4jAAAuIwF4pT92AAAA5ElEQVRoge3X2w6DIBCEYdj3f+j2wlqkMczSdYnxn0sl8yERD6UuSYGFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhf0vtoK1dx7D2kLW7d6GPRKWw/ZGDvuDZLINlMKadW4/i+tZ+xyYeWD42ZrOfvs315LZdrnXsFMvg1m25rGH+nbf+N1ptl/xLFY5AXsT9rz8eazPDWH9lwvrr4ZNYN0u7ETx9nWTzXp/SoJZ1Y1mRTeKdboqKxUuYnU3lpVv6GvY4eDSDz+PPD2hpqioujW0nnB2XOdjZXXUuLP5gU3IC5rSOUrNsIfxAAAAAElFTkSuQmCC"></div></td>
</tr>
<tr style="overflow-wrap:break-word;">
<td class="cl-3f47be8d"><p class="cl-3f47977e"><span class="cl-3f47977d">Fair</span></p></td>
<td class="cl-3f47be8c"><div class="inline-figure"><img style="vertical-align:middle;width:28pt;height:28pt;" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAHYAAAB2CAMAAAAqeZcjAAAACVBMVEX9/v39/v3///8hKJz/AAAAA3RSTlP/AP9p7B++AAAACXBIWXMAAC4jAAAuIwF4pT92AAABB0lEQVRoge3WwRKDIAxFUcr/f7SdLjpqFd5DiKW92TE6OYmCMT1uiQQLCwsLCwsLCwsLCwsLCwsLCwsLCwsbw+Y72PyMeDb/H+u7F9kMCzuEtd0p2ZcICwvbrjaN3A5sS7uwsCdoXukh7GriNZygVnYzaMPY7XiPYne/FKHsdhnA7vdQIFta/xT7ofgHtwvrtzsPe2DAdmYPCdeF/Ub2GHC/U51Yt91J2NOn6bktrHdhPKu7JltIPpr1K7rKFlM7rs+WaxJdi63kNVybrZYlwQ5bzZll12CVjKrbmVVdnVVfW19W36VKv2l9azWMCss5koGqnyAhi8OKqtKuwcpqJeObjQ/YgFgAtwc5fL/IhkUAAAAASUVORK5CYII="></div></td>
<td class="cl-3f47be8c"><div class="inline-figure"><img style="vertical-align:middle;width:28pt;height:28pt;" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAHYAAAB2CAMAAAAqeZcjAAAACVBMVEX9/v39/v3///8hKJz/AAAAA3RSTlP/AP9p7B++AAAACXBIWXMAAC4jAAAuIwF4pT92AAABA0lEQVRoge3XQQ6DMAxEUfD9D121C1SJFHscg0v7Zw1+jFBkZVlbssDCwsLCwsLCwsLCwsLCwsLCwsLCwsLCwsLCfhFr1sDaM01swp1j7R9Z3Z1iX+J/sSl3hrU+dm1lVbeAzdSdYDetiU24sDKru7dj3yn56Nawct1CVnGLWNW9OSv+3TJWc9PsTmlkw24dK9UtZqNuIau45WwMzrLD+XH3F9j4fbeYjR6jU1jfLWdjdZPswewmNuTCzqkhF7aCddwU6409h3Xb+HUTbGDL2JYyNrLbzHNlNrZRPVdlo3vcjuFl/5Qf8SMHLy86qtxjP72eYAV1ODrFSuhw+MZeH9gL8gBNzTk3g+GW0gAAAABJRU5ErkJggg=="></div></td>
<td class="cl-3f47be8c"><div class="inline-figure"><img style="vertical-align:middle;width:28pt;height:28pt;" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAHYAAAB2CAMAAAAqeZcjAAAACVBMVEX9/v39/v3///8hKJz/AAAAA3RSTlP/AP9p7B++AAAACXBIWXMAAC4jAAAuIwF4pT92AAABBElEQVRoge3Z4Q6DIAxGUeT9H3pZlsWFaMtXwYZ5+5fSY42BJpYtJQosLCwsLCwsLCwsLCwsLCwsLCwsLCwsLCwsLOzT2FoT2PqO29maycrummzNY7eAuyT7ARNZ0R3BBtpdkf1yz2J1F1ZWs1jZhdVV+VgexKrtLs6K7nJs42gf1TBWG9RHs532OFZyw+xB9ST2B76X3e3/Yq3aHe4VNrY4l7XdKazfbpB16rrtzmHd9RjrduMlxNlLGTNZIyXE9pxDdk6E7Trs7SshwHbebWaazHYPEKarscLYYrsKK0wP7Yba7C1GwmkEHrTZXWRUeD3HlQOsZJ6UllkZPY11/4zAevECUIs5HFbNYDgAAAAASUVORK5CYII="></div></td>
<td class="cl-3f47be8c"><div class="inline-figure"><img style="vertical-align:middle;width:28pt;height:28pt;" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAHYAAAB2CAMAAAAqeZcjAAAACVBMVEX9/v39/v3///8hKJz/AAAAA3RSTlP/AP9p7B++AAAACXBIWXMAAC4jAAAuIwF4pT92AAAA9UlEQVRoge3Wyw7DIAxE0YT//+i2qoKqKMRj81LJnSUyPnhltn1KNlhYWFhYWFhYWFhYWFhYWFhYWFhYWFhY2KqkNIFNnzyFTQ9k/e5fsgl2edbt1rP7cPYLwsJ2YL1uDXtwsMuxWZvEBlzYEPtegEPY3xHdy74pq7ttWPe4bVnZbcReHoxjVTfMXhgTWVFuyTrcHqzgrsBmuhtbbv4sVnJh61TJXYw13Bhr9J3I3rsh1mzbhbWHMSsCrLJl2rPSbrNq3Ky4UY0qL6vucaPOyeqftHTKJXsuuo3nhYXbmxuVf/539/2sqhbbRlgdLb4gs+MDOyAv5qE5YsY+wqEAAAAASUVORK5CYII="></div></td>
<td class="cl-3f47be8c"><div class="inline-figure"><img style="vertical-align:middle;width:28pt;height:28pt;" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAHYAAAB2CAMAAAAqeZcjAAAACVBMVEX9/v39/v3///8hKJz/AAAAA3RSTlP/AP9p7B++AAAACXBIWXMAAC4jAAAuIwF4pT92AAAA9UlEQVRoge3W7Q7CIAyFYeD+L1pj4uJ00p7Kh2Nvf47lPJQMRspTKsHCwsLCwsLCwsLCwsLCwsLCwsLC/hFb7jWJDbjnZAvs4qzunpItsLCwZ2Mf4kRWdn9nQ+3CKuokNl+FfXKw/dhNgx3Eqm6YfbFgO7FlBru/QY1iy5XY91tqYONG2fqDhdhPBHYR9sCYxOruAqwgt2OljmX2OF11YQ30a7jgRtjaYBe2vpLCMutsfDjKWu34vyuZteflkTuxlquwjjiv25jNzpOjPZutfSaywmlgNpx275mlTLEWkRRU+KEaGRrrVmuZMiuoldSNHV+wA+oGdKQ5qSGFRH4AAAAASUVORK5CYII="></div></td>
<td class="cl-3f47be8c"><div class="inline-figure"><img style="vertical-align:middle;width:28pt;height:28pt;" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAHYAAAB2CAMAAAAqeZcjAAAACVBMVEX9/v39/v3///8hKJz/AAAAA3RSTlP/AP9p7B++AAAACXBIWXMAAC4jAAAuIwF4pT92AAAA/ElEQVRoge3X0Q6DIAyF4a3v/9BbTKaOOehBKAb/c2NCmn6SYIOP55A8YGFhYWFhYWFhYWFhYWFhYWFhYa/P2gjW3oln7U6swUaxugt7edZgYWdgF/EurK2s7J5nq7Z7gv1scwC7f07NrhosLGy9ekNWdRuwNduFhb0Iu6dgg1jRrWS/pSA2/eGamk3V+dn8Qg/2FxnE6jecHqzDbcymh60de9R3WbMtQeyeHMgW3eas7zA3YtU7jsw6mjpKerGFmm5svqgH63BV1vdZNma9s6/oSqx3BpVdgXVPvq04z6ajLRf1JY8bqKxXLbga60czXVVWQv+3Xdn4wAbkBdhOOdC0clXgAAAAAElFTkSuQmCC"></div></td>
<td class="cl-3f47be8c"><div class="inline-figure"><img style="vertical-align:middle;width:28pt;height:28pt;" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAHYAAAB2CAMAAAAqeZcjAAAACVBMVEX9/v39/v3///8hKJz/AAAAA3RSTlP/AP9p7B++AAAACXBIWXMAAC4jAAAuIwF4pT92AAAA8klEQVRoge3W6w6CMAyG4dn7v2gNEgKCtt+OCG9/wVj6tBsspMeQSLCwsLCwsLCwx2GvuBeb4RayBgsLCwsLO5DV3TLWYGFhYWFhYWEvwE4i7LVZ2S1ns9qFhT0RO3udWbsTu5xO/dntBSwsrKzCXpxV3QpsTruw52VtBGtzjGHXtx1Yg23O2knYDLcmK9A6Oxnb/g6G2rD7oY8FgC1hD5PL7v+zyrussl9St2WdhXw/jNgS6+1ffIczWLesgKuwfsJmbKCwiCuw4e+yPhue6PwDpNXMQMQL/J0iKWj0MPCTNGH9diU2qm4y7rIvbP+A7RBPYKI6sGjQQUAAAAAASUVORK5CYII="></div></td>
</tr>
</tbody>
</table></div>
</div></template><div class="flextable-shadow-host" id="8567f921-d118-49cb-a29e-718257088e62"></div>
<script>
var dest = document.getElementById("8567f921-d118-49cb-a29e-718257088e62");
var template = document.getElementById("6a07cc38-e95d-44ca-9da2-de87a4331229");
var caption = template.content.querySelector("caption");
if(caption) {
  caption.style.cssText = "display:block;text-align:center;";
  var newcapt = document.createElement("p");
  newcapt.appendChild(caption)
  dest.parentNode.insertBefore(newcapt, dest.previousSibling);
}
var fantome = dest.attachShadow({mode: 'open'});
var templateContent = template.content;
fantome.appendChild(templateContent);
</script>
</div>
</div>
<div id="rmdcaptions" class="section level3" number="2.2.5">
<h3>
<span class="header-section-number">2.2.5</span> Captions to support tables, figures, and equations<a class="anchor" aria-label="anchor" href="#rmdcaptions"><i class="fas fa-link"></i></a>
</h3>
<p>There are several ways to support captions in R Markdown. The two main requirements for good captions: (1) automatic sequential numbering, and (2) ability to cross-reference.</p>
<p>Here are some options for adding captions:</p>
<div id="figures" class="section level4" number="2.2.5.1">
<h4>
<span class="header-section-number">2.2.5.1</span> Figures<a class="anchor" aria-label="anchor" href="#figures"><i class="fas fa-link"></i></a>
</h4>
<div id="r-markdown-code-chunk-fig.cap" class="section level5" number="2.2.5.1.1">
<h5>
<span class="header-section-number">2.2.5.1.1</span> R Markdown code chunk <code>fig.cap</code><a class="anchor" aria-label="anchor" href="#r-markdown-code-chunk-fig.cap"><i class="fas fa-link"></i></a>
</h5>
<p>Code chunks can include <code>fig_cap</code> as an option, as shown below. However, in standard Rmd <span class="math inline">\(\rightarrow\)</span> HTML there does not appear to be a method for cross-referencing. The code chunk would look like</p>
<pre><code>```{r plotcars, fig.cap="Cars: speed and distance"}
plot(cars)
```</code></pre>
<div class="figure">
<span style="display:block;" id="fig:plotcars"></span>
<img src="02-week02_files/figure-html/plotcars-1.png" alt="Cars: speed and distance" width="672"><p class="caption">
Figure 2.2: Cars: speed and distance
</p>
</div>
</div>
<div id="bookdown-with-html_document2-output-type" class="section level5" number="2.2.5.1.2">
<h5>
<span class="header-section-number">2.2.5.1.2</span> <code>bookdown</code> with <code>html_document2</code> output type<a class="anchor" aria-label="anchor" href="#bookdown-with-html_document2-output-type"><i class="fas fa-link"></i></a>
</h5>
<p>Using the <code>bookdown</code> package with <code>html_document2</code> output type, it is possible to cross-reference using the chunk name. For example, download and run this code <a href="files/fig_cap_bookdown.Rmd">fig_cap_bookdown.Rmd</a></p>
<p>Which renders a file:</p>
<div class="inline-figure"><img src="images/week03/fig_ref.png"></div>
<p>There seems to be no difference in the HTML output using</p>
<pre><code>output: 
    bookdown::html_document2:</code></pre>
<p>versus</p>
<pre><code>output: 
    html_document:</code></pre>
<p>so the former is suggested as one way to include captions that support cross-referencing.</p>
</div>
</div>
<div id="tables-kable-caption" class="section level4" number="2.2.5.2">
<h4>
<span class="header-section-number">2.2.5.2</span> Tables: <code>kable()</code> “caption”<a class="anchor" aria-label="anchor" href="#tables-kable-caption"><i class="fas fa-link"></i></a>
</h4>
<p>Tables created with <code><a href="https://rdrr.io/pkg/knitr/man/kable.html">kable()</a></code> can include the <code>caption</code> option. For example:</p>
<div class="sourceCode" id="cb206"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html">kable</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">sum_health_white_afram</span>, caption <span class="op">=</span> <span class="st">"Self-reported health by race"</span><span class="op">)</span></code></pre></div>
<div class="inline-table"><table class="table table-sm">
<caption>
<span id="tab:unnamed-chunk-33">Table 2.2: </span>Self-reported health by race
</caption>
<thead><tr>
<th style="text-align:left;">
health…1
</th>
<th style="text-align:left;">
white
</th>
<th style="text-align:right;">
n…3
</th>
<th style="text-align:right;">
%…4
</th>
<th style="text-align:left;">
afram
</th>
<th style="text-align:right;">
n…7
</th>
<th style="text-align:right;">
%…8
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:left;">
high
</td>
<td style="text-align:left;">
<ol start="0" style="list-style-type: decimal"><li>Not marked
</li></ol>
</td>
<td style="text-align:right;">
1486
</td>
<td style="text-align:right;">
33.36
</td>
<td style="text-align:left;">
<ol start="0" style="list-style-type: decimal"><li>Not marked
</li></ol>
</td>
<td style="text-align:right;">
3309
</td>
<td style="text-align:right;">
74.28
</td>
</tr>
<tr>
<td style="text-align:left;">
high
</td>
<td style="text-align:left;">
<ol style="list-style-type: decimal"><li>Marked
</li></ol>
</td>
<td style="text-align:right;">
2962
</td>
<td style="text-align:right;">
66.49
</td>
<td style="text-align:left;">
<ol style="list-style-type: decimal"><li>Marked
</li></ol>
</td>
<td style="text-align:right;">
1139
</td>
<td style="text-align:right;">
25.57
</td>
</tr>
<tr>
<td style="text-align:left;">
high
</td>
<td style="text-align:left;">
<ol start="6" style="list-style-type: decimal"><li>Refused
</li></ol>
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
0.04
</td>
<td style="text-align:left;">
<ol start="6" style="list-style-type: decimal"><li>Refused
</li></ol>
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
0.04
</td>
</tr>
<tr>
<td style="text-align:left;">
high
</td>
<td style="text-align:left;">
<ol start="8" style="list-style-type: decimal"><li>Don’t know
</li></ol>
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
0.11
</td>
<td style="text-align:left;">
<ol start="8" style="list-style-type: decimal"><li>Don’t know
</li></ol>
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
0.11
</td>
</tr>
<tr>
<td style="text-align:left;">
low
</td>
<td style="text-align:left;">
<ol start="0" style="list-style-type: decimal"><li>Not marked
</li></ol>
</td>
<td style="text-align:right;">
704
</td>
<td style="text-align:right;">
34.49
</td>
<td style="text-align:left;">
<ol start="0" style="list-style-type: decimal"><li>Not marked
</li></ol>
</td>
<td style="text-align:right;">
1553
</td>
<td style="text-align:right;">
76.09
</td>
</tr>
<tr>
<td style="text-align:left;">
low
</td>
<td style="text-align:left;">
<ol style="list-style-type: decimal"><li>Marked
</li></ol>
</td>
<td style="text-align:right;">
1328
</td>
<td style="text-align:right;">
65.07
</td>
<td style="text-align:left;">
<ol style="list-style-type: decimal"><li>Marked
</li></ol>
</td>
<td style="text-align:right;">
479
</td>
<td style="text-align:right;">
23.47
</td>
</tr>
<tr>
<td style="text-align:left;">
low
</td>
<td style="text-align:left;">
<ol start="6" style="list-style-type: decimal"><li>Refused
</li></ol>
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0.05
</td>
<td style="text-align:left;">
<ol start="6" style="list-style-type: decimal"><li>Refused
</li></ol>
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0.05
</td>
</tr>
<tr>
<td style="text-align:left;">
low
</td>
<td style="text-align:left;">
<ol start="8" style="list-style-type: decimal"><li>Don’t know
</li></ol>
</td>
<td style="text-align:right;">
8
</td>
<td style="text-align:right;">
0.39
</td>
<td style="text-align:left;">
<ol start="8" style="list-style-type: decimal"><li>Don’t know
</li></ol>
</td>
<td style="text-align:right;">
8
</td>
<td style="text-align:right;">
0.39
</td>
</tr>
<tr>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
<ol start="0" style="list-style-type: decimal"><li>Not marked
</li></ol>
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
12.50
</td>
<td style="text-align:left;">
<ol start="0" style="list-style-type: decimal"><li>Not marked
</li></ol>
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
50.00
</td>
</tr>
<tr>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
<ol style="list-style-type: decimal"><li>Marked
</li></ol>
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
50.00
</td>
<td style="text-align:left;">
<ol style="list-style-type: decimal"><li>Marked
</li></ol>
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
12.50
</td>
</tr>
<tr>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
<ol start="6" style="list-style-type: decimal"><li>Refused
</li></ol>
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
12.50
</td>
<td style="text-align:left;">
<ol start="6" style="list-style-type: decimal"><li>Refused
</li></ol>
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
12.50
</td>
</tr>
<tr>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
<ol start="8" style="list-style-type: decimal"><li>Don’t know
</li></ol>
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
25.00
</td>
<td style="text-align:left;">
<ol start="8" style="list-style-type: decimal"><li>Don’t know
</li></ol>
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
25.00
</td>
</tr>
</tbody>
</table></div>
<p>But there appears to be no direct way of cross-referencing within standard Rmd <span class="math inline">\(\rightarrow\)</span> HTML.</p>
<div id="bookdown-with-html_document2-output-type-1" class="section level5" number="2.2.5.2.1">
<h5>
<span class="header-section-number">2.2.5.2.1</span> <code>bookdown</code> with <code>html_document2</code> output type<a class="anchor" aria-label="anchor" href="#bookdown-with-html_document2-output-type-1"><i class="fas fa-link"></i></a>
</h5>
<p>Similarly for figures, the <code>bookdown</code> package with <code>html_document2</code> output type, it is possible to cross-reference using the chunk name. For example, download and run this code <a href="files/table_cap_bookdown.Rmd">table_cap_bookdown.Rmd</a></p>
<p>Which renders a file:</p>
<div class="inline-figure"><img src="images/week03/tab_ref.png"></div>
</div>
</div>
<div id="rmdequations" class="section level4" number="2.2.5.3">
<h4>
<span class="header-section-number">2.2.5.3</span> Equations<a class="anchor" aria-label="anchor" href="#rmdequations"><i class="fas fa-link"></i></a>
</h4>
<p>Equations should be numbered in manuscripts. Using <code>bookdown</code> makes this quite easy. The equations themselves require <span class="math inline">\(\LaTeX\)</span> syntax. There are numerous web sites with examples and tutorials for creating mathematical expressions with <span class="math inline">\(\LaTeX\)</span> In this example, we include Einstein’s famous equation:</p>
<pre>
\begin{equation}
  E=mc^2
  (\#eq:emc)
\end{equation}
</pre>
<p>and the sum of squares:</p>
<pre>
\begin{equation}
  \sum_{i=1}^n i^2 = \frac{n(n+1)(2n+1)}{6}
  (\#eq:sumn)
\end{equation}
</pre>
<p>The label for the equation is set with <code>(\#eq:emc)</code> and can be referenced using <code>\@ref(eq:emc)</code>. Operationalized, we see:</p>
<p>Einstein’s equation, energy equals mass times the square of the speed of light is shown in <a href="week2.html#eq:emc">(2.1)</a>.</p>
<p><span class="math display" id="eq:emc">\[\begin{equation}
  E=mc^2
  \tag{2.1}
\end{equation}\]</span></p>
<p>To make a sum of squares of <em>n</em> first integers, see <a href="week2.html#eq:sumn">(2.2)</a>.</p>
<p><span class="math display" id="eq:sumn">\[\begin{equation}
  \sum_{i=1}^n i^2 = \frac{n(n+1)(2n+1)}{6}
  \tag{2.2}
\end{equation}\]</span></p>
</div>
</div>
<div id="captioner-for-any-captioning-and-cross-referencing-figures-and-tables" class="section level3" number="2.2.6">
<h3>
<span class="header-section-number">2.2.6</span> <code>captioner</code> for any captioning and cross-referencing figures and tables<a class="anchor" aria-label="anchor" href="#captioner-for-any-captioning-and-cross-referencing-figures-and-tables"><i class="fas fa-link"></i></a>
</h3>
<p>The <code>captioner</code> package provides a flexible, albeit cumbersome, framework for captioning both tables and figures.</p>
<p>The R code to do this:</p>
<pre><code><a href="https://github.com/adletaw/captioner">library(captioner)
table_nums &lt;- captioner(prefix = "Table")
figure_nums &lt;- captioner(prefix = "Figure")</a></code></pre>
<p>The <code>table_nums()</code> and <code>figure_nums()</code> functions are used to create captions and cross-references, and are not tied to any specific figure or table, as is the case with <code>kable</code> table captions and R code chunk <code>fig.cap</code>.</p>
<p>A caption is created, e.g., for a figure:</p>
<p><code>`r figure_nums(name = "figname", caption = "My Caption")`</code></p>
<p>and referenced, e.g.,</p>
<p><code>`r figure_nums(name = "figname", display = "cite")`</code></p>
<p>It does not matter whether the reference precedes or comes after the caption itself.</p>
<p>Another benefit to using <code>captioner</code> is that the output can be formatted using markdown syntax. For example, to format the caption in italics, use underscores:</p>
<p><code>_`r figure_nums(name = "figname", caption = "My Caption")`_</code></p>
<p>Although this method requires a bit more coding, it allows great flexibility. A complete example:</p>
<p>As shown in Figure 1, the distribution of age has a slight negative skew.</p>
<div class="sourceCode" id="cb208"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># how many unique bins?</span>
<span class="va">bins</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="va">ages</span><span class="op">$</span><span class="va">age</span><span class="op">)</span><span class="op">)</span>

<span class="co"># create the graphic</span>
<span class="va">g</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">ages</span>, mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">age</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_histogram.html">geom_histogram</a></span><span class="op">(</span>bins <span class="op">=</span> <span class="va">bins</span><span class="op">)</span>

<span class="co"># print the graphic</span>
<span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">g</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="02-week02_files/figure-html/unnamed-chunk-34-1.png" width="288"></div>
<p><em>Figure 1: Add Health age histogram</em></p>
<p>Similarly, we can present the same data as a frequency table, as shown in Table 2.</p>
<p><em>Table 2: Add Health age frequency table</em></p>
<div class="sourceCode" id="cb209"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">ages</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">age</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html">n</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>
        cumsum <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cumsum.html">cumsum</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span>,
        <span class="st">"%"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="va">n</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span> <span class="op">*</span> <span class="fl">100</span>, <span class="fl">1</span><span class="op">)</span>,
        <span class="st">"cum %"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cumsum.html">cumsum</a></span><span class="op">(</span><span class="va">n</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span> <span class="op">*</span> <span class="fl">100</span><span class="op">)</span>, <span class="fl">1</span><span class="op">)</span>
    <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
    <span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html">kable</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
    <span class="fu"><a href="https://rdrr.io/pkg/kableExtra/man/kable_styling.html">kable_styling</a></span><span class="op">(</span>
        bootstrap_options <span class="op">=</span>
            <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"striped"</span>, <span class="st">"hover"</span>, <span class="st">"condensed"</span>, <span class="st">"responsive"</span><span class="op">)</span>,
        full_width <span class="op">=</span> <span class="cn">F</span>,
        position <span class="op">=</span> <span class="st">"left"</span>
    <span class="op">)</span></code></pre></div>
<div class="inline-table"><table class="table table-striped table-hover table-condensed table-responsive" style="width: auto !important; ">
<thead><tr>
<th style="text-align:right;">
age
</th>
<th style="text-align:right;">
n
</th>
<th style="text-align:right;">
cumsum
</th>
<th style="text-align:right;">
%
</th>
<th style="text-align:right;">
cum %
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:right;">
12
</td>
<td style="text-align:right;">
9
</td>
<td style="text-align:right;">
9
</td>
<td style="text-align:right;">
0.1
</td>
<td style="text-align:right;">
0.1
</td>
</tr>
<tr>
<td style="text-align:right;">
13
</td>
<td style="text-align:right;">
578
</td>
<td style="text-align:right;">
587
</td>
<td style="text-align:right;">
8.9
</td>
<td style="text-align:right;">
9.0
</td>
</tr>
<tr>
<td style="text-align:right;">
14
</td>
<td style="text-align:right;">
903
</td>
<td style="text-align:right;">
1490
</td>
<td style="text-align:right;">
13.9
</td>
<td style="text-align:right;">
22.9
</td>
</tr>
<tr>
<td style="text-align:right;">
15
</td>
<td style="text-align:right;">
1081
</td>
<td style="text-align:right;">
2571
</td>
<td style="text-align:right;">
16.6
</td>
<td style="text-align:right;">
39.5
</td>
</tr>
<tr>
<td style="text-align:right;">
16
</td>
<td style="text-align:right;">
1162
</td>
<td style="text-align:right;">
3733
</td>
<td style="text-align:right;">
17.9
</td>
<td style="text-align:right;">
57.4
</td>
</tr>
<tr>
<td style="text-align:right;">
17
</td>
<td style="text-align:right;">
1169
</td>
<td style="text-align:right;">
4902
</td>
<td style="text-align:right;">
18.0
</td>
<td style="text-align:right;">
75.4
</td>
</tr>
<tr>
<td style="text-align:right;">
18
</td>
<td style="text-align:right;">
1149
</td>
<td style="text-align:right;">
6051
</td>
<td style="text-align:right;">
17.7
</td>
<td style="text-align:right;">
93.1
</td>
</tr>
<tr>
<td style="text-align:right;">
19
</td>
<td style="text-align:right;">
389
</td>
<td style="text-align:right;">
6440
</td>
<td style="text-align:right;">
6.0
</td>
<td style="text-align:right;">
99.1
</td>
</tr>
<tr>
<td style="text-align:right;">
20
</td>
<td style="text-align:right;">
43
</td>
<td style="text-align:right;">
6483
</td>
<td style="text-align:right;">
0.7
</td>
<td style="text-align:right;">
99.7
</td>
</tr>
<tr>
<td style="text-align:right;">
21
</td>
<td style="text-align:right;">
18
</td>
<td style="text-align:right;">
6501
</td>
<td style="text-align:right;">
0.3
</td>
<td style="text-align:right;">
100.0
</td>
</tr>
</tbody>
</table></div>
</div>
</div>
<div id="keyring" class="section level2" number="2.3">
<h2>
<span class="header-section-number">2.3</span> Keyring<a class="anchor" aria-label="anchor" href="#keyring"><i class="fas fa-link"></i></a>
</h2>
<p>In preparation for some later work, go to the following web sites and create a user profile. This will require that you establish a username and password for both sites if you have not done so already. Make a note of your username and password for these sites! You will need them later. If you are not using a password manager, you should! Highly recommended: <a href="https://keepass.info/">KeePass Password Safe</a>. You can store the password database on DropBox or OneDrive and you will always have access to your passwords. <strong>Make sure you record your password correctly or you will have errors later on!</strong></p>
<ul>
<li><a href="https://www.mortality.org/">Human Mortality Database (HMD)</a></li>
<li><a href="https://www.humanfertility.org/cgi-bin/main.php">Human Fertility Database (HFD)</a></li>
</ul>
<p>The <a href="https://cran.r-project.org/web/packages/keyring/index.html">Keyring</a> package is used for accessing credentials that you would not want to store in your R code. We will use the passwords for the Human Mortality and Human Fertility databases (covered below) as the example for how to use this package.</p>
<p>The keyring is stored as part of your user profile on the computer. Therefore if you are using multiple computers (e.g., your own computer as well as the CSDE terminal server), you will need to repeat the steps of setting keys. The keys are stored at the operating system level, so once set, they do not need to be reset, and any R session will have access to the keys. Also once you log on to the computer, the keyring is unlocked automatically.</p>
<p>The main functions you are likely to use are <code>key_set()</code> to interactively store keys, <code>key_list()</code> to list the service and username for the different keys you have created, and <code>key_get()</code> to retrieve a key. If you want to delete a key, that is done with <code>key_delete()</code>.</p>
<div id="setting-storing-keys" class="section level3" number="2.3.1">
<h3>
<span class="header-section-number">2.3.1</span> Setting (storing) keys<a class="anchor" aria-label="anchor" href="#setting-storing-keys"><i class="fas fa-link"></i></a>
</h3>
<p>The following code will set the keys for my user. You will want to copy this code to your R Markdown document and change the username. When you run the code, if you have not already entered keys for these two sites, you will be prompted, as shown in r figure_nums(name = “keyring1,” display = “cite”)`.</p>
<div class="sourceCode" id="cb210"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># get the keys</span>
<span class="va">myKeys</span> <span class="op">&lt;-</span> <span class="fu">key_list</span><span class="op">(</span><span class="op">)</span>

<span class="co"># Set your password for Human Mortality Database (HMD)</span>
<span class="co"># does a key exist? if not, create one</span>
<span class="kw">if</span> <span class="op">(</span><span class="fu">key_list</span><span class="op">(</span>service <span class="op">=</span> <span class="st">"human-mortality-database"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="op">)</span> <span class="op">==</span> <span class="fl">0</span><span class="op">)</span> <span class="op">{</span>
    <span class="fu">keyring</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/keyring/man/key_get.html">key_set</a></span><span class="op">(</span>
        service <span class="op">=</span> <span class="st">"human-mortality-database"</span>,
        username <span class="op">=</span> <span class="st">"phurvitz@uw.edu"</span>
    <span class="op">)</span>
    <span class="co"># Enter your HMD password in the prompt</span>
<span class="op">}</span>

<span class="co"># Set your password for Human Fertility Database (HFD)</span>
<span class="kw">if</span> <span class="op">(</span><span class="fu">key_list</span><span class="op">(</span>service <span class="op">=</span> <span class="st">"human-fertility-database"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="op">)</span> <span class="op">==</span> <span class="fl">0</span><span class="op">)</span> <span class="op">{</span>
    <span class="fu">keyring</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/keyring/man/key_get.html">key_set</a></span><span class="op">(</span>
        service <span class="op">=</span> <span class="st">"human-fertility-database"</span>,
        username <span class="op">=</span> <span class="st">"phurvitz@uw.edu"</span>
    <span class="op">)</span>
    <span class="co"># Enter your HFD password in the prompt</span>
<span class="op">}</span></code></pre></div>
<div class="inline-figure"><img src="images/week02/keyring01.png"></div>
<p><em>Figure 2: The keyring password storage dialogue</em></p>
<p>Once the keys are stored, the service and username can be shown with <code>key_list()</code>:</p>
<div class="sourceCode" id="cb211"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">key_list</span><span class="op">(</span><span class="op">)</span></code></pre></div>
<pre><code>##                    service        username
## 1 human-fertility-database phurvitz@uw.edu
## 2 human-mortality-database phurvitz@uw.edu</code></pre>
</div>
<div id="retreivingusing-usernames-and-passwords" class="section level3" number="2.3.2">
<h3>
<span class="header-section-number">2.3.2</span> Retreiving/using usernames and passwords<a class="anchor" aria-label="anchor" href="#retreivingusing-usernames-and-passwords"><i class="fas fa-link"></i></a>
</h3>
<p>In the following example, I set a bogus key to demonstrate retrieving the secret. Thde dialog appears and I enter the fake password.</p>
<div class="sourceCode" id="cb213"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># I only create the key if it does not exist</span>
<span class="kw">if</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="fu">key_list</span><span class="op">(</span>service <span class="op">=</span> <span class="st">"bogus"</span><span class="op">)</span><span class="op">)</span> <span class="op">==</span> <span class="fl">0</span><span class="op">)</span><span class="op">{</span>
    <span class="fu">key_set_with_value</span><span class="op">(</span>service <span class="op">=</span> <span class="st">"bogus"</span>, 
                           username <span class="op">=</span> <span class="st">"fake@user.tv"</span>,
                           password <span class="op">=</span> <span class="st">"the user and password are fake."</span><span class="op">)</span>
<span class="op">}</span></code></pre></div>
<p>Now I retrieve the key:</p>
<div class="sourceCode" id="cb214"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">key_get</span><span class="op">(</span>service <span class="op">=</span> <span class="st">"bogus"</span>, <span class="st">"fake@user.tv"</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] "the user and password are fake."</code></pre>
</div>
<div id="deleting-a-key" class="section level3" number="2.3.3">
<h3>
<span class="header-section-number">2.3.3</span> Deleting a key<a class="anchor" aria-label="anchor" href="#deleting-a-key"><i class="fas fa-link"></i></a>
</h3>
<p>Here I delete the bogus key:</p>
<div class="sourceCode" id="cb216"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">key_delete</span><span class="op">(</span>service <span class="op">=</span> <span class="st">"bogus"</span>, username <span class="op">=</span> <span class="st">"fake@user.tv"</span><span class="op">)</span></code></pre></div>
</div>
</div>
<div id="datasets002" class="section level2" number="2.4">
<h2>
<span class="header-section-number">2.4</span> Data sets:<a class="anchor" aria-label="anchor" href="#datasets002"><i class="fas fa-link"></i></a>
</h2>
<p>Here we will use the keyring to access data in the Human Mortality and Human Fertility databases.</p>
<div id="using-keyring-in-an-application" class="section level3" number="2.4.1">
<h3>
<span class="header-section-number">2.4.1</span> Using keyring in an application<a class="anchor" aria-label="anchor" href="#using-keyring-in-an-application"><i class="fas fa-link"></i></a>
</h3>
<p>Within your code, rather than storing any passwords, you can access the password, for example, to get 1 year x 1 year death rates for Israel from the Human Mortality Database:</p>
<div class="sourceCode" id="cb217"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">ISR_mx</span> <span class="op">&lt;-</span> <span class="fu">HMDHFDplus</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/HMDHFDplus/man/readHMDweb.html">readHMDweb</a></span><span class="op">(</span>
    <span class="co"># data for Israel</span>
    CNTRY <span class="op">=</span> <span class="st">"ISR"</span>,
    <span class="co"># mortality 1 year age by 1 year interval</span>
    item <span class="op">=</span> <span class="st">"Mx_1x1"</span>,
    <span class="co"># get my username</span>
    username <span class="op">=</span> <span class="fu">keyring</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/keyring/man/key_get.html">key_list</a></span><span class="op">(</span><span class="st">"human-mortality-database"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/pull.html">pull</a></span><span class="op">(</span><span class="va">username</span><span class="op">)</span>,
    password <span class="op">=</span> <span class="fu">keyring</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/keyring/man/key_get.html">key_get</a></span><span class="op">(</span>
        service <span class="op">=</span> <span class="st">"human-mortality-database"</span>,
        username <span class="op">=</span> <span class="fu">keyring</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/keyring/man/key_get.html">key_list</a></span><span class="op">(</span><span class="st">"human-mortality-database"</span><span class="op">)</span><span class="op">$</span><span class="va">username</span>
    <span class="op">)</span>
<span class="op">)</span></code></pre></div>
<p>Or to get the total number of live births from Japan from the Human Fertility Database:</p>
<div class="sourceCode" id="cb218"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">JPN_livebirths</span> <span class="op">&lt;-</span> <span class="fu">HMDHFDplus</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/HMDHFDplus/man/readHFDweb.html">readHFDweb</a></span><span class="op">(</span>
    <span class="co"># data for Japan</span>
    CNTRY <span class="op">=</span> <span class="st">"JPN"</span>,
    <span class="co"># live births</span>
    item <span class="op">=</span> <span class="st">"totbirthsRR"</span>,
    <span class="co"># get my username</span>
    username <span class="op">=</span> <span class="fu">keyring</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/keyring/man/key_get.html">key_list</a></span><span class="op">(</span><span class="st">"human-mortality-database"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/pull.html">pull</a></span><span class="op">(</span><span class="va">username</span><span class="op">)</span>,
    password <span class="op">=</span> <span class="fu">keyring</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/keyring/man/key_get.html">key_get</a></span><span class="op">(</span>
        service <span class="op">=</span> <span class="st">"human-mortality-database"</span>,
        username <span class="op">=</span> <span class="fu">keyring</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/keyring/man/key_get.html">key_list</a></span><span class="op">(</span><span class="st">"human-mortality-database"</span><span class="op">)</span><span class="op">$</span><span class="va">username</span>
    <span class="op">)</span>
<span class="op">)</span></code></pre></div>
<p>The benefit to this method is that the password is read on the fly during the data download process and is not stored in code. Also if you were to save your R session, the password would not be stored as an object.</p>
<p>Download Ben’s example for how to access the Human Mortality data using <a href="">HMDHFplus</a>
<a href="https://raw.githubusercontent.com/hanowell/uwsoc533a/main/gists/HMDHFDplus-gist.R">HMDHFDplus-gist.R</a>. Here is an annotated version:</p>
<div class="sourceCode" id="cb219"><pre class="sourceCode md"><code class="sourceCode markdown"><span id="cb219-1"><a href="week2.html#cb219-1" aria-hidden="true" tabindex="-1"></a><span class="fu"># load required packages</span></span>
<span id="cb219-2"><a href="week2.html#cb219-2" aria-hidden="true" tabindex="-1"></a>library(HMDHFDplus)</span>
<span id="cb219-3"><a href="week2.html#cb219-3" aria-hidden="true" tabindex="-1"></a>library(keyring)</span>
<span id="cb219-4"><a href="week2.html#cb219-4" aria-hidden="true" tabindex="-1"></a>library(tidyverse)</span>
<span id="cb219-5"><a href="week2.html#cb219-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb219-6"><a href="week2.html#cb219-6" aria-hidden="true" tabindex="-1"></a><span class="fu"># note to see country codes, </span></span>
<span id="cb219-7"><a href="week2.html#cb219-7" aria-hidden="true" tabindex="-1"></a><span class="fu"># https://www.mortality.org/cgi-bin/hmd/DataAvailability.php</span></span>
<span id="cb219-8"><a href="week2.html#cb219-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb219-9"><a href="week2.html#cb219-9" aria-hidden="true" tabindex="-1"></a><span class="fu"># Running for a single country with item left NULL lists available series</span></span>
<span id="cb219-10"><a href="week2.html#cb219-10" aria-hidden="true" tabindex="-1"></a><span class="fu"># for that country and ask for user entry of desired item</span></span>
<span id="cb219-11"><a href="week2.html#cb219-11" aria-hidden="true" tabindex="-1"></a><span class="fu"># HMDHFDplus::readHMDweb(</span></span>
<span id="cb219-12"><a href="week2.html#cb219-12" aria-hidden="true" tabindex="-1"></a><span class="fu">#   CNTRY = "USA",</span></span>
<span id="cb219-13"><a href="week2.html#cb219-13" aria-hidden="true" tabindex="-1"></a><span class="fu">#   username = keyring::key_list("human-mortality-database")$username,</span></span>
<span id="cb219-14"><a href="week2.html#cb219-14" aria-hidden="true" tabindex="-1"></a><span class="fu">#   password = keyring::key_get(</span></span>
<span id="cb219-15"><a href="week2.html#cb219-15" aria-hidden="true" tabindex="-1"></a><span class="fu">#     service = "human-mortality-database",</span></span>
<span id="cb219-16"><a href="week2.html#cb219-16" aria-hidden="true" tabindex="-1"></a><span class="fu">#     username = keyring::key_list("human-mortality-database")$username</span></span>
<span id="cb219-17"><a href="week2.html#cb219-17" aria-hidden="true" tabindex="-1"></a><span class="fu">#   )</span></span>
<span id="cb219-18"><a href="week2.html#cb219-18" aria-hidden="true" tabindex="-1"></a><span class="fu"># )</span></span>
<span id="cb219-19"><a href="week2.html#cb219-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb219-20"><a href="week2.html#cb219-20" aria-hidden="true" tabindex="-1"></a><span class="fu"># Function to download a specified HMD data set item for a single county</span></span>
<span id="cb219-21"><a href="week2.html#cb219-21" aria-hidden="true" tabindex="-1"></a><span class="fu"># the country code is referenced as "CNTRY"</span></span>
<span id="cb219-22"><a href="week2.html#cb219-22" aria-hidden="true" tabindex="-1"></a><span class="fu"># the "item" is the base name of the link with ".txt" removed. For example,</span></span>
<span id="cb219-23"><a href="week2.html#cb219-23" aria-hidden="true" tabindex="-1"></a><span class="fu"># https://www.mortality.org/hmd/ISR/STATS/Mx_1x1.txt</span></span>
<span id="cb219-24"><a href="week2.html#cb219-24" aria-hidden="true" tabindex="-1"></a><span class="fu">#                                         Mx_1x1       &lt;&lt;- this is the item for 1 year x 1 year death rates</span></span>
<span id="cb219-25"><a href="week2.html#cb219-25" aria-hidden="true" tabindex="-1"></a>read_hmd_country &lt;- function(CNTRY, item) {</span>
<span id="cb219-26"><a href="week2.html#cb219-26" aria-hidden="true" tabindex="-1"></a>  HMDHFDplus::readHMDweb(</span>
<span id="cb219-27"><a href="week2.html#cb219-27" aria-hidden="true" tabindex="-1"></a>    # the country from the function call</span>
<span id="cb219-28"><a href="week2.html#cb219-28" aria-hidden="true" tabindex="-1"></a>    CNTRY = CNTRY,</span>
<span id="cb219-29"><a href="week2.html#cb219-29" aria-hidden="true" tabindex="-1"></a>    # the item to download</span>
<span id="cb219-30"><a href="week2.html#cb219-30" aria-hidden="true" tabindex="-1"></a>    item = item,</span>
<span id="cb219-31"><a href="week2.html#cb219-31" aria-hidden="true" tabindex="-1"></a>    # the username from this key's record</span>
<span id="cb219-32"><a href="week2.html#cb219-32" aria-hidden="true" tabindex="-1"></a>    username = keyring::key_list("human-mortality-database")$username,</span>
<span id="cb219-33"><a href="week2.html#cb219-33" aria-hidden="true" tabindex="-1"></a>    # the password for this key's record</span>
<span id="cb219-34"><a href="week2.html#cb219-34" aria-hidden="true" tabindex="-1"></a>    password = keyring::key_get(</span>
<span id="cb219-35"><a href="week2.html#cb219-35" aria-hidden="true" tabindex="-1"></a>      service = "human-mortality-database",</span>
<span id="cb219-36"><a href="week2.html#cb219-36" aria-hidden="true" tabindex="-1"></a>      username = keyring::key_list("human-mortality-database")$username</span>
<span id="cb219-37"><a href="week2.html#cb219-37" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb219-38"><a href="week2.html#cb219-38" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb219-39"><a href="week2.html#cb219-39" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb219-40"><a href="week2.html#cb219-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb219-41"><a href="week2.html#cb219-41" aria-hidden="true" tabindex="-1"></a><span class="fu"># Help function to list the available countries</span></span>
<span id="cb219-42"><a href="week2.html#cb219-42" aria-hidden="true" tabindex="-1"></a><span class="fu"># this generates a vector of all country abbreviations</span></span>
<span id="cb219-43"><a href="week2.html#cb219-43" aria-hidden="true" tabindex="-1"></a>countries &lt;- HMDHFDplus::getHMDcountries()</span>
<span id="cb219-44"><a href="week2.html#cb219-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb219-45"><a href="week2.html#cb219-45" aria-hidden="true" tabindex="-1"></a><span class="fu"># Download a data set iteratively for all countries using purrr::map()</span></span>
<span id="cb219-46"><a href="week2.html#cb219-46" aria-hidden="true" tabindex="-1"></a><span class="fu"># In this case, age-specific mortality in 1-year periods x 1-year age groups</span></span>
<span id="cb219-47"><a href="week2.html#cb219-47" aria-hidden="true" tabindex="-1"></a><span class="fu"># for all 1-year periods available</span></span>
<span id="cb219-48"><a href="week2.html#cb219-48" aria-hidden="true" tabindex="-1"></a><span class="fu"># output is a data frame named "mx_1x1"</span></span>
<span id="cb219-49"><a href="week2.html#cb219-49" aria-hidden="true" tabindex="-1"></a>mx_1x1 &lt;- countries %&gt;%</span>
<span id="cb219-50"><a href="week2.html#cb219-50" aria-hidden="true" tabindex="-1"></a>    # Returns a list of data.frames, adding a column for country code to each</span>
<span id="cb219-51"><a href="week2.html#cb219-51" aria-hidden="true" tabindex="-1"></a>    # the map() function performs a run of Ben's read_hmd_country() function for each listed country</span>
<span id="cb219-52"><a href="week2.html#cb219-52" aria-hidden="true" tabindex="-1"></a>    purrr::map_dfr(function(country) {</span>
<span id="cb219-53"><a href="week2.html#cb219-53" aria-hidden="true" tabindex="-1"></a>        # the item to read is 1 x 1 death rates</span>
<span id="cb219-54"><a href="week2.html#cb219-54" aria-hidden="true" tabindex="-1"></a>        read_hmd_country(country, "Mx_1x1") %&gt;%</span>
<span id="cb219-55"><a href="week2.html#cb219-55" aria-hidden="true" tabindex="-1"></a>            # this adds the column "country" storing the country ISO code</span>
<span id="cb219-56"><a href="week2.html#cb219-56" aria-hidden="true" tabindex="-1"></a>            dplyr::mutate(country = country)</span>
<span id="cb219-57"><a href="week2.html#cb219-57" aria-hidden="true" tabindex="-1"></a>    }) %&gt;%</span>
<span id="cb219-58"><a href="week2.html#cb219-58" aria-hidden="true" tabindex="-1"></a>    # Phil added this to make it a tibble</span>
<span id="cb219-59"><a href="week2.html#cb219-59" aria-hidden="true" tabindex="-1"></a>    tibble()</span></code></pre></div>
</div>
<div id="human-mortality-database-naming-conventions" class="section level3" number="2.4.2">
<h3>
<span class="header-section-number">2.4.2</span> Human Mortality Database naming conventions<a class="anchor" aria-label="anchor" href="#human-mortality-database-naming-conventions"><i class="fas fa-link"></i></a>
</h3>
<div id="mortality-table-naming-conventions" class="section level4" number="2.4.2.1">
<h4>
<span class="header-section-number">2.4.2.1</span> Mortality table naming conventions<a class="anchor" aria-label="anchor" href="#mortality-table-naming-conventions"><i class="fas fa-link"></i></a>
</h4>
<p>The deaths tables are named with coding <code>[Deaths]_[length of age interval in years]x[length of period in years].txt</code>, for example deaths for each one-year age class over each year would be in a table named <code>Deaths_1x1.txt</code>; deaths for each one-year age class over 5 year intervals would be named <code>Deaths_1x5.txt</code>; deaths for 5-year age classes aggregated over 5 year intervals would be named <code>Deaths_5x5.txt</code>.</p>
<p>####Life table naming conventions
Data in the HMD life tables are coded <code>[one-letter sex code]ltper_[length of age interval in years]x[length of period in years].txt</code></p>
<p>The one-letter sex codes:</p>
<p>b: Both male and female
f: Female
m: Male</p>
<p>For example, for females listed in one-year agre classes over each year, the file would be named <code>fltper_1x1.txt</code>, whereas for males in 5-year age classes aggregated over 10-year intervals, the table would be named <code>mltper_5x10.txt</code>.</p>
<hr>
<p>Rendered at <tt>2022-02-18 14:22:30</tt></p>
</div>
</div>
</div>
<div id="source-code-1" class="section level2" number="2.5">
<h2>
<span class="header-section-number">2.5</span> Source code<a class="anchor" aria-label="anchor" href="#source-code-1"><i class="fas fa-link"></i></a>
</h2>
<p>File is at H:/csde502-winter-2022-main/02-week02.Rmd.</p>
<div id="source-code-for-this-document-1" class="section level3" number="2.5.1">
<h3>
<span class="header-section-number">2.5.1</span> Source code for this document<a class="anchor" aria-label="anchor" href="#source-code-for-this-document-1"><i class="fas fa-link"></i></a>
</h3>
<div class="sourceCode" id="cb220"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb220-1"><a href="week2.html#cb220-1" aria-hidden="true" tabindex="-1"></a>pacman<span class="sc">::</span><span class="fu">p_load</span>(tidyverse, magrittr, knitr, kableExtra, readstata13, stargazer, pander, captioner, keyring, HMDHFDplus, flextable)</span>
<span id="cb220-2"><a href="week2.html#cb220-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb220-3"><a href="week2.html#cb220-3" aria-hidden="true" tabindex="-1"></a><span class="co"># captions</span></span>
<span id="cb220-4"><a href="week2.html#cb220-4" aria-hidden="true" tabindex="-1"></a>figure_nums <span class="ot">&lt;-</span> <span class="fu">captioner</span>(<span class="at">prefix =</span> <span class="st">"Figure"</span>)</span>
<span id="cb220-5"><a href="week2.html#cb220-5" aria-hidden="true" tabindex="-1"></a>table_nums <span class="ot">&lt;-</span> <span class="fu">captioner</span>(<span class="at">prefix =</span> <span class="st">"Table"</span>)</span>
<span id="cb220-6"><a href="week2.html#cb220-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb220-7"><a href="week2.html#cb220-7" aria-hidden="true" tabindex="-1"></a><span class="co"># path to this file name</span></span>
<span id="cb220-8"><a href="week2.html#cb220-8" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">interactive</span>()) {</span>
<span id="cb220-9"><a href="week2.html#cb220-9" aria-hidden="true" tabindex="-1"></a>    fnamepath <span class="ot">&lt;-</span> <span class="fu">current_input</span>(<span class="at">dir =</span> <span class="cn">TRUE</span>)</span>
<span id="cb220-10"><a href="week2.html#cb220-10" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb220-11"><a href="week2.html#cb220-11" aria-hidden="true" tabindex="-1"></a><span class="co"># generate the R code to run in class</span></span>
<span id="cb220-12"><a href="week2.html#cb220-12" aria-hidden="true" tabindex="-1"></a><span class="co"># O &lt;- knitr::purl(input = "02-week02.Rmd", output = "r_code/week02.R", quiet = TRUE, documentation = 1)</span></span>
<span id="cb220-13"><a href="week2.html#cb220-13" aria-hidden="true" tabindex="-1"></a><span class="co"># read this for later</span></span>
<span id="cb220-14"><a href="week2.html#cb220-14" aria-hidden="true" tabindex="-1"></a>etdata <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"https://raw.githubusercontent.com/teuschb/hr_data/master/datasets/turnover_babushkin.csv"</span>)</span>
<span id="cb220-15"><a href="week2.html#cb220-15" aria-hidden="true" tabindex="-1"></a>The mean age of the subjects <span class="cf">in</span> the Babushkin data was <span class="st">`</span><span class="at">r mean(etdata$age) %&gt;% round(1)</span><span class="st">`</span> years.</span>
<span id="cb220-16"><a href="week2.html#cb220-16" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="fu">readLines</span>(<span class="st">"files/week02/rmd_insert_text_01.txt"</span>), <span class="at">sep =</span> <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb220-17"><a href="week2.html#cb220-17" aria-hidden="true" tabindex="-1"></a><span class="co"># since loading the data takes awhile, only load the data if necessary -- won't load if it was done already</span></span>
<span id="cb220-18"><a href="week2.html#cb220-18" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">exists</span>(<span class="st">"dat"</span>)) {</span>
<span id="cb220-19"><a href="week2.html#cb220-19" aria-hidden="true" tabindex="-1"></a>    dat <span class="ot">&lt;-</span> <span class="fu">read.dta13</span>(<span class="st">"https://csde-uw.github.io/csde502-winter-2022/data/AHwave1_v1.dta"</span>)</span>
<span id="cb220-20"><a href="week2.html#cb220-20" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb220-21"><a href="week2.html#cb220-21" aria-hidden="true" tabindex="-1"></a><span class="co"># birth year = h1gi1y</span></span>
<span id="cb220-22"><a href="week2.html#cb220-22" aria-hidden="true" tabindex="-1"></a><span class="co"># drop "Refused" birth year</span></span>
<span id="cb220-23"><a href="week2.html#cb220-23" aria-hidden="true" tabindex="-1"></a><span class="co"># for birth year and interview year, replace anything before white space, convert to numeric</span></span>
<span id="cb220-24"><a href="week2.html#cb220-24" aria-hidden="true" tabindex="-1"></a><span class="co"># subtract interview year - birth year</span></span>
<span id="cb220-25"><a href="week2.html#cb220-25" aria-hidden="true" tabindex="-1"></a>ages <span class="ot">&lt;-</span> dat <span class="sc">%&gt;%</span></span>
<span id="cb220-26"><a href="week2.html#cb220-26" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">str_detect</span>(h1gi1y, <span class="st">"Refused"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb220-27"><a href="week2.html#cb220-27" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(iyear, h1gi1y) <span class="sc">%&gt;%</span></span>
<span id="cb220-28"><a href="week2.html#cb220-28" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(</span>
<span id="cb220-29"><a href="week2.html#cb220-29" aria-hidden="true" tabindex="-1"></a>        <span class="at">yi =</span> <span class="fu">str_replace</span>(iyear, <span class="st">".*</span><span class="sc">\\</span><span class="st">s"</span>, <span class="st">""</span>) <span class="sc">%&gt;%</span> <span class="fu">as.numeric</span>(),</span>
<span id="cb220-30"><a href="week2.html#cb220-30" aria-hidden="true" tabindex="-1"></a>        <span class="at">yb =</span> <span class="fu">str_replace</span>(h1gi1y, <span class="st">".*</span><span class="sc">\\</span><span class="st">s"</span>, <span class="st">""</span>) <span class="sc">%&gt;%</span> <span class="fu">as.numeric</span>(),</span>
<span id="cb220-31"><a href="week2.html#cb220-31" aria-hidden="true" tabindex="-1"></a>        <span class="at">age =</span> yi <span class="sc">-</span> yb</span>
<span id="cb220-32"><a href="week2.html#cb220-32" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb220-33"><a href="week2.html#cb220-33" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(ages<span class="sc">$</span>age, <span class="at">xlab =</span> <span class="st">"age (years)"</span>, <span class="at">las =</span> <span class="dv">1</span>)</span>
<span id="cb220-34"><a href="week2.html#cb220-34" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="fu">readLines</span>(<span class="st">"files/week02/geom_histogram.txt"</span>), <span class="at">sep =</span> <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb220-35"><a href="week2.html#cb220-35" aria-hidden="true" tabindex="-1"></a><span class="co"># how many unique bins?</span></span>
<span id="cb220-36"><a href="week2.html#cb220-36" aria-hidden="true" tabindex="-1"></a>bins <span class="ot">&lt;-</span> <span class="fu">length</span>(<span class="fu">unique</span>(ages<span class="sc">$</span>age))</span>
<span id="cb220-37"><a href="week2.html#cb220-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb220-38"><a href="week2.html#cb220-38" aria-hidden="true" tabindex="-1"></a><span class="co"># create the graphic</span></span>
<span id="cb220-39"><a href="week2.html#cb220-39" aria-hidden="true" tabindex="-1"></a>g <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data =</span> ages, <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> age)) <span class="sc">+</span></span>
<span id="cb220-40"><a href="week2.html#cb220-40" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_histogram</span>(<span class="at">bins =</span> bins)</span>
<span id="cb220-41"><a href="week2.html#cb220-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb220-42"><a href="week2.html#cb220-42" aria-hidden="true" tabindex="-1"></a><span class="co"># print the graphic</span></span>
<span id="cb220-43"><a href="week2.html#cb220-43" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(g)</span>
<span id="cb220-44"><a href="week2.html#cb220-44" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="fu">readLines</span>(<span class="st">"files/week02/babushkin_boxplot.txt"</span>), <span class="at">sep =</span> <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb220-45"><a href="week2.html#cb220-45" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> etdata, <span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">reorder</span>(profession, selfcontrol), <span class="at">y =</span> selfcontrol)) <span class="sc">+</span></span>
<span id="cb220-46"><a href="week2.html#cb220-46" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_boxplot</span>() <span class="sc">+</span></span>
<span id="cb220-47"><a href="week2.html#cb220-47" aria-hidden="true" tabindex="-1"></a>    <span class="fu">coord_flip</span>()</span>
<span id="cb220-48"><a href="week2.html#cb220-48" aria-hidden="true" tabindex="-1"></a><span class="fu">pdf</span>(<span class="at">file =</span> <span class="st">"ah_age_hist.pdf"</span>, <span class="at">width =</span> <span class="dv">5</span>, <span class="at">height =</span> <span class="dv">5</span>)</span>
<span id="cb220-49"><a href="week2.html#cb220-49" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(ages<span class="sc">$</span>age, <span class="at">xlab =</span> <span class="st">"age (years)"</span>, <span class="at">las =</span> <span class="dv">1</span>)</span>
<span id="cb220-50"><a href="week2.html#cb220-50" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">dev.off</span>()</span>
<span id="cb220-51"><a href="week2.html#cb220-51" aria-hidden="true" tabindex="-1"></a><span class="fu">png</span>(<span class="at">file =</span> <span class="st">"ah_age_hist.png"</span>, <span class="at">width =</span> <span class="dv">5</span>, <span class="at">height =</span> <span class="dv">5</span>, <span class="at">units =</span> <span class="st">"in"</span>, <span class="at">res =</span> <span class="dv">300</span>)</span>
<span id="cb220-52"><a href="week2.html#cb220-52" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(ages<span class="sc">$</span>age, <span class="at">xlab =</span> <span class="st">"age (years)"</span>, <span class="at">las =</span> <span class="dv">1</span>)</span>
<span id="cb220-53"><a href="week2.html#cb220-53" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">dev.off</span>()</span>
<span id="cb220-54"><a href="week2.html#cb220-54" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(</span>
<span id="cb220-55"><a href="week2.html#cb220-55" aria-hidden="true" tabindex="-1"></a>    <span class="at">filename =</span> <span class="st">"ah_age_hist_ggplot.pdf"</span>,</span>
<span id="cb220-56"><a href="week2.html#cb220-56" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot =</span> g, <span class="at">device =</span> <span class="st">"pdf"</span>,</span>
<span id="cb220-57"><a href="week2.html#cb220-57" aria-hidden="true" tabindex="-1"></a>    <span class="at">width =</span> <span class="dv">5</span>, <span class="at">height =</span> <span class="dv">5</span></span>
<span id="cb220-58"><a href="week2.html#cb220-58" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb220-59"><a href="week2.html#cb220-59" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(</span>
<span id="cb220-60"><a href="week2.html#cb220-60" aria-hidden="true" tabindex="-1"></a>    <span class="at">filename =</span> <span class="st">"ah_age_hist_ggplot.png"</span>,</span>
<span id="cb220-61"><a href="week2.html#cb220-61" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot =</span> g, <span class="at">device =</span> <span class="st">"png"</span>,</span>
<span id="cb220-62"><a href="week2.html#cb220-62" aria-hidden="true" tabindex="-1"></a>    <span class="at">width =</span> <span class="dv">5</span>, <span class="at">height =</span> <span class="dv">5</span>,</span>
<span id="cb220-63"><a href="week2.html#cb220-63" aria-hidden="true" tabindex="-1"></a>    <span class="at">units =</span> <span class="st">"in"</span>, <span class="at">dpi =</span> <span class="dv">300</span></span>
<span id="cb220-64"><a href="week2.html#cb220-64" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb220-65"><a href="week2.html#cb220-65" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="fu">readLines</span>(<span class="st">"files/week02/rmd_insert_text_02.txt"</span>), <span class="at">sep =</span> <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb220-66"><a href="week2.html#cb220-66" aria-hidden="true" tabindex="-1"></a><span class="fu">include_graphics</span>(<span class="st">"ah_age_hist.pdf"</span>)</span>
<span id="cb220-67"><a href="week2.html#cb220-67" aria-hidden="true" tabindex="-1"></a><span class="fu">include_graphics</span>(<span class="st">"ah_age_hist.pdf"</span>)</span>
<span id="cb220-68"><a href="week2.html#cb220-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb220-69"><a href="week2.html#cb220-69" aria-hidden="true" tabindex="-1"></a><span class="fu">include_graphics</span>(<span class="st">"ah_age_hist.pdf"</span>)</span>
<span id="cb220-70"><a href="week2.html#cb220-70" aria-hidden="true" tabindex="-1"></a><span class="fu">include_graphics</span>(<span class="st">"ah_age_hist_ggplot.png"</span>)</span>
<span id="cb220-71"><a href="week2.html#cb220-71" aria-hidden="true" tabindex="-1"></a><span class="fu">include_graphics</span>(<span class="st">"ah_age_hist_ggplot.png"</span>)</span>
<span id="cb220-72"><a href="week2.html#cb220-72" aria-hidden="true" tabindex="-1"></a>dat <span class="ot">&lt;-</span> readstata13<span class="sc">::</span><span class="fu">read.dta13</span>(<span class="st">"http://staff.washington.edu/phurvitz/csde502_winter_2021/data/AHwave1_v1.dta"</span>)</span>
<span id="cb220-73"><a href="week2.html#cb220-73" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb220-74"><a href="week2.html#cb220-74" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb220-75"><a href="week2.html#cb220-75" aria-hidden="true" tabindex="-1"></a><span class="co"># ordered factor; use fct_rev to establish the correct ordering where better health ranks higher</span></span>
<span id="cb220-76"><a href="week2.html#cb220-76" aria-hidden="true" tabindex="-1"></a>dat <span class="sc">%&lt;&gt;%</span></span>
<span id="cb220-77"><a href="week2.html#cb220-77" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">h1gh1 =</span> <span class="fu">fct_rev</span>(<span class="fu">as.ordered</span>(h1gh1)))</span>
<span id="cb220-78"><a href="week2.html#cb220-78" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb220-79"><a href="week2.html#cb220-79" aria-hidden="true" tabindex="-1"></a><span class="co"># stratify health; first we need to catch the "don't know" and "refused" as NAs</span></span>
<span id="cb220-80"><a href="week2.html#cb220-80" aria-hidden="true" tabindex="-1"></a>dat <span class="sc">%&lt;&gt;%</span></span>
<span id="cb220-81"><a href="week2.html#cb220-81" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(</span>
<span id="cb220-82"><a href="week2.html#cb220-82" aria-hidden="true" tabindex="-1"></a>        <span class="at">health =</span></span>
<span id="cb220-83"><a href="week2.html#cb220-83" aria-hidden="true" tabindex="-1"></a>            <span class="fu">case_when</span>(</span>
<span id="cb220-84"><a href="week2.html#cb220-84" aria-hidden="true" tabindex="-1"></a>                h1gh1 <span class="sc">&lt;=</span> <span class="st">"(6) Refused"</span> <span class="sc">~</span> <span class="fu">as.character</span>(<span class="cn">NA</span>),</span>
<span id="cb220-85"><a href="week2.html#cb220-85" aria-hidden="true" tabindex="-1"></a>                h1gh1 <span class="sc">&gt;</span> <span class="st">"(3) Good"</span> <span class="sc">~</span> <span class="st">"high"</span>,</span>
<span id="cb220-86"><a href="week2.html#cb220-86" aria-hidden="true" tabindex="-1"></a>                h1gh1 <span class="sc">&lt;=</span> <span class="st">"(3) Good"</span> <span class="sc">~</span> <span class="st">"low"</span></span>
<span id="cb220-87"><a href="week2.html#cb220-87" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="cb220-88"><a href="week2.html#cb220-88" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb220-89"><a href="week2.html#cb220-89" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb220-90"><a href="week2.html#cb220-90" aria-hidden="true" tabindex="-1"></a><span class="co"># tabulate by White</span></span>
<span id="cb220-91"><a href="week2.html#cb220-91" aria-hidden="true" tabindex="-1"></a>tabhealth_white <span class="ot">&lt;-</span> dat <span class="sc">%&gt;%</span></span>
<span id="cb220-92"><a href="week2.html#cb220-92" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(health, <span class="at">white =</span> h1gi6a) <span class="sc">%&gt;%</span></span>
<span id="cb220-93"><a href="week2.html#cb220-93" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarise</span>(<span class="at">n =</span> <span class="fu">n</span>(), <span class="at">.groups =</span> <span class="st">"drop_last"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb220-94"><a href="week2.html#cb220-94" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="st">"%"</span> <span class="ot">=</span> <span class="fu">round</span>(n <span class="sc">/</span> <span class="fu">sum</span>(n) <span class="sc">*</span> <span class="dv">100</span>, <span class="dv">2</span>))</span>
<span id="cb220-95"><a href="week2.html#cb220-95" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb220-96"><a href="week2.html#cb220-96" aria-hidden="true" tabindex="-1"></a><span class="co"># tabulate by African American</span></span>
<span id="cb220-97"><a href="week2.html#cb220-97" aria-hidden="true" tabindex="-1"></a>tabhealth_afram <span class="ot">&lt;-</span> dat <span class="sc">%&gt;%</span></span>
<span id="cb220-98"><a href="week2.html#cb220-98" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(health, <span class="at">afram =</span> h1gi6b) <span class="sc">%&gt;%</span></span>
<span id="cb220-99"><a href="week2.html#cb220-99" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarise</span>(<span class="at">n =</span> <span class="fu">n</span>(), <span class="at">.groups =</span> <span class="st">"drop_last"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb220-100"><a href="week2.html#cb220-100" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="st">"%"</span> <span class="ot">=</span> <span class="fu">round</span>(n <span class="sc">/</span> <span class="fu">sum</span>(n) <span class="sc">*</span> <span class="dv">100</span>, <span class="dv">2</span>))</span>
<span id="cb220-101"><a href="week2.html#cb220-101" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb220-102"><a href="week2.html#cb220-102" aria-hidden="true" tabindex="-1"></a><span class="co"># column-bind and remove the second "health" column</span></span>
<span id="cb220-103"><a href="week2.html#cb220-103" aria-hidden="true" tabindex="-1"></a>sum_health_white_afram <span class="ot">&lt;-</span> <span class="fu">cbind</span>(tabhealth_white, tabhealth_afram) <span class="sc">%&gt;%</span></span>
<span id="cb220-104"><a href="week2.html#cb220-104" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(<span class="sc">-</span><span class="dv">5</span>)</span>
<span id="cb220-105"><a href="week2.html#cb220-105" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(sum_health_white_afram)</span>
<span id="cb220-106"><a href="week2.html#cb220-106" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(sum_health_white_afram,</span>
<span id="cb220-107"><a href="week2.html#cb220-107" aria-hidden="true" tabindex="-1"></a>    <span class="at">col.names =</span> <span class="fu">c</span>(<span class="st">"health"</span>, <span class="st">"race"</span>, <span class="st">"n"</span>, <span class="st">"%"</span>, <span class="st">"race"</span>, <span class="st">"n"</span>, <span class="st">"%"</span>)</span>
<span id="cb220-108"><a href="week2.html#cb220-108" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span></span>
<span id="cb220-109"><a href="week2.html#cb220-109" aria-hidden="true" tabindex="-1"></a>    <span class="fu">kable_styling</span>(<span class="at">bootstrap_options =</span> <span class="fu">c</span>(<span class="st">"striped"</span>, <span class="st">"hover"</span>, <span class="st">"condensed"</span>, <span class="st">"responsive"</span>), <span class="at">full_width =</span> F, <span class="at">position =</span> <span class="st">"left"</span>)</span>
<span id="cb220-110"><a href="week2.html#cb220-110" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(sum_health_white_afram,</span>
<span id="cb220-111"><a href="week2.html#cb220-111" aria-hidden="true" tabindex="-1"></a>    <span class="at">col.names =</span> <span class="fu">c</span>(<span class="st">"health"</span>, <span class="st">"race"</span>, <span class="st">"n"</span>, <span class="st">"%"</span>, <span class="st">"race"</span>, <span class="st">"n"</span>, <span class="st">"%"</span>)</span>
<span id="cb220-112"><a href="week2.html#cb220-112" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span></span>
<span id="cb220-113"><a href="week2.html#cb220-113" aria-hidden="true" tabindex="-1"></a>    <span class="fu">kable_styling</span>(<span class="at">bootstrap_options =</span> <span class="fu">c</span>(<span class="st">"striped"</span>, <span class="st">"hover"</span>, <span class="st">"condensed"</span>, <span class="st">"responsive"</span>), <span class="at">full_width =</span> F, <span class="at">position =</span> <span class="st">"left"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb220-114"><a href="week2.html#cb220-114" aria-hidden="true" tabindex="-1"></a>    <span class="fu">add_header_above</span>(<span class="fu">c</span>(<span class="st">" "</span> <span class="ot">=</span> <span class="dv">1</span>, <span class="st">"White"</span> <span class="ot">=</span> <span class="dv">3</span>, <span class="st">"African American"</span> <span class="ot">=</span> <span class="dv">3</span>))</span>
<span id="cb220-115"><a href="week2.html#cb220-115" aria-hidden="true" tabindex="-1"></a>sum_health_white_afram <span class="sc">%&gt;%</span></span>
<span id="cb220-116"><a href="week2.html#cb220-116" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(<span class="sc">-</span><span class="dv">1</span>) <span class="sc">%&gt;%</span></span>
<span id="cb220-117"><a href="week2.html#cb220-117" aria-hidden="true" tabindex="-1"></a>    <span class="fu">kable</span>(<span class="at">col.names =</span> <span class="fu">c</span>(<span class="st">"race"</span>, <span class="st">"n"</span>, <span class="st">"%"</span>, <span class="st">"race"</span>, <span class="st">"n"</span>, <span class="st">"%"</span>), <span class="at">align =</span> <span class="fu">c</span>(<span class="fu">rep</span>(<span class="st">"r"</span>, <span class="at">times =</span> <span class="dv">6</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb220-118"><a href="week2.html#cb220-118" aria-hidden="true" tabindex="-1"></a>    <span class="fu">kable_styling</span>(<span class="at">bootstrap_options =</span> <span class="fu">c</span>(<span class="st">"striped"</span>, <span class="st">"hover"</span>, <span class="st">"condensed"</span>, <span class="st">"responsive"</span>), <span class="at">full_width =</span> F, <span class="at">position =</span> <span class="st">"left"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb220-119"><a href="week2.html#cb220-119" aria-hidden="true" tabindex="-1"></a>    <span class="fu">add_header_above</span>(<span class="fu">c</span>(<span class="st">"White"</span> <span class="ot">=</span> <span class="dv">3</span>, <span class="st">"African American"</span> <span class="ot">=</span> <span class="dv">3</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb220-120"><a href="week2.html#cb220-120" aria-hidden="true" tabindex="-1"></a>    <span class="fu">pack_rows</span>(<span class="st">"health high"</span>, <span class="dv">1</span>, <span class="dv">4</span>) <span class="sc">%&gt;%</span></span>
<span id="cb220-121"><a href="week2.html#cb220-121" aria-hidden="true" tabindex="-1"></a>    <span class="fu">pack_rows</span>(<span class="st">"health low"</span>, <span class="dv">5</span>, <span class="dv">8</span>) <span class="sc">%&gt;%</span></span>
<span id="cb220-122"><a href="week2.html#cb220-122" aria-hidden="true" tabindex="-1"></a>    <span class="fu">pack_rows</span>(<span class="st">"health N/A"</span>, <span class="dv">9</span>, <span class="dv">12</span>)</span>
<span id="cb220-123"><a href="week2.html#cb220-123" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="fu">readLines</span>(<span class="st">"files/week02/etdata_kable.txt"</span>), <span class="at">sep =</span> <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb220-124"><a href="week2.html#cb220-124" aria-hidden="true" tabindex="-1"></a>etdata <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"https://raw.githubusercontent.com/teuschb/hr_data/master/datasets/turnover_babushkin.csv"</span>)</span>
<span id="cb220-125"><a href="week2.html#cb220-125" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb220-126"><a href="week2.html#cb220-126" aria-hidden="true" tabindex="-1"></a><span class="co"># create 10-year age classes</span></span>
<span id="cb220-127"><a href="week2.html#cb220-127" aria-hidden="true" tabindex="-1"></a>etdata <span class="sc">%&lt;&gt;%</span></span>
<span id="cb220-128"><a href="week2.html#cb220-128" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">age_decade =</span> plyr<span class="sc">::</span><span class="fu">round_any</span>(age, <span class="dv">10</span>, <span class="at">f =</span> ceiling))</span>
<span id="cb220-129"><a href="week2.html#cb220-129" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb220-130"><a href="week2.html#cb220-130" aria-hidden="true" tabindex="-1"></a><span class="co"># summarize</span></span>
<span id="cb220-131"><a href="week2.html#cb220-131" aria-hidden="true" tabindex="-1"></a>etdata <span class="sc">%&gt;%</span></span>
<span id="cb220-132"><a href="week2.html#cb220-132" aria-hidden="true" tabindex="-1"></a>    <span class="co"># group by gender and age class</span></span>
<span id="cb220-133"><a href="week2.html#cb220-133" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(gender, age_decade) <span class="sc">%&gt;%</span></span>
<span id="cb220-134"><a href="week2.html#cb220-134" aria-hidden="true" tabindex="-1"></a>    <span class="co"># mean and sd</span></span>
<span id="cb220-135"><a href="week2.html#cb220-135" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">summarize</span>(</span>
<span id="cb220-136"><a href="week2.html#cb220-136" aria-hidden="true" tabindex="-1"></a>        <span class="at">mean_tenure_months =</span> <span class="fu">mean</span>(tenure) <span class="sc">%&gt;%</span> <span class="fu">round</span>(<span class="dv">1</span>),</span>
<span id="cb220-137"><a href="week2.html#cb220-137" aria-hidden="true" tabindex="-1"></a>        <span class="at">sd_tenure_months =</span> <span class="fu">sd</span>(tenure) <span class="sc">%&gt;%</span> <span class="fu">round</span>(<span class="dv">1</span>),</span>
<span id="cb220-138"><a href="week2.html#cb220-138" aria-hidden="true" tabindex="-1"></a>        <span class="at">.groups =</span> <span class="st">"keep"</span></span>
<span id="cb220-139"><a href="week2.html#cb220-139" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span></span>
<span id="cb220-140"><a href="week2.html#cb220-140" aria-hidden="true" tabindex="-1"></a>    <span class="co"># order the output by age and gender</span></span>
<span id="cb220-141"><a href="week2.html#cb220-141" aria-hidden="true" tabindex="-1"></a>    <span class="fu">arrange</span>(gender, mean_tenure_months) <span class="sc">%&gt;%</span></span>
<span id="cb220-142"><a href="week2.html#cb220-142" aria-hidden="true" tabindex="-1"></a>    <span class="co"># print it nicely</span></span>
<span id="cb220-143"><a href="week2.html#cb220-143" aria-hidden="true" tabindex="-1"></a>    <span class="fu">kable</span>() <span class="sc">%&gt;%</span></span>
<span id="cb220-144"><a href="week2.html#cb220-144" aria-hidden="true" tabindex="-1"></a>    <span class="fu">kable_styling</span>(<span class="at">bootstrap_options =</span> <span class="fu">c</span>(<span class="st">"striped"</span>, <span class="st">"hover"</span>, <span class="st">"condensed"</span>))</span>
<span id="cb220-145"><a href="week2.html#cb220-145" aria-hidden="true" tabindex="-1"></a><span class="fu">stargazer</span>(sum_health_white_afram,</span>
<span id="cb220-146"><a href="week2.html#cb220-146" aria-hidden="true" tabindex="-1"></a>    <span class="at">type =</span> <span class="st">"html"</span>,</span>
<span id="cb220-147"><a href="week2.html#cb220-147" aria-hidden="true" tabindex="-1"></a>    <span class="at">summary =</span> <span class="cn">FALSE</span>,</span>
<span id="cb220-148"><a href="week2.html#cb220-148" aria-hidden="true" tabindex="-1"></a>    <span class="at">rownames =</span> <span class="cn">FALSE</span></span>
<span id="cb220-149"><a href="week2.html#cb220-149" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb220-150"><a href="week2.html#cb220-150" aria-hidden="true" tabindex="-1"></a><span class="fu">pander</span>(sum_health_white_afram)</span>
<span id="cb220-151"><a href="week2.html#cb220-151" aria-hidden="true" tabindex="-1"></a>etdata <span class="sc">%&gt;%</span> </span>
<span id="cb220-152"><a href="week2.html#cb220-152" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(industry) <span class="sc">%&gt;%</span> </span>
<span id="cb220-153"><a href="week2.html#cb220-153" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">summarize</span>(<span class="at">n =</span> <span class="fu">n</span>(),</span>
<span id="cb220-154"><a href="week2.html#cb220-154" aria-hidden="true" tabindex="-1"></a>                     <span class="at">mean_anxiety =</span> <span class="fu">mean</span>(anxiety) <span class="sc">%&gt;%</span> <span class="fu">round</span>(<span class="dv">1</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb220-155"><a href="week2.html#cb220-155" aria-hidden="true" tabindex="-1"></a>    <span class="fu">arrange</span>(<span class="fu">desc</span>(mean_anxiety)) <span class="sc">%&gt;%</span> </span>
<span id="cb220-156"><a href="week2.html#cb220-156" aria-hidden="true" tabindex="-1"></a>DT<span class="sc">::</span><span class="fu">datatable</span>()</span>
<span id="cb220-157"><a href="week2.html#cb220-157" aria-hidden="true" tabindex="-1"></a>ft <span class="ot">&lt;-</span> <span class="fu">flextable</span>(airquality[<span class="fu">sample.int</span>(<span class="dv">10</span>), ])</span>
<span id="cb220-158"><a href="week2.html#cb220-158" aria-hidden="true" tabindex="-1"></a>ft <span class="ot">&lt;-</span> <span class="fu">add_header_row</span>(ft,</span>
<span id="cb220-159"><a href="week2.html#cb220-159" aria-hidden="true" tabindex="-1"></a>    <span class="at">colwidths =</span> <span class="fu">c</span>(<span class="dv">4</span>, <span class="dv">2</span>),</span>
<span id="cb220-160"><a href="week2.html#cb220-160" aria-hidden="true" tabindex="-1"></a>    <span class="at">values =</span> <span class="fu">c</span>(<span class="st">"Air quality"</span>, <span class="st">"Time"</span>)</span>
<span id="cb220-161"><a href="week2.html#cb220-161" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb220-162"><a href="week2.html#cb220-162" aria-hidden="true" tabindex="-1"></a>ft <span class="ot">&lt;-</span> <span class="fu">theme_vanilla</span>(ft)</span>
<span id="cb220-163"><a href="week2.html#cb220-163" aria-hidden="true" tabindex="-1"></a>ft <span class="ot">&lt;-</span> <span class="fu">add_footer_lines</span>(ft, <span class="st">"Daily air quality measurements in New York, May to September 1973."</span>)</span>
<span id="cb220-164"><a href="week2.html#cb220-164" aria-hidden="true" tabindex="-1"></a>ft <span class="ot">&lt;-</span> <span class="fu">color</span>(ft, <span class="at">part =</span> <span class="st">"footer"</span>, <span class="at">color =</span> <span class="st">"#666666"</span>)</span>
<span id="cb220-165"><a href="week2.html#cb220-165" aria-hidden="true" tabindex="-1"></a>ft <span class="ot">&lt;-</span> <span class="fu">set_caption</span>(ft, <span class="at">caption =</span> <span class="st">"New York Air Quality Measurements"</span>)</span>
<span id="cb220-166"><a href="week2.html#cb220-166" aria-hidden="true" tabindex="-1"></a>ft</span>
<span id="cb220-167"><a href="week2.html#cb220-167" aria-hidden="true" tabindex="-1"></a>diamond_dat <span class="ot">&lt;-</span> <span class="fu">nest</span>(diamonds, <span class="at">data =</span> <span class="sc">-</span><span class="fu">all_of</span>(<span class="fu">c</span>(<span class="st">"cut"</span>, <span class="st">"color"</span>))) <span class="sc">%&gt;%</span> </span>
<span id="cb220-168"><a href="week2.html#cb220-168" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb220-169"><a href="week2.html#cb220-169" aria-hidden="true" tabindex="-1"></a>    <span class="at">gg =</span> </span>
<span id="cb220-170"><a href="week2.html#cb220-170" aria-hidden="true" tabindex="-1"></a>      <span class="fu">lapply</span>(</span>
<span id="cb220-171"><a href="week2.html#cb220-171" aria-hidden="true" tabindex="-1"></a>        <span class="at">X =</span> data, </span>
<span id="cb220-172"><a href="week2.html#cb220-172" aria-hidden="true" tabindex="-1"></a>        <span class="at">FUN =</span> <span class="cf">function</span>(subdat) {</span>
<span id="cb220-173"><a href="week2.html#cb220-173" aria-hidden="true" tabindex="-1"></a>          <span class="fu">ggplot</span>(subdat, <span class="fu">aes</span>(<span class="at">x =</span> x)) <span class="sc">+</span> </span>
<span id="cb220-174"><a href="week2.html#cb220-174" aria-hidden="true" tabindex="-1"></a>            <span class="fu">geom_density</span>(<span class="at">color =</span> <span class="st">"white"</span>) <span class="sc">+</span> <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb220-175"><a href="week2.html#cb220-175" aria-hidden="true" tabindex="-1"></a>            <span class="fu">scale_x_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">11</span>)) <span class="sc">+</span></span>
<span id="cb220-176"><a href="week2.html#cb220-176" aria-hidden="true" tabindex="-1"></a>            <span class="fu">scale_y_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb220-177"><a href="week2.html#cb220-177" aria-hidden="true" tabindex="-1"></a>            <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">""</span>, <span class="at">y =</span> <span class="st">""</span>) <span class="sc">+</span> <span class="fu">theme_void</span>()</span>
<span id="cb220-178"><a href="week2.html#cb220-178" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb220-179"><a href="week2.html#cb220-179" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb220-180"><a href="week2.html#cb220-180" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb220-181"><a href="week2.html#cb220-181" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>data) <span class="sc">%&gt;%</span> </span>
<span id="cb220-182"><a href="week2.html#cb220-182" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(</span>
<span id="cb220-183"><a href="week2.html#cb220-183" aria-hidden="true" tabindex="-1"></a>    <span class="at">id_cols =</span> cut, </span>
<span id="cb220-184"><a href="week2.html#cb220-184" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_from =</span> color, </span>
<span id="cb220-185"><a href="week2.html#cb220-185" aria-hidden="true" tabindex="-1"></a>    <span class="at">values_from =</span> gg)</span>
<span id="cb220-186"><a href="week2.html#cb220-186" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb220-187"><a href="week2.html#cb220-187" aria-hidden="true" tabindex="-1"></a>diamond_dat <span class="sc">%&gt;%</span> </span>
<span id="cb220-188"><a href="week2.html#cb220-188" aria-hidden="true" tabindex="-1"></a>  <span class="fu">flextable</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb220-189"><a href="week2.html#cb220-189" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mk_par</span>(</span>
<span id="cb220-190"><a href="week2.html#cb220-190" aria-hidden="true" tabindex="-1"></a>    <span class="at">value =</span> <span class="fu">as_paragraph</span>(</span>
<span id="cb220-191"><a href="week2.html#cb220-191" aria-hidden="true" tabindex="-1"></a>      <span class="fu">gg_chunk</span>(., <span class="at">width =</span> <span class="dv">1</span>, <span class="at">height =</span> <span class="dv">1</span>, <span class="at">unit =</span> <span class="st">"cm"</span>)), </span>
<span id="cb220-192"><a href="week2.html#cb220-192" aria-hidden="true" tabindex="-1"></a>    <span class="at">j =</span> <span class="sc">~</span> . <span class="sc">-</span> cut,</span>
<span id="cb220-193"><a href="week2.html#cb220-193" aria-hidden="true" tabindex="-1"></a>    <span class="at">use_dot =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb220-194"><a href="week2.html#cb220-194" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_tron</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb220-195"><a href="week2.html#cb220-195" aria-hidden="true" tabindex="-1"></a>  <span class="fu">align</span>(<span class="at">align =</span> <span class="st">"center"</span>, <span class="at">part =</span> <span class="st">"all"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb220-196"><a href="week2.html#cb220-196" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autofit</span>()</span>
<span id="cb220-197"><a href="week2.html#cb220-197" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="fu">readLines</span>(<span class="st">"files/week02/rmd_insert_text_03.txt"</span>), <span class="at">sep =</span> <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb220-198"><a href="week2.html#cb220-198" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(cars)</span>
<span id="cb220-199"><a href="week2.html#cb220-199" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(<span class="at">x =</span> sum_health_white_afram, <span class="at">caption =</span> <span class="st">"Self-reported health by race"</span>)</span>
<span id="cb220-200"><a href="week2.html#cb220-200" aria-hidden="true" tabindex="-1"></a><span class="co"># how many unique bins?</span></span>
<span id="cb220-201"><a href="week2.html#cb220-201" aria-hidden="true" tabindex="-1"></a>bins <span class="ot">&lt;-</span> <span class="fu">length</span>(<span class="fu">unique</span>(ages<span class="sc">$</span>age))</span>
<span id="cb220-202"><a href="week2.html#cb220-202" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb220-203"><a href="week2.html#cb220-203" aria-hidden="true" tabindex="-1"></a><span class="co"># create the graphic</span></span>
<span id="cb220-204"><a href="week2.html#cb220-204" aria-hidden="true" tabindex="-1"></a>g <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data =</span> ages, <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> age)) <span class="sc">+</span></span>
<span id="cb220-205"><a href="week2.html#cb220-205" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_histogram</span>(<span class="at">bins =</span> bins)</span>
<span id="cb220-206"><a href="week2.html#cb220-206" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb220-207"><a href="week2.html#cb220-207" aria-hidden="true" tabindex="-1"></a><span class="co"># print the graphic</span></span>
<span id="cb220-208"><a href="week2.html#cb220-208" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(g)</span>
<span id="cb220-209"><a href="week2.html#cb220-209" aria-hidden="true" tabindex="-1"></a>ages <span class="sc">%&gt;%</span></span>
<span id="cb220-210"><a href="week2.html#cb220-210" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(age) <span class="sc">%&gt;%</span></span>
<span id="cb220-211"><a href="week2.html#cb220-211" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarise</span>(<span class="at">n =</span> <span class="fu">n</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb220-212"><a href="week2.html#cb220-212" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(</span>
<span id="cb220-213"><a href="week2.html#cb220-213" aria-hidden="true" tabindex="-1"></a>        <span class="at">cumsum =</span> <span class="fu">cumsum</span>(n),</span>
<span id="cb220-214"><a href="week2.html#cb220-214" aria-hidden="true" tabindex="-1"></a>        <span class="st">"%"</span> <span class="ot">=</span> <span class="fu">round</span>(n <span class="sc">/</span> <span class="fu">sum</span>(n) <span class="sc">*</span> <span class="dv">100</span>, <span class="dv">1</span>),</span>
<span id="cb220-215"><a href="week2.html#cb220-215" aria-hidden="true" tabindex="-1"></a>        <span class="st">"cum %"</span> <span class="ot">=</span> <span class="fu">round</span>(<span class="fu">cumsum</span>(n <span class="sc">/</span> <span class="fu">sum</span>(n) <span class="sc">*</span> <span class="dv">100</span>), <span class="dv">1</span>)</span>
<span id="cb220-216"><a href="week2.html#cb220-216" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span></span>
<span id="cb220-217"><a href="week2.html#cb220-217" aria-hidden="true" tabindex="-1"></a>    <span class="fu">kable</span>() <span class="sc">%&gt;%</span></span>
<span id="cb220-218"><a href="week2.html#cb220-218" aria-hidden="true" tabindex="-1"></a>    <span class="fu">kable_styling</span>(</span>
<span id="cb220-219"><a href="week2.html#cb220-219" aria-hidden="true" tabindex="-1"></a>        <span class="at">bootstrap_options =</span></span>
<span id="cb220-220"><a href="week2.html#cb220-220" aria-hidden="true" tabindex="-1"></a>            <span class="fu">c</span>(<span class="st">"striped"</span>, <span class="st">"hover"</span>, <span class="st">"condensed"</span>, <span class="st">"responsive"</span>),</span>
<span id="cb220-221"><a href="week2.html#cb220-221" aria-hidden="true" tabindex="-1"></a>        <span class="at">full_width =</span> F,</span>
<span id="cb220-222"><a href="week2.html#cb220-222" aria-hidden="true" tabindex="-1"></a>        <span class="at">position =</span> <span class="st">"left"</span></span>
<span id="cb220-223"><a href="week2.html#cb220-223" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb220-224"><a href="week2.html#cb220-224" aria-hidden="true" tabindex="-1"></a><span class="co"># get the keys</span></span>
<span id="cb220-225"><a href="week2.html#cb220-225" aria-hidden="true" tabindex="-1"></a>myKeys <span class="ot">&lt;-</span> <span class="fu">key_list</span>()</span>
<span id="cb220-226"><a href="week2.html#cb220-226" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb220-227"><a href="week2.html#cb220-227" aria-hidden="true" tabindex="-1"></a><span class="co"># Set your password for Human Mortality Database (HMD)</span></span>
<span id="cb220-228"><a href="week2.html#cb220-228" aria-hidden="true" tabindex="-1"></a><span class="co"># does a key exist? if not, create one</span></span>
<span id="cb220-229"><a href="week2.html#cb220-229" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="fu">key_list</span>(<span class="at">service =</span> <span class="st">"human-mortality-database"</span>) <span class="sc">%&gt;%</span> <span class="fu">nrow</span>() <span class="sc">==</span> <span class="dv">0</span>) {</span>
<span id="cb220-230"><a href="week2.html#cb220-230" aria-hidden="true" tabindex="-1"></a>    keyring<span class="sc">::</span><span class="fu">key_set</span>(</span>
<span id="cb220-231"><a href="week2.html#cb220-231" aria-hidden="true" tabindex="-1"></a>        <span class="at">service =</span> <span class="st">"human-mortality-database"</span>,</span>
<span id="cb220-232"><a href="week2.html#cb220-232" aria-hidden="true" tabindex="-1"></a>        <span class="at">username =</span> <span class="st">"phurvitz@uw.edu"</span></span>
<span id="cb220-233"><a href="week2.html#cb220-233" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb220-234"><a href="week2.html#cb220-234" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Enter your HMD password in the prompt</span></span>
<span id="cb220-235"><a href="week2.html#cb220-235" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb220-236"><a href="week2.html#cb220-236" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb220-237"><a href="week2.html#cb220-237" aria-hidden="true" tabindex="-1"></a><span class="co"># Set your password for Human Fertility Database (HFD)</span></span>
<span id="cb220-238"><a href="week2.html#cb220-238" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="fu">key_list</span>(<span class="at">service =</span> <span class="st">"human-fertility-database"</span>) <span class="sc">%&gt;%</span> <span class="fu">nrow</span>() <span class="sc">==</span> <span class="dv">0</span>) {</span>
<span id="cb220-239"><a href="week2.html#cb220-239" aria-hidden="true" tabindex="-1"></a>    keyring<span class="sc">::</span><span class="fu">key_set</span>(</span>
<span id="cb220-240"><a href="week2.html#cb220-240" aria-hidden="true" tabindex="-1"></a>        <span class="at">service =</span> <span class="st">"human-fertility-database"</span>,</span>
<span id="cb220-241"><a href="week2.html#cb220-241" aria-hidden="true" tabindex="-1"></a>        <span class="at">username =</span> <span class="st">"phurvitz@uw.edu"</span></span>
<span id="cb220-242"><a href="week2.html#cb220-242" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb220-243"><a href="week2.html#cb220-243" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Enter your HFD password in the prompt</span></span>
<span id="cb220-244"><a href="week2.html#cb220-244" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb220-245"><a href="week2.html#cb220-245" aria-hidden="true" tabindex="-1"></a><span class="fu">key_list</span>()</span>
<span id="cb220-246"><a href="week2.html#cb220-246" aria-hidden="true" tabindex="-1"></a><span class="co"># I only create the key if it does not exist</span></span>
<span id="cb220-247"><a href="week2.html#cb220-247" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="fu">nrow</span>(<span class="fu">key_list</span>(<span class="at">service =</span> <span class="st">"bogus"</span>)) <span class="sc">==</span> <span class="dv">0</span>){</span>
<span id="cb220-248"><a href="week2.html#cb220-248" aria-hidden="true" tabindex="-1"></a>    <span class="fu">key_set_with_value</span>(<span class="at">service =</span> <span class="st">"bogus"</span>, </span>
<span id="cb220-249"><a href="week2.html#cb220-249" aria-hidden="true" tabindex="-1"></a>                           <span class="at">username =</span> <span class="st">"fake@user.tv"</span>,</span>
<span id="cb220-250"><a href="week2.html#cb220-250" aria-hidden="true" tabindex="-1"></a>                           <span class="at">password =</span> <span class="st">"the user and password are fake."</span>)</span>
<span id="cb220-251"><a href="week2.html#cb220-251" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb220-252"><a href="week2.html#cb220-252" aria-hidden="true" tabindex="-1"></a><span class="fu">key_get</span>(<span class="at">service =</span> <span class="st">"bogus"</span>, <span class="st">"fake@user.tv"</span>)</span>
<span id="cb220-253"><a href="week2.html#cb220-253" aria-hidden="true" tabindex="-1"></a><span class="fu">key_delete</span>(<span class="at">service =</span> <span class="st">"bogus"</span>, <span class="at">username =</span> <span class="st">"fake@user.tv"</span>)</span>
<span id="cb220-254"><a href="week2.html#cb220-254" aria-hidden="true" tabindex="-1"></a>ISR_mx <span class="ot">&lt;-</span> HMDHFDplus<span class="sc">::</span><span class="fu">readHMDweb</span>(</span>
<span id="cb220-255"><a href="week2.html#cb220-255" aria-hidden="true" tabindex="-1"></a>    <span class="co"># data for Israel</span></span>
<span id="cb220-256"><a href="week2.html#cb220-256" aria-hidden="true" tabindex="-1"></a>    <span class="at">CNTRY =</span> <span class="st">"ISR"</span>,</span>
<span id="cb220-257"><a href="week2.html#cb220-257" aria-hidden="true" tabindex="-1"></a>    <span class="co"># mortality 1 year age by 1 year interval</span></span>
<span id="cb220-258"><a href="week2.html#cb220-258" aria-hidden="true" tabindex="-1"></a>    <span class="at">item =</span> <span class="st">"Mx_1x1"</span>,</span>
<span id="cb220-259"><a href="week2.html#cb220-259" aria-hidden="true" tabindex="-1"></a>    <span class="co"># get my username</span></span>
<span id="cb220-260"><a href="week2.html#cb220-260" aria-hidden="true" tabindex="-1"></a>    <span class="at">username =</span> keyring<span class="sc">::</span><span class="fu">key_list</span>(<span class="st">"human-mortality-database"</span>) <span class="sc">%&gt;%</span> <span class="fu">pull</span>(username),</span>
<span id="cb220-261"><a href="week2.html#cb220-261" aria-hidden="true" tabindex="-1"></a>    <span class="at">password =</span> keyring<span class="sc">::</span><span class="fu">key_get</span>(</span>
<span id="cb220-262"><a href="week2.html#cb220-262" aria-hidden="true" tabindex="-1"></a>        <span class="at">service =</span> <span class="st">"human-mortality-database"</span>,</span>
<span id="cb220-263"><a href="week2.html#cb220-263" aria-hidden="true" tabindex="-1"></a>        <span class="at">username =</span> keyring<span class="sc">::</span><span class="fu">key_list</span>(<span class="st">"human-mortality-database"</span>)<span class="sc">$</span>username</span>
<span id="cb220-264"><a href="week2.html#cb220-264" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb220-265"><a href="week2.html#cb220-265" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb220-266"><a href="week2.html#cb220-266" aria-hidden="true" tabindex="-1"></a>JPN_livebirths <span class="ot">&lt;-</span> HMDHFDplus<span class="sc">::</span><span class="fu">readHFDweb</span>(</span>
<span id="cb220-267"><a href="week2.html#cb220-267" aria-hidden="true" tabindex="-1"></a>    <span class="co"># data for Japan</span></span>
<span id="cb220-268"><a href="week2.html#cb220-268" aria-hidden="true" tabindex="-1"></a>    <span class="at">CNTRY =</span> <span class="st">"JPN"</span>,</span>
<span id="cb220-269"><a href="week2.html#cb220-269" aria-hidden="true" tabindex="-1"></a>    <span class="co"># live births</span></span>
<span id="cb220-270"><a href="week2.html#cb220-270" aria-hidden="true" tabindex="-1"></a>    <span class="at">item =</span> <span class="st">"totbirthsRR"</span>,</span>
<span id="cb220-271"><a href="week2.html#cb220-271" aria-hidden="true" tabindex="-1"></a>    <span class="co"># get my username</span></span>
<span id="cb220-272"><a href="week2.html#cb220-272" aria-hidden="true" tabindex="-1"></a>    <span class="at">username =</span> keyring<span class="sc">::</span><span class="fu">key_list</span>(<span class="st">"human-mortality-database"</span>) <span class="sc">%&gt;%</span> <span class="fu">pull</span>(username),</span>
<span id="cb220-273"><a href="week2.html#cb220-273" aria-hidden="true" tabindex="-1"></a>    <span class="at">password =</span> keyring<span class="sc">::</span><span class="fu">key_get</span>(</span>
<span id="cb220-274"><a href="week2.html#cb220-274" aria-hidden="true" tabindex="-1"></a>        <span class="at">service =</span> <span class="st">"human-mortality-database"</span>,</span>
<span id="cb220-275"><a href="week2.html#cb220-275" aria-hidden="true" tabindex="-1"></a>        <span class="at">username =</span> keyring<span class="sc">::</span><span class="fu">key_list</span>(<span class="st">"human-mortality-database"</span>)<span class="sc">$</span>username</span>
<span id="cb220-276"><a href="week2.html#cb220-276" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb220-277"><a href="week2.html#cb220-277" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb220-278"><a href="week2.html#cb220-278" aria-hidden="true" tabindex="-1"></a><span class="co"># load required packages</span></span>
<span id="cb220-279"><a href="week2.html#cb220-279" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(HMDHFDplus)</span>
<span id="cb220-280"><a href="week2.html#cb220-280" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(keyring)</span>
<span id="cb220-281"><a href="week2.html#cb220-281" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb220-282"><a href="week2.html#cb220-282" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb220-283"><a href="week2.html#cb220-283" aria-hidden="true" tabindex="-1"></a><span class="co"># note to see country codes, </span></span>
<span id="cb220-284"><a href="week2.html#cb220-284" aria-hidden="true" tabindex="-1"></a><span class="co"># https://www.mortality.org/cgi-bin/hmd/DataAvailability.php</span></span>
<span id="cb220-285"><a href="week2.html#cb220-285" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb220-286"><a href="week2.html#cb220-286" aria-hidden="true" tabindex="-1"></a><span class="co"># Running for a single country with item left NULL lists available series</span></span>
<span id="cb220-287"><a href="week2.html#cb220-287" aria-hidden="true" tabindex="-1"></a><span class="co"># for that country and ask for user entry of desired item</span></span>
<span id="cb220-288"><a href="week2.html#cb220-288" aria-hidden="true" tabindex="-1"></a><span class="co"># HMDHFDplus::readHMDweb(</span></span>
<span id="cb220-289"><a href="week2.html#cb220-289" aria-hidden="true" tabindex="-1"></a><span class="co">#   CNTRY = "USA",</span></span>
<span id="cb220-290"><a href="week2.html#cb220-290" aria-hidden="true" tabindex="-1"></a><span class="co">#   username = keyring::key_list("human-mortality-database")$username,</span></span>
<span id="cb220-291"><a href="week2.html#cb220-291" aria-hidden="true" tabindex="-1"></a><span class="co">#   password = keyring::key_get(</span></span>
<span id="cb220-292"><a href="week2.html#cb220-292" aria-hidden="true" tabindex="-1"></a><span class="co">#     service = "human-mortality-database",</span></span>
<span id="cb220-293"><a href="week2.html#cb220-293" aria-hidden="true" tabindex="-1"></a><span class="co">#     username = keyring::key_list("human-mortality-database")$username</span></span>
<span id="cb220-294"><a href="week2.html#cb220-294" aria-hidden="true" tabindex="-1"></a><span class="co">#   )</span></span>
<span id="cb220-295"><a href="week2.html#cb220-295" aria-hidden="true" tabindex="-1"></a><span class="co"># )</span></span>
<span id="cb220-296"><a href="week2.html#cb220-296" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb220-297"><a href="week2.html#cb220-297" aria-hidden="true" tabindex="-1"></a><span class="co"># Function to download a specified HMD data set item for a single county</span></span>
<span id="cb220-298"><a href="week2.html#cb220-298" aria-hidden="true" tabindex="-1"></a><span class="co"># the country code is referenced as "CNTRY"</span></span>
<span id="cb220-299"><a href="week2.html#cb220-299" aria-hidden="true" tabindex="-1"></a><span class="co"># the "item" is the base name of the link with ".txt" removed. For example,</span></span>
<span id="cb220-300"><a href="week2.html#cb220-300" aria-hidden="true" tabindex="-1"></a><span class="co"># https://www.mortality.org/hmd/ISR/STATS/Mx_1x1.txt</span></span>
<span id="cb220-301"><a href="week2.html#cb220-301" aria-hidden="true" tabindex="-1"></a><span class="co">#                                         Mx_1x1       &lt;&lt;- this is the item for 1 year x 1 year death rates</span></span>
<span id="cb220-302"><a href="week2.html#cb220-302" aria-hidden="true" tabindex="-1"></a>read_hmd_country <span class="ot">&lt;-</span> <span class="cf">function</span>(CNTRY, item) {</span>
<span id="cb220-303"><a href="week2.html#cb220-303" aria-hidden="true" tabindex="-1"></a>  HMDHFDplus<span class="sc">::</span><span class="fu">readHMDweb</span>(</span>
<span id="cb220-304"><a href="week2.html#cb220-304" aria-hidden="true" tabindex="-1"></a>    <span class="co"># the country from the function call</span></span>
<span id="cb220-305"><a href="week2.html#cb220-305" aria-hidden="true" tabindex="-1"></a>    <span class="at">CNTRY =</span> CNTRY,</span>
<span id="cb220-306"><a href="week2.html#cb220-306" aria-hidden="true" tabindex="-1"></a>    <span class="co"># the item to download</span></span>
<span id="cb220-307"><a href="week2.html#cb220-307" aria-hidden="true" tabindex="-1"></a>    <span class="at">item =</span> item,</span>
<span id="cb220-308"><a href="week2.html#cb220-308" aria-hidden="true" tabindex="-1"></a>    <span class="co"># the username from this key's record</span></span>
<span id="cb220-309"><a href="week2.html#cb220-309" aria-hidden="true" tabindex="-1"></a>    <span class="at">username =</span> keyring<span class="sc">::</span><span class="fu">key_list</span>(<span class="st">"human-mortality-database"</span>)<span class="sc">$</span>username,</span>
<span id="cb220-310"><a href="week2.html#cb220-310" aria-hidden="true" tabindex="-1"></a>    <span class="co"># the password for this key's record</span></span>
<span id="cb220-311"><a href="week2.html#cb220-311" aria-hidden="true" tabindex="-1"></a>    <span class="at">password =</span> keyring<span class="sc">::</span><span class="fu">key_get</span>(</span>
<span id="cb220-312"><a href="week2.html#cb220-312" aria-hidden="true" tabindex="-1"></a>      <span class="at">service =</span> <span class="st">"human-mortality-database"</span>,</span>
<span id="cb220-313"><a href="week2.html#cb220-313" aria-hidden="true" tabindex="-1"></a>      <span class="at">username =</span> keyring<span class="sc">::</span><span class="fu">key_list</span>(<span class="st">"human-mortality-database"</span>)<span class="sc">$</span>username</span>
<span id="cb220-314"><a href="week2.html#cb220-314" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb220-315"><a href="week2.html#cb220-315" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb220-316"><a href="week2.html#cb220-316" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb220-317"><a href="week2.html#cb220-317" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb220-318"><a href="week2.html#cb220-318" aria-hidden="true" tabindex="-1"></a><span class="co"># Help function to list the available countries</span></span>
<span id="cb220-319"><a href="week2.html#cb220-319" aria-hidden="true" tabindex="-1"></a><span class="co"># this generates a vector of all country abbreviations</span></span>
<span id="cb220-320"><a href="week2.html#cb220-320" aria-hidden="true" tabindex="-1"></a>countries <span class="ot">&lt;-</span> HMDHFDplus<span class="sc">::</span><span class="fu">getHMDcountries</span>()</span>
<span id="cb220-321"><a href="week2.html#cb220-321" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb220-322"><a href="week2.html#cb220-322" aria-hidden="true" tabindex="-1"></a><span class="co"># Download a data set iteratively for all countries using purrr::map()</span></span>
<span id="cb220-323"><a href="week2.html#cb220-323" aria-hidden="true" tabindex="-1"></a><span class="co"># In this case, age-specific mortality in 1-year periods x 1-year age groups</span></span>
<span id="cb220-324"><a href="week2.html#cb220-324" aria-hidden="true" tabindex="-1"></a><span class="co"># for all 1-year periods available</span></span>
<span id="cb220-325"><a href="week2.html#cb220-325" aria-hidden="true" tabindex="-1"></a><span class="co"># output is a data frame named "mx_1x1"</span></span>
<span id="cb220-326"><a href="week2.html#cb220-326" aria-hidden="true" tabindex="-1"></a>mx_1x1 <span class="ot">&lt;-</span> countries <span class="sc">%&gt;%</span></span>
<span id="cb220-327"><a href="week2.html#cb220-327" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Returns a list of data.frames, adding a column for country code to each</span></span>
<span id="cb220-328"><a href="week2.html#cb220-328" aria-hidden="true" tabindex="-1"></a>    <span class="co"># the map() function performs a run of Ben's read_hmd_country() function for each listed country</span></span>
<span id="cb220-329"><a href="week2.html#cb220-329" aria-hidden="true" tabindex="-1"></a>    purrr<span class="sc">::</span><span class="fu">map_dfr</span>(<span class="cf">function</span>(country) {</span>
<span id="cb220-330"><a href="week2.html#cb220-330" aria-hidden="true" tabindex="-1"></a>        <span class="co"># the item to read is 1 x 1 death rates</span></span>
<span id="cb220-331"><a href="week2.html#cb220-331" aria-hidden="true" tabindex="-1"></a>        <span class="fu">read_hmd_country</span>(country, <span class="st">"Mx_1x1"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb220-332"><a href="week2.html#cb220-332" aria-hidden="true" tabindex="-1"></a>            <span class="co"># this adds the column "country" storing the country ISO code</span></span>
<span id="cb220-333"><a href="week2.html#cb220-333" aria-hidden="true" tabindex="-1"></a>            dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">country =</span> country)</span>
<span id="cb220-334"><a href="week2.html#cb220-334" aria-hidden="true" tabindex="-1"></a>    }) <span class="sc">%&gt;%</span></span>
<span id="cb220-335"><a href="week2.html#cb220-335" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Phil added this to make it a tibble</span></span>
<span id="cb220-336"><a href="week2.html#cb220-336" aria-hidden="true" tabindex="-1"></a>    <span class="fu">tibble</span>()</span>
<span id="cb220-337"><a href="week2.html#cb220-337" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="fu">readLines</span>(fnamepath), <span class="at">sep =</span> <span class="st">'</span><span class="sc">\n</span><span class="st">'</span>)</span></code></pre></div>
</div>
<div id="complete-rmd-code-1" class="section level3" number="2.5.2">
<h3>
<span class="header-section-number">2.5.2</span> Complete Rmd code<a class="anchor" aria-label="anchor" href="#complete-rmd-code-1"><i class="fas fa-link"></i></a>
</h3>
<div class="sourceCode" id="cb221"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/readLines.html">readLines</a></span><span class="op">(</span><span class="va">fnamepath</span><span class="op">)</span>, sep <span class="op">=</span> <span class="st">'\n'</span><span class="op">)</span></code></pre></div>
<pre><code>Warning in readLines(fnamepath): incomplete final line found on 'H:/csde502-
winter-2022-main/02-week02.Rmd'</code></pre>
<pre><code># Week 2 {#week2}

This session covers the basics of creating R Markdown documents. We will also cover the [Keyring](https://cran.r-project.org/web/packages/keyring/index.html) package for securely storing passwords and other secrets that one would not want to hard-code into R documents. Finally, we will introduce the Human Mortality and Human Fertility databases that will be used in CSDE 533.

For this class session, we will be building up an R Markdown document using various code chunks copied and pasted from this page.

Download the file [week02.Rmd](files/week02/week02.Rmd) and use that as the base. Change the second line in the YAML header so it uses your name and your web site. See [UW Students Web Server](https://students.washington.edu/) if you do not have a web site.

```{r, echo=FALSE, warning=FALSE, message=FALSE}
pacman::p_load(tidyverse, magrittr, knitr, kableExtra, readstata13, stargazer, pander, captioner, keyring, HMDHFDplus, flextable)

# captions
figure_nums &lt;- captioner(prefix = "Figure")
table_nums &lt;- captioner(prefix = "Table")

# path to this file name
if (!interactive()) {
    fnamepath &lt;- current_input(dir = TRUE)
}
```

&lt;h2&gt;Topics:&lt;/h2&gt;
* [Code chunks in R](#rmdcodeblocks)
* [Graphs in R Markdown](#rmdgraphics)
* [Tables in R Markdow](#rmdtables)
* [Equations in R Markdown](#rmdequations)
* [Captions and cross-references in R Markdown](#rmdcaptions)
* [Keyring for storing passwords and other secrets](#keyring)
* [Data sets:](#datasets002)
    * Data:
        * Human Mortality Database
        * Human Fertility Database


## Code to run for the in-class exercise

```{r, echo=FALSE}
# generate the R code to run in class
# O &lt;- knitr::purl(input = "02-week02.Rmd", output = "r_code/week02.R", quiet = TRUE, documentation = 1)
```

For the exercise in class, download [week02.R](r_code/week02.R), which we will use to run the code listed in this R Markdown result.

## R Markdown 

### Code chunks {#rmdcodeblocks}
Code chunks are blocks of text that include R code. As the R Markdown file is rendered, the code is run. The code can run R routines to perform any number of tasks, including analytics, printing tables, and generating graphics. Anything you would do in a regular R file can be placed in the code chunks. Code chunks can print outputs (tables, figures), but they do not necessarily always do; for example, your code could generate a summary of a raw data set, export to a CSV file, and zip the CSV file. You could then "manually" print a hyperlink in your output.

In RStudio, a code chunk can be added to an R Markdown source file with the keystroke combination CTRL-ALT-i


#### Code chunk structure

Code chunks are designated by delimiting the code with the characters ` ```{r}` to open the block and ` ``` ` to close the block.

There are a number of additional options that can be included in the `{r}` opening delimiter, see [Chunk options and package options](https://yihui.org/knitr/options/). Many options are set by default and require being set explicitly to select any option other than the default.

For example, the code chunk can be not run with the `eval=FALSE` option. Or if the code chunk generates a graphic, the `fig.cap` option can be used to print a caption.

For example, the following code chunk creates a single element vector `a` with the value of `2`.

````
```{r, eval=TRUE}`r ''`
a &lt;- 1 + 1
```
````

### Inline code
```{r, echo=FALSE}
# read this for later
etdata &lt;- read.csv("https://raw.githubusercontent.com/teuschb/hr_data/master/datasets/turnover_babushkin.csv")
```

Inline code is designated using this type of syntax `` ``r ''`r R_CODE` ``, where `R_CODE` represents a statement to be evaluated and printed inline. 

For example, to get the mean age from the Babushkin data, the `R_CODE` would read

```md
mean(etdata$age) %&gt;% round(1)
```

That is, in the document one would write:

```{md}
The mean age of the subjects in the Babushkin data was `r mean(etdata$age) %&gt;% round(1)` years.
```

which renders to 

```
The mean age of the subjects in the Babushkin data was `r mean(etdata$age) %&gt;% round(1)` years.
```

### Graphics in R Markdown {#rmdgraphics}
Data-driven graphics in Rmd files are typically created as base R graphics or with the `ggplot2` package. This tutorial is not intended to provide anywhere near a comprehensive treatment of creating graphics from data, but will provide instruction on some options for creating and including data-driven graphics as well as inserting graphics from image files.

See [Tips and tricks for working with images and figures in R Markdown documents](http://zevross.com/blog/2017/06/19/tips-and-tricks-for-working-with-images-and-figures-in-r-markdown-documents/) for a good explanation.

#### Base R graphics
To include base R graphics, simply place the code to generate the graphic in an R code block, e.g., using the Add Health data from last week ([AHWave1_v1.dta](data/AHwave1_v1.dta)):

```{r, comment='', echo=FALSE}
cat(readLines("files/week02/rmd_insert_text_01.txt"), sep = "\n")
```

... which will render the graph:

```{r, echo=FALSE, warning=FALSE}
# since loading the data takes awhile, only load the data if necessary -- won't load if it was done already
if (!exists("dat")) {
    dat &lt;- read.dta13("https://csde-uw.github.io/csde502-winter-2022/data/AHwave1_v1.dta")
}
# birth year = h1gi1y
# drop "Refused" birth year
# for birth year and interview year, replace anything before white space, convert to numeric
# subtract interview year - birth year
ages &lt;- dat %&gt;%
    filter(!str_detect(h1gi1y, "Refused")) %&gt;%
    select(iyear, h1gi1y) %&gt;%
    mutate(
        yi = str_replace(iyear, ".*\\s", "") %&gt;% as.numeric(),
        yb = str_replace(h1gi1y, ".*\\s", "") %&gt;% as.numeric(),
        age = yi - yb
    )
hist(ages$age, xlab = "age (years)", las = 1)
```

#### `ggplot2` graphics
The `ggplot2` package creates compelling graphics that use a common syntax. The main difference between base R graphics and `ggplot2` graphics is that simply issuing the `plot()` or related command (e.g., `hist()`, `barplot()`) adds the graphic to the output, whereas with `ggplot()` it is necessary to issue a command that prints the graphic.

Following the previous example:

```{r, comment='', echo=FALSE}
cat(readLines("files/week02/geom_histogram.txt"), sep = "\n")
```

```{r, echo=FALSE}
# how many unique bins?
bins &lt;- length(unique(ages$age))

# create the graphic
g &lt;- ggplot(data = ages, mapping = aes(x = age)) +
    geom_histogram(bins = bins)

# print the graphic
print(g)
```

The following code generates a box plot from the Babushkin employee turnover data. Because the code chunk includes `fig.cap = "Box plot of Babushkin data, self control by profession"`, a caption is automatically placed below the figure.

```{r, comment='', echo=FALSE}
cat(readLines("files/week02/babushkin_boxplot.txt"), sep = "\n")
```

```{r, fig.cap = "Box plot of Babushkin data, self control by profession", echo=FALSE}
ggplot(data = etdata, aes(x = reorder(profession, selfcontrol), y = selfcontrol)) +
    geom_boxplot() +
    coord_flip()
```

#### Embedding graphics files
Journals frequently require graphics files to be submitted separately from the manuscript. In this case, the graphic can be created and saved as a file and then inserted in the Rmd using code, but also accessed as a a stand-alone file. Let's take the previous example, but add correlation coefficients and other embellishments, create a graphics file and add the graphics into the Rmd.

The base graphics file is created using the `pdf()` function, although `png()` also works if that is the desired output format. PDF is a vector format, so it generally renders better over different zoom levels.

```{r, message=FALSE}
pdf(file = "ah_age_hist.pdf", width = 5, height = 5)
hist(ages$age, xlab = "age (years)", las = 1)
x &lt;- dev.off()
```

Here we create a PNG format file:

```{r, message=FALSE}
png(file = "ah_age_hist.png", width = 5, height = 5, units = "in", res = 300)
hist(ages$age, xlab = "age (years)", las = 1)
x &lt;- dev.off()
```

`ggplot2` graphics can be saved using `ggsave()`, e.g., for both PDF and PNG outputs. The `dpi` argument is important for bitmap images because it sets the dots per inch, which controls the size of the graphics file.

```{r}
ggsave(
    filename = "ah_age_hist_ggplot.pdf",
    plot = g, device = "pdf",
    width = 5, height = 5
)
ggsave(
    filename = "ah_age_hist_ggplot.png",
    plot = g, device = "png",
    width = 5, height = 5,
    units = "in", dpi = 300
)
```

Graphics can be added using several methods.

##### `knitr`
The `knitr::include_graphics()` function can be used to insert image files, with the caution that inserted PDF files may produce unwanted results. The syntax is:

```{r, comment='', echo=FALSE}
cat(readLines("files/week02/rmd_insert_text_02.txt"), sep = "\n")
```

and the code chunk can include `out.width`, `out.height` and other options after the `r` in the first line of the chunk,
\  
Here we insert a PDF with no code chunk options, which presents the image with a scroll bar, rather than the full image:

```{r}
include_graphics("ah_age_hist.pdf")
```

Here we specify in the code chunk options `out.height = "360px", out.width='360px', fig.align='left'`, 

```{r, out.height = "360px", out.width='360px', fig.align='left'}
include_graphics("ah_age_hist.pdf")

```

\  

... and with code chunk options `out.height = "400px", out.width='100%', fig.align='left'`

```{r, out.height = "400px", out.width='100%', fig.align='left'}
include_graphics("ah_age_hist.pdf")
```

\  

It seems that embedding PDF files is not optimal.

Here we insert a PNG: with no code chunk options:

```{r}
include_graphics("ah_age_hist_ggplot.png")
```

and with code chunk option `out.width = "50%"`

```{r, out.width = "50%"}
include_graphics("ah_age_hist_ggplot.png")
```

So embedding bitmapped images appears to work better than embedding PDF files. 

##### Markdown: `![caption](filename)`

The native Markdown syntax:

```
![](filename)
```

includes a graphics file with an optional caption, e.g., here, a PDF with no caption, 

`![](ah_age_hist.pdf)`

![](ah_age_hist.pdf)

\  

The structure `![]()` indicates this is an inserted graphic; a caption can be specified by including text within the square brackets, e.g., displays the caption below the inserted image (but with no caption number!). 

```![Add Health respondent age histogram](ah_age_hist_ggplot.pdf)```

![Add Health respondent age histogram](ah_age_hist_ggplot.pdf)

... although it seems that inserting a PDF does odd things with image scrolling, while a PNG inserts the complete image without scroll bars.

```![Add Health respondent age histogram](ah_age_hist_ggplot.png)```:

![Add Health respondent age histogram](ah_age_hist_ggplot.png)

##### HTML `&lt;img&gt;` tag
If the file is to be rendered as HTML, _and_ the image is a bitmap, rather than vector PDF graphics, the `&lt;img&gt;` tag can be used. Different utilities can be used to convert PDF to bitmapped formats, e.g., [ImageMagick](https://imagemagick.org/index.php) and [GraphicsMagick](http://www.graphicsmagick.org/).

```&lt;img src="ah_age_hist_ggplot.png"&gt;```

&lt;img src="ah_age_hist_ggplot.png"&gt;

Including a percentage of page width:

```&lt;img src="ah_age_hist_ggplot.png" width="30%"&gt;```

&lt;img src="ah_age_hist_ggplot.png" width="30%"&gt;


### Tables in R Markdown {#rmdtables}
We will look at three methods of including tables in R Markdown documents, using the packages `knitr` (with `kableExtra`), `pander`, and `stargazer`.

For the example table, we will use the frequency table of health $\times$ White and African American from the Add Health data:

```{r}
dat &lt;- readstata13::read.dta13("http://staff.washington.edu/phurvitz/csde502_winter_2021/data/AHwave1_v1.dta")


# ordered factor; use fct_rev to establish the correct ordering where better health ranks higher
dat %&lt;&gt;%
    mutate(h1gh1 = fct_rev(as.ordered(h1gh1)))

# stratify health; first we need to catch the "don't know" and "refused" as NAs
dat %&lt;&gt;%
    mutate(
        health =
            case_when(
                h1gh1 &lt;= "(6) Refused" ~ as.character(NA),
                h1gh1 &gt; "(3) Good" ~ "high",
                h1gh1 &lt;= "(3) Good" ~ "low"
            )
    )

# tabulate by White
tabhealth_white &lt;- dat %&gt;%
    group_by(health, white = h1gi6a) %&gt;%
    summarise(n = n(), .groups = "drop_last") %&gt;%
    mutate("%" = round(n / sum(n) * 100, 2))

# tabulate by African American
tabhealth_afram &lt;- dat %&gt;%
    group_by(health, afram = h1gi6b) %&gt;%
    summarise(n = n(), .groups = "drop_last") %&gt;%
    mutate("%" = round(n / sum(n) * 100, 2))

# column-bind and remove the second "health" column
sum_health_white_afram &lt;- cbind(tabhealth_white, tabhealth_afram) %&gt;%
    select(-5)
```

#### `kntir` (`kable()`) and `kableExtra`
The simple table using `kable()` is not too nice to read.

```{r}
kable(sum_health_white_afram)
```

So we add some `kableExtra` options, :

```{r}
kable(sum_health_white_afram,
    col.names = c("health", "race", "n", "%", "race", "n", "%")
) %&gt;%
    kable_styling(bootstrap_options = c("striped", "hover", "condensed", "responsive"), full_width = F, position = "left")
```

However, because some column names are duplicated, it is necessary to add some column grouping:

```{r}
kable(sum_health_white_afram,
    col.names = c("health", "race", "n", "%", "race", "n", "%")
) %&gt;%
    kable_styling(bootstrap_options = c("striped", "hover", "condensed", "responsive"), full_width = F, position = "left") %&gt;%
    add_header_above(c(" " = 1, "White" = 3, "African American" = 3))
```

We could also add some row groupings:

```{r}
sum_health_white_afram %&gt;%
    select(-1) %&gt;%
    kable(col.names = c("race", "n", "%", "race", "n", "%"), align = c(rep("r", times = 6))) %&gt;%
    kable_styling(bootstrap_options = c("striped", "hover", "condensed", "responsive"), full_width = F, position = "left") %&gt;%
    add_header_above(c("White" = 3, "African American" = 3)) %&gt;%
    pack_rows("health high", 1, 4) %&gt;%
    pack_rows("health low", 5, 8) %&gt;%
    pack_rows("health N/A", 9, 12)
```

Another simple example using the Babushkin data; the following code: 

```{r, comment='', echo=FALSE}
cat(readLines("files/week02/etdata_kable.txt"), sep = "\n")
```

... generates the following table 
&lt;!-- (`r table_nums(name = "babushkin", display = "cite")`) --&gt;
:

&lt;!-- _`r table_nums(name = "babushkin", caption = "Babushkin data, tenure by gender and age")`_ --&gt;

```{r, echo=FALSE}
etdata &lt;- read.csv("https://raw.githubusercontent.com/teuschb/hr_data/master/datasets/turnover_babushkin.csv")

# create 10-year age classes
etdata %&lt;&gt;%
    mutate(age_decade = plyr::round_any(age, 10, f = ceiling))

# summarize
etdata %&gt;%
    # group by gender and age class
    group_by(gender, age_decade) %&gt;%
    # mean and sd
    dplyr::summarize(
        mean_tenure_months = mean(tenure) %&gt;% round(1),
        sd_tenure_months = sd(tenure) %&gt;% round(1),
        .groups = "keep"
    ) %&gt;%
    # order the output by age and gender
    arrange(gender, mean_tenure_months) %&gt;%
    # print it nicely
    kable() %&gt;%
    kable_styling(bootstrap_options = c("striped", "hover", "condensed"))
```

#### `stargazer`
The [`stargazer`](https://cran.r-project.org/web/packages/stargazer/vignettes/stargazer.pdf) package is especially good for PDF outputs, but is fairly limited for HTML output.

```{r results='asis'}
stargazer(sum_health_white_afram,
    type = "html",
    summary = FALSE,
    rownames = FALSE
)
```

#### `pander`
`pander` can be used to create output HTML tables as well, although also with fewer options than `knitr` with `kableExtra`.

```{r}
pander(sum_health_white_afram)
```

#### `DT::datatable`
`DT::datatable` presents tables in an interactive format, allowing filtering by free text, sorting by columns, and displaying fewer or more records. Here, the table is loaded sorted in descending order of mean anxiety per industry. The `DT::datatable` can be sorted interactively based on any of the columns.

```{r}
etdata %&gt;% 
    group_by(industry) %&gt;% 
    dplyr::summarize(n = n(),
                     mean_anxiety = mean(anxiety) %&gt;% round(1)) %&gt;% 
    arrange(desc(mean_anxiety)) %&gt;% 
DT::datatable()
```

#### `flextable`
[`flextable`](https://ardata-fr.github.io/flextable-book/index.html) is a full-featured package for fine control over table display. You can merge cells, add header rows, add footer rows, change any format and specify how data should be displayed in cells. Tables content can also contain mixed type of content, text and images.

The example shows a fairly simple output:

```{r}
ft &lt;- flextable(airquality[sample.int(10), ])
ft &lt;- add_header_row(ft,
    colwidths = c(4, 2),
    values = c("Air quality", "Time")
)
ft &lt;- theme_vanilla(ft)
ft &lt;- add_footer_lines(ft, "Daily air quality measurements in New York, May to September 1973.")
ft &lt;- color(ft, part = "footer", color = "#666666")
ft &lt;- set_caption(ft, caption = "New York Air Quality Measurements")
ft
```

A more advanced application (see [Looping over columns with compose](https://ardata-fr.github.io/flextable-book/programming.html#looping-over-columns-with-compose)):

```{r, warning=FALSE}
diamond_dat &lt;- nest(diamonds, data = -all_of(c("cut", "color"))) %&gt;% 
  mutate(
    gg = 
      lapply(
        X = data, 
        FUN = function(subdat) {
          ggplot(subdat, aes(x = x)) + 
            geom_density(color = "white") + theme_minimal() +
            scale_x_continuous(limits = c(0, 11)) +
            scale_y_continuous(limits = c(0, 1)) +
            labs(x = "", y = "") + theme_void()
        }
      )
  ) %&gt;% 
  select(-data) %&gt;% 
  pivot_wider(
    id_cols = cut, 
    names_from = color, 
    values_from = gg)

diamond_dat %&gt;% 
  flextable() %&gt;% 
  mk_par(
    value = as_paragraph(
      gg_chunk(., width = 1, height = 1, unit = "cm")), 
    j = ~ . - cut,
    use_dot = TRUE) %&gt;% 
  theme_tron() %&gt;% 
  align(align = "center", part = "all") %&gt;% 
  autofit()
```


### Captions to support tables, figures, and equations {#rmdcaptions}
There are several ways to support captions in R Markdown. The two main requirements for good captions: (1) automatic sequential numbering, and (2) ability to cross-reference.

Here are some options for adding captions:

#### Figures

##### R Markdown code chunk `fig.cap`
Code chunks can include `fig_cap` as an option, as shown below. However, in standard Rmd $\rightarrow$ HTML there does not appear to be a method for cross-referencing. The code chunk would look like

```{r, comment='', echo=FALSE}
cat(readLines("files/week02/rmd_insert_text_03.txt"), sep = "\n")
```

```{r plotcars, fig.cap="Cars: speed and distance", echo=FALSE}
plot(cars)
```

##### `bookdown` with `html_document2` output type

Using the `bookdown` package with `html_document2` output type, it is possible to cross-reference using the chunk name. For example, download and run this code [fig_cap_bookdown.Rmd](files/fig_cap_bookdown.Rmd)

Which renders a file:

![](images/week03/fig_ref.png)

There seems to be no difference in the HTML output using

```
output: 
    bookdown::html_document2:
```

versus 

```
output: 
    html_document:
````

so the former is suggested as one way to include captions that support cross-referencing.

#### Tables: `kable()` "caption"
Tables created with `kable()` can include the `caption` option. For example:

```{r}
kable(x = sum_health_white_afram, caption = "Self-reported health by race")
```

But there appears to be no direct way of cross-referencing within standard Rmd $\rightarrow$ HTML.

##### `bookdown` with `html_document2` output type

Similarly for figures, the `bookdown` package with `html_document2` output type, it is possible to cross-reference using the chunk name. For example, download and run this code [table_cap_bookdown.Rmd](files/table_cap_bookdown.Rmd)

Which renders a file:

![](images/week03/tab_ref.png)

#### Equations {#rmdequations}
Equations should be numbered in manuscripts. Using `bookdown` makes this quite easy. The equations themselves require $\LaTeX$ syntax. There are numerous web sites with examples and tutorials for creating mathematical expressions with $\LaTeX$ In this example, we include Einstein's famous equation:

&lt;pre&gt;
\begin{equation}
  E=mc^2
  (\#eq:emc)
\end{equation}
&lt;/pre&gt;

and the sum of squares:

&lt;pre&gt;
\begin{equation}
  \sum_{i=1}^n i^2 = \frac{n(n+1)(2n+1)}{6}
  (\#eq:sumn)
\end{equation}
&lt;/pre&gt;

The label for the equation is set with `(\#eq:emc)` and can be referenced using `\@ref(eq:emc)`. Operationalized, we see:

Einstein's equation, energy equals mass times the square of the speed of light is shown in \@ref(eq:emc).

\begin{equation}
  E=mc^2
  (\#eq:emc)
\end{equation}

To make a sum of squares of _n_ first integers, see \@ref(eq:sumn).

\begin{equation}
  \sum_{i=1}^n i^2 = \frac{n(n+1)(2n+1)}{6}
  (\#eq:sumn)
\end{equation}


### `captioner` for any captioning and cross-referencing figures and tables
The `captioner` package provides a flexible, albeit cumbersome, framework for captioning both tables and figures. 

The R code to do this:

```
library(captioner)
table_nums &lt;- captioner(prefix = "Table")
figure_nums &lt;- captioner(prefix = "Figure")
```

The `table_nums()` and `figure_nums()` functions are used to create captions and cross-references, and are not tied to any specific figure or table, as is the case with `kable` table captions and R code chunk `fig.cap`.

A caption is created, e.g., for a figure:

`` `r
figure_nums(name = "figname", caption = "My Caption")` ``

and referenced, e.g., 

`` `r
figure_nums(name = "figname", display = "cite")` ``

It does not matter whether the reference precedes or comes after the caption itself.

Another benefit to using `captioner` is that the output can be formatted using markdown syntax. For example, to format the caption in italics, use underscores:

`` _`r
figure_nums(name = "figname", caption = "My Caption")`_ ``

Although this method requires a bit more coding, it allows great flexibility. A complete example:

As shown in `r figure_nums(name = "ageplot", display = "cite")`, the distribution of age has a slight negative skew.

```{r, fig.width=3, fig.height=3}
# how many unique bins?
bins &lt;- length(unique(ages$age))

# create the graphic
g &lt;- ggplot(data = ages, mapping = aes(x = age)) +
    geom_histogram(bins = bins)

# print the graphic
print(g)
```

_`r figure_nums(name = "ageplot", caption = "Add Health age histogram")`_

Similarly, we can present the same data as a frequency table, as shown in `r table_nums(name = "agetab", display = "cite")`.

_`r table_nums(name = "agetab", caption = "Add Health age frequency table")`_

```{r}
ages %&gt;%
    group_by(age) %&gt;%
    summarise(n = n()) %&gt;%
    mutate(
        cumsum = cumsum(n),
        "%" = round(n / sum(n) * 100, 1),
        "cum %" = round(cumsum(n / sum(n) * 100), 1)
    ) %&gt;%
    kable() %&gt;%
    kable_styling(
        bootstrap_options =
            c("striped", "hover", "condensed", "responsive"),
        full_width = F,
        position = "left"
    )
```


## Keyring {#keyring}
In preparation for some later work, go to the following web sites and create a user profile. This will require that you establish a username and password for both sites if you have not done so already. Make a note of your username and password for these sites! You will need them later. If you are not using a password manager, you should! Highly recommended: [KeePass Password Safe](https://keepass.info/). You can store the password database on DropBox or OneDrive and you will always have access to your passwords. **Make sure you record your password correctly or you will have errors later on!**

* [Human Mortality Database (HMD)](https://www.mortality.org/)
* [Human Fertility Database (HFD)](https://www.humanfertility.org/cgi-bin/main.php)

The [Keyring](https://cran.r-project.org/web/packages/keyring/index.html) package is used for accessing credentials that you would not want to store in your R code. We will use the passwords for the Human Mortality and Human Fertility databases (covered below) as the example for how to use this package.

The keyring is stored as part of your user profile on the computer. Therefore if you are using multiple computers (e.g., your own computer as well as the CSDE terminal server), you will need to repeat the steps of setting keys. The keys are stored at the operating system level, so once set, they do not need to be reset, and any R session will have access to the keys. Also once you log on to the computer, the keyring is unlocked automatically.

The main functions you are likely to use are `key_set()` to interactively store keys, `key_list()` to list the service and username for the different keys you have created, and `key_get()` to retrieve a key. If you want to delete a key, that is done with `key_delete()`.

### Setting (storing) keys

The following code will set the keys for my user. You will want to copy this code to your R Markdown document and change the username. When you run the code, if you have not already entered keys for these two sites, you will be prompted, as shown in r figure_nums(name = "keyring1", display = "cite")`.

```{r}
# get the keys
myKeys &lt;- key_list()

# Set your password for Human Mortality Database (HMD)
# does a key exist? if not, create one
if (key_list(service = "human-mortality-database") %&gt;% nrow() == 0) {
    keyring::key_set(
        service = "human-mortality-database",
        username = "phurvitz@uw.edu"
    )
    # Enter your HMD password in the prompt
}

# Set your password for Human Fertility Database (HFD)
if (key_list(service = "human-fertility-database") %&gt;% nrow() == 0) {
    keyring::key_set(
        service = "human-fertility-database",
        username = "phurvitz@uw.edu"
    )
    # Enter your HFD password in the prompt
}
```

![](images/week02/keyring01.png)

_`r figure_nums(name = "keyring1", caption = "The keyring password storage dialogue")`_

Once the keys are stored, the service and username can be shown with `key_list()`:

```{r}
key_list()
```

### Retreiving/using usernames and passwords
In the following example, I set a bogus key to demonstrate retrieving the secret. Thde dialog appears and I enter the fake password.

```{r}
# I only create the key if it does not exist
if(nrow(key_list(service = "bogus")) == 0){
    key_set_with_value(service = "bogus", 
                           username = "fake@user.tv",
                           password = "the user and password are fake.")
}
```

Now I retrieve the key:

```{r}
key_get(service = "bogus", "fake@user.tv")
```

### Deleting a key
Here I delete the bogus key:

```{r}
key_delete(service = "bogus", username = "fake@user.tv")
```

## Data sets: {#datasets002}
Here we will use the keyring to access data in the Human Mortality and Human Fertility databases.

### Using keyring in an application

Within your code, rather than storing any passwords, you can access the password, for example, to get 1 year x 1 year death rates for Israel from the Human Mortality Database:

```{r}
ISR_mx &lt;- HMDHFDplus::readHMDweb(
    # data for Israel
    CNTRY = "ISR",
    # mortality 1 year age by 1 year interval
    item = "Mx_1x1",
    # get my username
    username = keyring::key_list("human-mortality-database") %&gt;% pull(username),
    password = keyring::key_get(
        service = "human-mortality-database",
        username = keyring::key_list("human-mortality-database")$username
    )
)
```

Or to get the total number of live births from Japan from the Human Fertility Database:

```{r}
JPN_livebirths &lt;- HMDHFDplus::readHFDweb(
    # data for Japan
    CNTRY = "JPN",
    # live births
    item = "totbirthsRR",
    # get my username
    username = keyring::key_list("human-mortality-database") %&gt;% pull(username),
    password = keyring::key_get(
        service = "human-mortality-database",
        username = keyring::key_list("human-mortality-database")$username
    )
)
```

The benefit to this method is that the password is read on the fly during the data download process and is not stored in code. Also if you were to save your R session, the password would not be stored as an object.

Download Ben's example for how to access the Human Mortality data using [HMDHFplus]()
[HMDHFDplus-gist.R](https://raw.githubusercontent.com/hanowell/uwsoc533a/main/gists/HMDHFDplus-gist.R). Here is an annotated version:

```{md}
# load required packages
library(HMDHFDplus)
library(keyring)
library(tidyverse)

# note to see country codes, 
# https://www.mortality.org/cgi-bin/hmd/DataAvailability.php

# Running for a single country with item left NULL lists available series
# for that country and ask for user entry of desired item
# HMDHFDplus::readHMDweb(
#   CNTRY = "USA",
#   username = keyring::key_list("human-mortality-database")$username,
#   password = keyring::key_get(
#     service = "human-mortality-database",
#     username = keyring::key_list("human-mortality-database")$username
#   )
# )

# Function to download a specified HMD data set item for a single county
# the country code is referenced as "CNTRY"
# the "item" is the base name of the link with ".txt" removed. For example,
# https://www.mortality.org/hmd/ISR/STATS/Mx_1x1.txt
#                                         Mx_1x1       &lt;&lt;- this is the item for 1 year x 1 year death rates
read_hmd_country &lt;- function(CNTRY, item) {
  HMDHFDplus::readHMDweb(
    # the country from the function call
    CNTRY = CNTRY,
    # the item to download
    item = item,
    # the username from this key's record
    username = keyring::key_list("human-mortality-database")$username,
    # the password for this key's record
    password = keyring::key_get(
      service = "human-mortality-database",
      username = keyring::key_list("human-mortality-database")$username
    )
  )
}

# Help function to list the available countries
# this generates a vector of all country abbreviations
countries &lt;- HMDHFDplus::getHMDcountries()

# Download a data set iteratively for all countries using purrr::map()
# In this case, age-specific mortality in 1-year periods x 1-year age groups
# for all 1-year periods available
# output is a data frame named "mx_1x1"
mx_1x1 &lt;- countries %&gt;%
    # Returns a list of data.frames, adding a column for country code to each
    # the map() function performs a run of Ben's read_hmd_country() function for each listed country
    purrr::map_dfr(function(country) {
        # the item to read is 1 x 1 death rates
        read_hmd_country(country, "Mx_1x1") %&gt;%
            # this adds the column "country" storing the country ISO code
            dplyr::mutate(country = country)
    }) %&gt;%
    # Phil added this to make it a tibble
    tibble()
```

### Human Mortality Database naming conventions
#### Mortality table naming conventions
The deaths tables are named with coding `[Deaths]_[length of age interval in years]x[length of period in years].txt`, for example deaths for each one-year age class over each year would be in a table named `Deaths_1x1.txt`; deaths for each one-year age class over 5 year intervals would be named `Deaths_1x5.txt`; deaths for 5-year age classes aggregated over 5 year intervals would be named `Deaths_5x5.txt`.

####Life table naming conventions
Data in the HMD life tables are coded `[one-letter sex code]ltper_[length of age interval in years]x[length of period in years].txt`

The one-letter sex codes:

b: Both male and female
f: Female
m: Male

For example, for females listed in one-year agre classes over each year, the file would be named `fltper_1x1.txt`, whereas for males in 5-year age classes aggregated over 10-year intervals, the table would be named `mltper_5x10.txt`.

&lt;hr&gt;
Rendered at &lt;tt&gt;`r Sys.time()`&lt;/tt&gt;

## Source code
File is at `r fnamepath`.

### Source code for this document

```{r ref.label=knitr::all_labels(), echo=TRUE, eval=FALSE}
```

### Complete Rmd code

```{r comment=''}
cat(readLines(fnamepath), sep = '\n')
```</code></pre>

</div>
</div>
</div>
  <div class="chapter-nav">
<div class="prev"><a href="week1.html"><span class="header-section-number">1</span> Week 1</a></div>
<div class="next"><a href="week3.html"><span class="header-section-number">3</span> Week 3</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#week2"><span class="header-section-number">2</span> Week 2</a></li>
<li><a class="nav-link" href="#week2">
Topics:
</a></li>
<li><a class="nav-link" href="#code-to-run-for-the-in-class-exercise"><span class="header-section-number">2.1</span> Code to run for the in-class exercise</a></li>
<li>
<a class="nav-link" href="#r-markdown"><span class="header-section-number">2.2</span> R Markdown</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#rmdcodeblocks"><span class="header-section-number">2.2.1</span> Code chunks</a></li>
<li><a class="nav-link" href="#inline-code"><span class="header-section-number">2.2.2</span> Inline code</a></li>
<li><a class="nav-link" href="#rmdgraphics"><span class="header-section-number">2.2.3</span> Graphics in R Markdown</a></li>
<li><a class="nav-link" href="#rmdtables"><span class="header-section-number">2.2.4</span> Tables in R Markdown</a></li>
<li><a class="nav-link" href="#rmdcaptions"><span class="header-section-number">2.2.5</span> Captions to support tables, figures, and equations</a></li>
<li><a class="nav-link" href="#captioner-for-any-captioning-and-cross-referencing-figures-and-tables"><span class="header-section-number">2.2.6</span> captioner for any captioning and cross-referencing figures and tables</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#keyring"><span class="header-section-number">2.3</span> Keyring</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#setting-storing-keys"><span class="header-section-number">2.3.1</span> Setting (storing) keys</a></li>
<li><a class="nav-link" href="#retreivingusing-usernames-and-passwords"><span class="header-section-number">2.3.2</span> Retreiving/using usernames and passwords</a></li>
<li><a class="nav-link" href="#deleting-a-key"><span class="header-section-number">2.3.3</span> Deleting a key</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#datasets002"><span class="header-section-number">2.4</span> Data sets:</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#using-keyring-in-an-application"><span class="header-section-number">2.4.1</span> Using keyring in an application</a></li>
<li><a class="nav-link" href="#human-mortality-database-naming-conventions"><span class="header-section-number">2.4.2</span> Human Mortality Database naming conventions</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#source-code-1"><span class="header-section-number">2.5</span> Source code</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#source-code-for-this-document-1"><span class="header-section-number">2.5.1</span> Source code for this document</a></li>
<li><a class="nav-link" href="#complete-rmd-code-1"><span class="header-section-number">2.5.2</span> Complete Rmd code</a></li>
</ul>
</li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
<li><a id="book-source" href="https://github.com/CSDE-UW/csde502-winter-2022/blob/master/02-week02.Rmd">View source <i class="fab fa-github"></i></a></li>
          <li><a id="book-edit" href="https://github.com/CSDE-UW/csde502-winter-2022/edit/master/02-week02.Rmd">Edit this page <i class="fab fa-github"></i></a></li>
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>UW CSDE 502 A Course Notes</strong>" was written by Phil Hurvitz. It was last built on 2022-02-18 14:22.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer><!-- dynamically load mathjax for compatibility with self-contained --><script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script><script type="text/x-mathjax-config">const popovers = document.querySelectorAll('a.footnote-ref[data-toggle="popover"]');
for (let popover of popovers) {
  const div = document.createElement('div');
  div.setAttribute('style', 'position: absolute; top: 0, left:0; width:0, height:0, overflow: hidden; visibility: hidden;');
  div.innerHTML = popover.getAttribute('data-content');

  var has_math = div.querySelector("span.math");
  if (has_math) {
    document.body.appendChild(div);
    MathJax.Hub.Queue(["Typeset", MathJax.Hub, div]);
    MathJax.Hub.Queue(function() {
      popover.setAttribute('data-content', div.innerHTML);
      document.body.removeChild(div);
    })
  }
}
</script>
</body>
</html>
